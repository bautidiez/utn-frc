/**/
var myApp;
myApp = myApp || (function () {
    var pleaseWaitDiv = $('<div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Processing...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');
    return {
        showPleaseWait: function() {
            pleaseWaitDiv.modal();
        },
        hidePleaseWait: function () {
            pleaseWaitDiv.modal('hide');
        },

    };
})();
window.mobileAndTabletcheck = function() {
	  var check = false;
	  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
	  return check;
}
// Acciones ejecutadas desde
var ActionFromEnum = {
		  TIMELINE: 1,
		  CONTAINER: 2,
		  MENU: 3,
		  properties: {
			    1: {nombre: "Timeline", valor: 1, codigo: "T"},
			    2: {nombre: "Container", valor: 2, codigo: "C"},
			    3: {nombre: "Menu", valor: 3, codigo: "M"}
			  }
		};
var randomNumber = Math.floor(Math.random() * 1000);
var mailNoReplyA4 = "noreply-autogestion@frc.utn.edu.ar";
var estadoModuloMensajesNuevo = 0;
var estadoModuloCalendario = 1;
var estadoModuloGrupos = 1;
var urlifyMensajes = 1;
var replaceLineBreakWithHtml = 1;
var retrasarCargaTimelinePrincipalTodos = "/todos";
var retrasarCargaTimelinePrincipalInscripciones = "/inscripciones";
var retrasarCargaTimelinePrincipal = retrasarCargaTimelinePrincipalTodos;
var limiteRetrasarCargaTimelinePrincipal = 350;
var timelineTitlePrincipal = "Mis Mensajes <small class=\"hidden-xs hidden-sm hidden-md\">todos tus mensajes principales</small>";
var cache = new Cache();
var miPromedio = "";
var urlLogonSSLUTNFRC = "https://www.frc.utn.edu.ar/logon.frc";
var urlLogoutSSLUTNFRC = "/4/Logout";
var urlSkinBase = "themes/AdminLTE-2/dist/img/";
var urlCDNIconType = "//st.frc.utn.edu.ar/autogestion/4/i/iconType/";
var urlRecursos = "resources/";
//var imagenPerfilPorDefecto = "/"+version+"/"+urlSkinBase+"/avatar"+generoCorto+".png"
var imagenPerfilPorDefecto = "/images/avatarS.jpg";
var altoGeneral = "120px";
var altoGeneralConversacion = "220px";
var pingTimeListarNuevos = 120000; //300000
var pingTimeEstadoPeticion = 6000;
var pingTimeQuitarRecientes = 120000;
var timeoutAjaxSetup = 240000;
var hayTransaccionEjecutada = 0;
var maximaPaginacion = 25;
var laUlrBusquedaActual = "buscar/destinatario/";
var ventanas = [];
var jsonConfiguracion = {};
var jsonEncabezados = {};
var jsonAtributos = {};
var categoriaActual = "";
var overlay = $('<div class="overlay"></div><div class="loading-img"></div>');
var verTerminos = 1;
var grillaActual = {}; 
moment.locale('es', {
    calendar : {
        lastDay : '[Ayer]',
        sameDay : '[Hoy]',
        nextDay : '[Mañana]',
        lastWeek : '[Ultima semana]',
        nextWeek : '[Próxima semana]',
        sameElse : 'L'
    }
});
var fechaIniciaParciales = "01/01/1990";
var fechaFinalParciales = moment();
var estadoCachePeticion = 0;
var seleccionItemsTimeLine = [];
var itemsTimeLine = { };
var settings = {	
	url : "/4/upload/foto",
	dragDrop : false,
	multiple : false,
	maxFileCount : 1,
	fileName : "uploadedFile",
	allowedTypes : "jpg,png,gif",
	acceptFiles:"image/*",
	showFileCounter : false,
	returnType : "text",
	dragDropStr : "<span><b>Arrastre y Suelte el archivo.</b></span>",
	abortStr : "Abortar",
	cancelStr : "Cancelar",
	doneStr : "Listo",
    uploadButtonClass: "subirFoto",
    uploadStr:"Foto",
	multiDragErrorStr : "Drag & Drop error.",
	extErrorStr : " NO Permitido. Las extensiones validas son: ",
	sizeErrorStr : "NO Permitido. El tamaño máximo es: ",
	maxFileCountErrorStr : " supera la cantidad máxima de archivos a la vez a subir, máximo: ",
	uploadErrorStr : "El subir no esta autorizado",
	showDataClass : "statusFoto",
	errorClass : "statusFoto",
	showDelete : false,
	dynamicFormData : function() {
		var data = {
			"A4-Token" : A4Token,
			"A4-TimeStamp" : A4TimeStamp,
			"A4-Data" : A4Data
		};
		return data;
	},
	onSuccess : function(files, data, xhr) {
		var imagenPerfilUsuarioSubida = "/" + version + "/resources/" + data;
		$(".fotoPerfilUsuario").attr("src", imagenPerfilUsuarioSubida);
		uploadObj.reset();
	},
	onSelect : function(files) {
		$("div.ajax-file-upload-statusbar").remove();
	},
	onError: function(files,status,errMsg)	{
		$(".ajax-file-upload-error").remove();
		$("#statusFoto").html("<font color='red'>Existe un inconveniente.</font>");
	}
	
}

var uploadedFilesByDocente = [];
var countUploadedFilesByDocente = [];
var settingsDocente = {
		url : "/4/upload/material",
		dragDrop : true,
        allowDuplicates: false,	
		autoSubmit: true,
		multiple : false,
		maxFileCount : 1,
		fileName : "uploadedMaterial",
		allowedTypes : "*",
		showFileCounter : false,
        showProgress:true,
		showDelete : false,
		returnType : "text",
        uploadStr:"Examinar",	
		abortStr : "Abortar",
		cancelStr : "Cancelar",
		doneStr : "Listo",
		statusBarWidth: '80%',
		dragDropStr : "<span><b>Arrastre y Suelte el archivo.</b></span>",
		multiDragErrorStr : "Drag & Drop error.",
		extErrorStr : "NO Permitido. Las extensiones validas son: ",
		sizeErrorStr : "NO Permitido. El tamaño máximo es: ",
		uploadErrorStr : "El subir no esta autorizado",
		maxFileCountErrorStr : " supera la cantidad máxima de archivos a la vez a subir, máximo: ",
		duplicateErrorStr : " no permitido. El archivo ya se encuentra.",
		beforeSend: function() 
	    {
	    },		
		dynamicFormData : function() {
			var data = {
				"A4-Token" : A4Token,
				"A4-TimeStamp" : A4TimeStamp,
				"A4-Data" : A4Data
			};
			return data;
		},
		onLoad:function(obj) {
			uploadedFilesByDocente = [];
			countUploadedFilesByDocente = 0;
		},
		onSubmit:function(files) {
			$("#publicarMensaje").prop("disabled",true);
			//return false;
		},
		onSuccess : function(files, data, xhr) {
			countUploadedFilesByDocente++;
			uploadedFilesByDocente.push(JSON.stringify(files));
			
		},
		afterUploadAll:function(obj) {
			console.log("countUploadedFilesByDocente: " + countUploadedFilesByDocente);
			console.log("uploadedFilesByDocente.length: "+uploadedFilesByDocente.length);
			
			if (uploadedFilesByDocente.length == countUploadedFilesByDocente) {
				uploadedFilesByDocente = [];
				countUploadedFilesByDocente = 0;
				$("#publicarMensaje").prop("disabled",false);
				uploadObj.reset(false);
			} else {
			}
			
			
		},
		deleteCallback: function (data, pd) {
			/*
		    for (var i = 0; i < data.length; i++) {
		        $.post("delete.php", {op: "delete",name: data[i]},
		            function (resp,textStatus, jqXHR) {
		                //Show Message	
		                alert("File Deleted");
		            });
		    }
		    pd.statusbar.hide(); //You choice.
		    */

		},		
		onSelect : function(files) {

			$("#txtMensaje").attr("placeholder","mensaje de los archivos a publicar");

			if ($(".ajax-file-upload-error").length!=0) {
			}

			$(".ajax-file-upload-error").attr("style","display: inline; background-color: red; color:white");
			$(".ajax-upload-dragdrop").attr("style","display: inline;");

		},
		onError: function(files,status,errMsg)	{		
			$("#classSubirMaterial").html("<font color='red'>Existe un inconveniente. Intente Nuevamente!</font>");
		},
		/*
		extraHTML:function() {
		    	var html = "<input type='text' name='descripcionArchivo' value='' placeholder='una descripción (opcional)' size='25' style='padding-right:100px;border: 1px solid white;border-bottom: 1px solid black' />";
				return html;    		
		},
		*/		
	}

var uploadedFilesByTramite = [];
var countUploadedFilesByTramite = [];

var settingsMateriasDocente = {
		url : "/4/upload/tramite",
		dragDrop : true,
        allowDuplicates: false,	
		autoSubmit: true,
		multiple : true,
		maxFileCount : 1,
		fileName : "uploadedTramite",
		allowedTypes : "*",
		showFileCounter : false,
        showProgress:true,
		showDelete : true,
		returnType : "text",
        uploadStr:"Seleccionar Archivos de la Materia",	
		abortStr : "Abortar",
		cancelStr : "Cancelar",
		doneStr : "Listo",
		statusBarWidth: '80%',
		dragDropStr : "<span><b>Arrastre y Suelte el archivo.</b></span>",
		multiDragErrorStr : "Drag & Drop error.",
		extErrorStr : "NO Permitido. Las extensiones validas son: ",
		sizeErrorStr : "NO Permitido. El tamaño máximo es: ",
		uploadErrorStr : "El subir no esta autorizado",
		maxFileCountErrorStr : " supera la cantidad máxima de archivos a la vez a subir, máximo: ",
		duplicateErrorStr : " no permitido. El archivo ya se encuentra.",
		beforeSend: function() 
	    {
	    },		
		dynamicFormData : function() {
			var data = {
				"A4-Token" : A4Token,
				"A4-TimeStamp" : A4TimeStamp,
				"A4-Data" : A4Data
			};
			return data;
		},
		onLoad:function(obj) {
			uploadedFilesByTramite = [];
			countUploadedFilesByTramite = 0;
		},
		onSubmit:function(files) {
			//$("#publicarMensaje").prop("disabled",true);
			//---return false;
		},
		onSuccess : function(files, data, xhr) {
			countUploadedFilesByTramite++;
			uploadedFilesByTramite.push(JSON.stringify(files));
			$("#archivosTramite").val(countUploadedFilesByTramite);
			console.log("archivos" + files);
			console.log("data " + data);
			
		},
		afterUploadAll:function(obj) {
			console.log("countUploadedFilesByTramite: " + countUploadedFilesByTramite);
			console.log("uploadedFilesByTramite.length: "+ uploadedFilesByTramite.length);
			
			
			if (uploadedFilesByTramite.length == countUploadedFilesByTramite) {
				uploadedFilesByTramite = [];
				countUploadedFilesByTramite = 0;
				
				uploadObj.reset(false);
			} else {
			}
			
			
		},
		deleteCallback: function (data, pd) {		},		
		onSelect : function(files) {

			$("#txtMensaje").attr("placeholder","mensaje de los archivos a publicar");

			if ($(".ajax-file-upload-error").length!=0) {
			}

			$(".ajax-file-upload-error").attr("style","display: inline; background-color: red; color:white");
			$(".ajax-upload-dragdrop").attr("style","display: inline;");

		},
		onError: function(files,status,errMsg)	{		
			$("#classSubirArchivoAlumnos").html("<font color='red'>Existe un inconveniente. Intente Nuevamente!</font>");
		},
		/*
		extraHTML:function() {
		    	var html = "<input type='text' name='descripcionArchivo' value='' placeholder='una descripción (opcional)' size='25' style='padding-right:100px;border: 1px solid white;border-bottom: 1px solid black' />";
				return html;    		
		},
		*/		
	}
var settingsAcreditacion = {
		url : "/4/upload/tramite",
		dragDrop : true,
        allowDuplicates: false,	
		autoSubmit: true,
		multiple : true,
		maxFileCount : 15,
		fileName : "uploadedTramite",
		allowedTypes : "*",
		showFileCounter : false,
        showProgress:true,
		showDelete : true,
		returnType : "text",
        uploadStr:"Seleccionar Archivos Acreditación",	
		abortStr : "Abortar",
		cancelStr : "Cancelar",
		doneStr : "Listo",
		statusBarWidth: '80%',
		dragDropStr : "<span><b>Arrastre y Suelte el archivo.</b></span>",
		multiDragErrorStr : "Drag & Drop error.",
		extErrorStr : "NO Permitido. Las extensiones validas son: ",
		sizeErrorStr : "NO Permitido. El tamaño máximo es: ",
		uploadErrorStr : "El subir no esta autorizado",
		maxFileCountErrorStr : " supera la cantidad máxima de archivos a la vez a subir, máximo: ",
		duplicateErrorStr : " no permitido. El archivo ya se encuentra.",
		beforeSend: function() 
	    {
	    },		
		dynamicFormData : function() {
			var data = {
				"A4-Token" : A4Token,
				"A4-TimeStamp" : A4TimeStamp,
				"A4-Data" : A4Data
			};
			return data;
		},
		onLoad:function(obj) {
			uploadedFilesByTramite = [];
			countUploadedFilesByTramite = 0;
		},
		onSubmit:function(files) {
			//$("#publicarMensaje").prop("disabled",true);
			//---return false;
		},
		onSuccess : function(files, data, xhr) {
			countUploadedFilesByTramite++;
			uploadedFilesByTramite.push(JSON.stringify(files));
			$("#archivosTramite").val(countUploadedFilesByTramite);
			console.log("archivos" + files);
			console.log("data " + data);
			
		},
		afterUploadAll:function(obj) {
			console.log("countUploadedFilesByTramite: " + countUploadedFilesByTramite);
			console.log("uploadedFilesByTramite.length: "+ uploadedFilesByTramite.length);
			
			
			if (uploadedFilesByTramite.length == countUploadedFilesByTramite) {
				uploadedFilesByTramite = [];
				countUploadedFilesByTramite = 0;
				
				uploadObj.reset(false);
			} else {
			}
			
			
		},
		deleteCallback: function (data, pd) {		},		
		onSelect : function(files) {

			$("#txtMensaje").attr("placeholder","mensaje de los archivos a publicar");

			if ($(".ajax-file-upload-error").length!=0) {
			}

			$(".ajax-file-upload-error").attr("style","display: inline; background-color: red; color:white");
			$(".ajax-upload-dragdrop").attr("style","display: inline;");

		},
		onError: function(files,status,errMsg)	{		
			$("#classSubirAcreditacion").html("<font color='red'>Existe un inconveniente. Intente Nuevamente!</font>");
		},
		/*
		extraHTML:function() {
		    	var html = "<input type='text' name='descripcionArchivo' value='' placeholder='una descripción (opcional)' size='25' style='padding-right:100px;border: 1px solid white;border-bottom: 1px solid black' />";
				return html;    		
		},
		*/		
	}
/* setea los parametros basico a enviar en cualquier peticion xhr que se realice */
	
var settingsArchivosAlumnos = {
		url : "/4/upload/tramite",
		dragDrop : true,
        allowDuplicates: false,	
		autoSubmit: true,
		multiple : true,
		maxFileCount : 15,
		fileName : "uploadedTramite",
		allowedTypes : "*",
		showFileCounter : false,
        showProgress:true,
		showDelete : false,// todavia no tenemos implementado este boton, porque solo lo borra del html y no desde la carga de achivos..
		returnType : "text",
        uploadStr:"Seleccionar Archivos",	
		abortStr : "Abortar",
		cancelStr : "Cancelar",
		doneStr : "Listo",
		statusBarWidth: '80%',
		dragDropStr : "<span><b>Arrastre y Suelte el archivo.</b></span>",
		multiDragErrorStr : "Drag & Drop error.",
		extErrorStr : "NO Permitido. Las extensiones validas son: ",
		sizeErrorStr : "NO Permitido. El tamaño máximo es: ",
		uploadErrorStr : "El subir no esta autorizado",
		maxFileCountErrorStr : " supera la cantidad máxima de archivos a la vez a subir, máximo: ",
		duplicateErrorStr : " no permitido. El archivo ya se encuentra.",
		beforeSend: function() 
	    {
	    },		
		dynamicFormData : function() {
			var data = {
				"A4-Token" : A4Token,
				"A4-TimeStamp" : A4TimeStamp,
				"A4-Data" : A4Data
			};
			return data;
		},
		onLoad:function(obj) {
			uploadedFilesByTramite = [];
			countUploadedFilesByTramite = 0;
		},
		onSubmit:function(files) {
			//$("#publicarMensaje").prop("disabled",true);
			//---return false;
		},
		onSuccess : function(files, data, xhr) {
			countUploadedFilesByTramite++;
			uploadedFilesByTramite.push(JSON.stringify(files));
			$("#archivosTramite").val(countUploadedFilesByTramite);
			console.log("archivos" + files);
			console.log("data " + data);
			
		},
		afterUploadAll:function(obj) {
			console.log("countUploadedFilesByTramite: " + countUploadedFilesByTramite);
			console.log("uploadedFilesByTramite.length: "+ uploadedFilesByTramite.length);
			
			
			if (uploadedFilesByTramite.length == countUploadedFilesByTramite) {
				uploadedFilesByTramite = [];
				countUploadedFilesByTramite = 0;
				
				uploadObj.reset(false);
			} else {
			}
			
			
		},
		deleteCallback: function (data, pd) {		},		
		onSelect : function(files) {

			$("#txtMensaje").attr("placeholder","mensaje de los archivos a publicar");

			if ($(".ajax-file-upload-error").length!=0) {
			}

			$(".ajax-file-upload-error").attr("style","display: inline; background-color: red; color:white");
			$(".ajax-upload-dragdrop").attr("style","display: inline;");

		},
		onError: function(files,status,errMsg)	{		
			$("#classSubirArchivoAlumnos").html("<font color='red'>Existe un inconveniente. Intente Nuevamente!</font>");
		},
		/*
		extraHTML:function() {
		    	var html = "<input type='text' name='descripcionArchivo' value='' placeholder='una descripción (opcional)' size='25' style='padding-right:100px;border: 1px solid white;border-bottom: 1px solid black' />";
				return html;    		
		},
		*/		
	}
/* setea los parametros basico a enviar en cualquier peticion xhr que se realice */


$.ajaxSetup({
	timeout: timeoutAjaxSetup,
	'beforeSend' : function(xhr) {
		xhr.setRequestHeader("A4-Token", A4Token);
		xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
		xhr.setRequestHeader("A4-Data", A4Data);
	},
});

$(document).ajaxError(function( event, jqxhr, settings, thrownError ) {
	   console.log("event:" + event);
	   console.log("jqxhr:" + jqxhr);
	   console.log("jqxhr:" + jqxhr.status);
	   console.log("settings:" + settings);

	 if (jqxhr.status == 302) {
	        //window.location.reload(true);
	        abrirModalGeneral('<i class="fa fa-info"></i> Sesión no iniciada o caduca','Por favor, inicia sesión para continuar.',true,false,0,function(e) {window.location.href=urlLogoutSSLUTNFRC },function(e) { },{backdrop: 'static',keyboard: false},true);
		 	$("#dialogoGeneral").attr("style","z-index:999999");
		 	//window.location.href=urlLogoutSSLUTNFRC
		 	//$('<div class="modal-backdrop"></div>').appendTo("#dialogoGeneral");	        
	        setPingTimeListarNuevos(0);	               
	    } else {
	    	//console.log("ERROR:");
	    	//console.log("event:" + event);
	    	//console.log("jqxhr:" + jqxhr);
	    	//console.log("settings:" + settings);
	    	//console.log("thrownError:" + thrownError);	
	 }	
});
function getIdPeticion() {
	return idPeticion; 
} 
function setIdPeticion(valor) {
	idPeticion = valor;  
} 
function getLaUlrBusquedaActual() {
	return laUlrBusquedaActual; 
} 
function setLaUlrBusquedaActual(url) {
	laUlrBusquedaActual = url;  
} 

function getPingTimeListarNuevos() {
	return pingTimeListarNuevos;
}
function setPingTimeListarNuevos(time) {
	pingTimeListarNuevos = time; 
}

function getPingTimeEstadoPeticion() {
	return pingTimeEstadoPeticion;
}
function setPingTimeEstadoPeticion(time) {
	pingTimeEstadoPeticion = time; 
}
function getPingTimeQuitarRecientes() {
	return pingTimeQuitarRecientes;
}
function setPingTimeQuitarRecientes(time) {
	pingTimeQuitarRecientes = time; 
}

function startTimer(duration) {
    var start = Date.now(),
        diff,
        minutes,
        seconds;
    function timer() {
        // get the number of seconds that have elapsed since 
        // startTimer() was called
        diff = duration - (((Date.now() - start) / 1000) | 0);

        // does the same job as parseInt truncates the float
        minutes = (diff / 60) | 0;
        seconds = (diff % 60) | 0;

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        if (diff <= 0) {
            // add one second so that the count down starts at the full duration
            // example 05:00 not 04:59
            start = Date.now() + 1000;
        }
    };
    // we don't want to wait a full second before the timer starts
    timer();
    setInterval(timer, 1000);
}

function stopTimer() {
	clearTimeout(startTimer);
}

function formatearFecha(longDate) {
	var momentoFecha = moment(longDate);
	var momentoFechaFinal = momentoFecha.format("DD/MM/YYYY");
	return momentoFechaFinal;
}

function oBw(theURL,winName,features) { 
	window.name='pPal';  
	var handler = window.open(theURL,winName,features);
	if (!handler || handler == null) { alert('No se pudo abrir una ventana emergente.\nPor favor compruebe si su navegador tiene habilitado un bloqueador de ventanas emergentes.');}
}

function establecerFechasParciales() {
	 
	if (preferenciaComisionDocente && preferenciaComisionDocente!="null") { 
	    var arr = preferenciaComisionDocente.split(',');
	    var primerElemento = arr[0].trim();
	    var ultimoElemento = arr[arr.length-1];
	    var ultimoElementoEntero = ultimoElemento.trim();
	    var ffp = (+ultimoElementoEntero)+1; 
	    fechaIniciaParciales = "01/01/"+arr[0];	 
	    fechaFinalParciales = "01/01/"+ffp;
	} else {

	}
    	
}

function iRf(i,p) { 
	$("#fE").remove();	
	var elForm = '<form id="fE" name="fE" method="post" action="https://www.frc.utn.edu.ar/academico3/ver.frc"><input type="hidden" name="t" value="'+i+'"><input type="hidden" name="p" value="'+p+'"></form>';
	$("body").append(elForm);
	$("#fE").submit();	
}

/* convierte las url con la version correspondiente de autogestion */
jQuery.urlCompleta = function(url) {
	return "/" + version + "/" + url;
};
/* convierte las url con los parametros del legajo y tipo de usuario */
jQuery.convertirUrl = function(url) {
	var laUrl = url;
	var cambio = laUrl.replace(/{legajo}/gi, getLegajo()).replace(/{tipousuario}/gi, getTipoUsuarioNombre()).replace(/{especialidad}/gi, getEspecialidad()).replace(/{plan}/gi,getPlan());	
	//funcion cambiada por jose para que no envie el tipo de usuario
	//var cambio = laUrl.replace(/{legajo}/gi, getLegajo()).replace(/{especialidad}/gi, getEspecialidad()).replace(/{plan}/gi,getPlan());
	return cambio;
};
jQuery.imagenPerfil = function(nombreImagen,extra,tamanio,tipo) {
	var nombreImagenFinal = '';			

	if (nombreImagen==null || nombreImagen.length==0) {
		nombreImagen =  "" ;
	}
	
	if (tipo=="GRUPO") { // || tipo=="GRUPO ACADEMICO" 
		nombreImagenFinal = '<i class="fa fa-group"> </i>  <span style="vertical-align: top;font-weight:bold;">Grupo</span>';
	} else if (tipo=="GRUPO ACADEMICO") { 
		nombreImagenFinal = '<i class="fa fa-group"> </i>  <span style="vertical-align: top;font-weight:bold;">Comisión</span>';
	} else if (tipo=="DEPARTAMENTO") {
		nombreImagenFinal = '<i class="fa fa-institution"> </i>  <span style="vertical-align: top;font-weight:bold;">Dpto</span>';
	} else if (tipo=="CATEDRA") {
		nombreImagenFinal = '<i class="fa fa-graduation-cap"> </i>  <span style="vertical-align: top;font-weight:bold;">Cátedra</span>';
	} else {
		if (usuarioPublicoFotoPerfil(nombreImagen)) {
			nombreImagenFinal = '<img src="'+ urlFotoPerfil(nombreImagen) +'" title="Perfil ' + extra + '" class="hoverImage img-circle" width="' + tamanio + '" />';
		} else {
			extra ="";
			nombreImagenFinal = '<i class="fa fa-user"> </i>  <span style="vertical-align: top;font-weight:bold;">'+extra+'</span>';
		}
	}
 
	return nombreImagenFinal;
	
};

jQuery.aniosAcademicos = function(a) {
	var items = [];

	if (getTipoUsuario()=="A" || getTipoUsuario()=="D") {
		for (i = anioActual; i >= anioIngreso; i--) {
			items.push('<li><a href="'+ i + '">' + i + '</a></li>');
		}

	} else {
		if (preferenciaComisionDocente) { 
		    var arr = preferenciaComisionDocente.split(',').reverse();
		    var i;
	
		    for(i in arr){
		        items.push('<li><a href="'+ arr[i] + '">' + arr[i] + '</a></li>');
		    }	
		}
	} 
	$('<ul/>', {
		'class' : 'aniosAcademicos dropdown-menu pull-right scrollable-menu',
		html : items.join('')
	}).appendTo(a);
};

$.aniosAcademicos("#contenedorCursando .box-header .box-tools .btn-group");
$.aniosAcademicos("#contenedorGrupos .box-header .box-tools");
establecerFechasParciales();

function usuarioPublicoFotoPerfil(valor) {
	res = false;

	if (valor==null || valor.length==0) {
		res = false;
	} else {
		res = true;
		if (valor.indexOf("avatar") >= 0) {
			res = false;
		} else {
			res = true;
		}
	}
	return res;
}; 

function urlFotoPerfil(valor) {
	/**/
	if (fotoPerfil!="") {

		if (fotoPerfil.indexOf("avatar") >= 0) {
			caminoImagenPerfil = imagenPerfilPorDefecto
			valor='';
		} else {
			caminoImagenPerfil = urlRecursos;
		}
		
		imagenPerfil = $.urlCompleta(caminoImagenPerfil + valor);
		
	}
	return imagenPerfil;

}; 



/*
$(".fotoPerfilUsuario").error(function(){
		$(this).attr("src",imagenPerfilPorDefecto);	  
});
*/



//if (getLegajo()=="35897") { $("#menuContribuciones").show(); }


function fotoAcademica() {
	var xhrFotoAcademica = new XMLHttpRequest();
	xhrFotoAcademica.onreadystatechange = function(){
	    if (this.readyState == 4 && this.status == 200){
	        var img = document.getElementsByClassName("fotoPerfilUsuario");
	        var url = window.URL || window.webkitURL;
	        img.src = url.createObjectURL(this.response);
	    }
	}
	var laUrl = imagenPerfil = $.urlCompleta("archivo/foto/academica");
	xhrFotoAcademica.open('GET', laUrl);
	xhrFotoAcademica.setRequestHeader("A4-Token", A4Token);
	xhrFotoAcademica.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	xhrFotoAcademica.setRequestHeader("A4-Data", A4Data);		
	xhrFotoAcademica.responseType = 'blob';
	xhrFotoAcademica.send();      
}

function estadoFidelizacionMail() {
	if (!mails) return;
	
	var jsonMails = JSON.parse(mails);
	
	for(i in jsonMails) {
	    var tipo = jsonMails[i].nombre;
	    var estado = jsonMails[i].valor;
	    var mail = jsonMails[i].id; 
	    
	    if (tipo=='PERSONAL') {
	    	return [estado,mail]
	    } else {
	    	return null;
	    }	     
	}	
}


function htmlMails(withSelectItem) {
	
	if (!mails) return;
	
	var jsonMails = JSON.parse(mails);
	
	var initSelect = "<select>";
	var endSelect = "</select>";
	var fullSelect = "";
	if (withSelectItem) {
		initSelect = initSelect + '<option>' + withSelectItem + '</option>';
	}	

	for(i in jsonMails) {
	    var elNombre = jsonMails[i].id;
	    var tipo = jsonMails[i].nombre;
	    fullSelect = fullSelect + '<option>' + elNombre + '('+tipo+')</option>'; 
	}	
	var fullSelectEnded = initSelect + fullSelect + endSelect;
	return fullSelectEnded;

}

//Calendar
$('#calendar').fullCalendar({
	lang: 'es',
    editable: true,
    header: {
        left: 'today',
        center: 'title',
        right: 'prev,next'
      	}, 	
   	dayClick: function(date, jsEvent, view) {
   		$(".fc-state-highlight").removeClass("fc-state-highlight");
        $("td[data-date="+date.format('YYYY-MM-DD')+"]").addClass("fc-state-highlight");
    },
   	selectable: true,
   	selectHelper: true,
	eventLimit: true, // allow "more" link when too many events
	nowIndicator: true,
	/*
   	select: function(start, end) {   		
   		abrirModalEventos(start,end);	   		
	},
	*/    	
    eventRender: function(event, element) {
    	var overPopup = false;
    	element.popover({
    		container:'body',
            title: event.title,
            html:true,
            content: event.description,
            placement:'auto',
            trigger:'click',
        }).mouseover(function (e) {
            // when hovering over an element which has a popover, hide
            // them all except the current one being hovered upon
            $('[rel=popover]').not('#' + $(this).attr('id')).popover('hide');
            var $popover = $(this);
            $popover.popover('show');

            // set a flag when you move from button to popover
            // dirty but only way I could think of to prevent
            // closing the popover when you are navigate across
            // the white space between the two
            /**/
            $popover.data('popover').tip().mouseenter(function () {
                overPopup = true;
            }).mouseleave(function () {
                overPopup = false;
                $popover.popover('hide');
            });/**/

        }).mouseout(function (e) {
            // on mouse out of button, close the related popover
            // in 200 milliseconds if you're not hovering over the popover
        	//var $popover = $(this);
        	//$popover.popover('hide');
        	/**/
            var $popover = $(this);
            setTimeout(function () {
                if (!overPopup) {
                    $popover.popover('hide');
                }
            }, 200);
            /**/
        });
    }
              
});

$('td .fc-day-number .fc-mon .fc-today .fc-state-highlight').append(' <div style="padding-top:3px;padding-left:4px;">HOY </div>');

/* ADDING EVENTS */
var currColor = "#3c8dbc"; //Red by default
//Color chooser button
var colorChooser = $("#color-chooser-btn");
$("#color-chooser > li > a").click(function (e) {
  e.preventDefault();
  //Save color
  currColor = $(this).css("color");
  //Add color effect to button
  $('#add-new-event').css({"background-color": currColor, "border-color": currColor});
});


/**
 * @constructor
 */
function Cache() {
	this._data = {};
}
/**
 * Agrega o reemplaza un elemento del cache
 * 
 * @param {String}
 *            key
 * @param {Object}
 *            value
 */
Cache.prototype.set = function(key, value) {
	this._data[key] = value;
};

/**
 * Agrega o reemplaza un elemento del cache
 * 
 * @param {String}
 *            key
 * @return {Object} value
 */
Cache.prototype.get = function(key) {
	return this._data[key];
};

function listarNotas(id,texto) {
	var _id = $(this).closest("li").attr("id");
//	var id = _id.replace("idCurso","");
//	var texto = $(this).closest("li").find("span").text();
	var titulo = '<i class="fa fa-pencil"></i> Parciales de  ' + texto;
	

	var elMarcador = "100";
	var tablaMarcador = "tabla" + id;
	var jTablaMarcador = "#tabla" + id;

	var configuracionAtributosGrilla;
	url = "/4/cursado/materias/notas/"+id;
	
	var arrayEncabezadoMapeo = (new Function("return 'comision','nota1','nota2','nota3','nota4','nota5','nota6','nota7','nota8','nota9','nota10','notafinal'"))();
	var arrayEncabezadoTitulo = (new Function('return [{ "sTitle": "Comision" },{ "sTitle": "P1" },{ "sTitle": "P2"},{ "sTitle": "P3"},{ "sTitle": "P4"},{ "sTitle": "P5"},{ "sTitle": "P6" },{ "sTitle": "P7" },{ "sTitle": "P8"},{ "sTitle": "P9"},{ "sTitle": "P10" },{ "sTitle": "NotaFinal" }];'))();
	
	var estaAbierto = $("#dialogoEnlacesBases").data('bs.modal').isShown;
	
	$("#dialogoEnlacesBases").find("table").animate({
	   heigth: "toggle",
	   opacity: "toggle"
	 }, "slow" );
	
	//abrirModalGeneral(titulo, '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '"></table>',true,true, 1);
	
	var titulo = "";
	$.ajax(configuracion.urlCompleta("academico/notas/titulos/")+ id, {
		dataType : "text"
		}).done(function(data) {
			$("#dialogoEnlacesBases .modal-body").append('<button type="button" id="volverDialogoEnlacesBases" class="btn navbar-btn navbar-left btn-success"><span class="fa fa-reply"></span> Volver </button><table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '" style="display:none"></table>');
			
			titulo = data;
			var losTitulo = titulo.trim().toString().split("|");
			var tableHeaders = "";
			tableHeaders += "<th>Comisión</th>";
			for (i = 0; i < losTitulo.length; i++) {					    
                tableHeaders += "<th>" + losTitulo[i] + "</th>";
			}					
			
			$(jTablaMarcador).find("thead").remove();						
			$('<thead><tr>' + tableHeaders + '</tr></thead>').appendTo(jTablaMarcador);

			
			$(jTablaMarcador).DataTable( {
		        "ajax": {
		            "url": url,
	            	"dataSrc": function(data) {
	            		if(data=="no data" || data==null) {
	            			return [];
		            	} else {
		            		return data;
		            	}
		            }		            	
		        },
				"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":false,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}},						        
		        "columns": [
				            { "data": "comision","visible": false },
				            { "data": "nota1" },
				            { "data": "nota2" },
				            { "data": "nota3" },
				            { "data": "nota4" },
				            { "data": "nota5" },
				            { "data": "nota6" },
				            { "data": "nota7" },
				            { "data": "nota8" },
				            { "data": "nota9" },
				            { "data": "nota10" },
				            { "data": "notafinal" }
				        ]				        
			});
			
			$(jTablaMarcador).animate({
				   width: "toggle",
				   opacity: "toggle"
				 }, "slow" );
				
			
		});
	
	

}

function listarHorariosCuatrimestre(id,curso) {
	var _id = $(this).closest("li").attr("id");
	var titulo = '<i class="fa fa-pencil"></i> ' + id +' Cuatrimestre - Curso:' + curso;
	

	var elMarcador = "400999";
	var tablaMarcador = "tabla" + id;
	var jTablaMarcador = "#tabla" + id;
	var configuracionAtributosGrilla;
	url = "/4/cursado/horarios/cuatrimestre/"+ id + "/"+curso;
	
	var arrayEncabezadoMapeo = (new Function("return 'materia','diaSemana','desde','hasta','duracion','recreos'"))();
	var arrayEncabezadoTitulo = (new Function('return [{ "sTitle": "Materia" },{ "sTitle": "Días" },{ "sTitle": "Desde"},{ "sTitle": "Hasta"},{ "sTitle": "Duracion"},{ "sTitle": "Recreos"}];'))();
	
	var estaAbierto = $("#dialogoEnlacesBases").data('bs.modal').isShown;
	
	$("#dialogoEnlacesBases").find("table").animate({
	   heigth: "toggle",
	   opacity: "toggle"
	 }, "slow" );
	

	$("#dialogoEnlacesBases .modal-body").append('<button type="button" id="volverDialogoEnlacesBases" class="btn navbar-btn navbar-left btn-success"><span class="fa fa-reply"></span> Volver </button><table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '" style="display:none"></table>');
	
	var arrayColumnas = ["Materia" ,"Días","Desde","Hasta","Duración","Recreos"];		
	var losTitulo = arrayColumnas;
	var tableHeaders = "";
	for (i = 0; i < losTitulo.length; i++) {					    
        tableHeaders += "<th>" + losTitulo[i] + "</th>";
	}					
	
	$(jTablaMarcador).addClass("table table-bordered table-striped dataTable no-footer");
	$(jTablaMarcador).find("thead").remove();						
	$('<thead><tr>' + tableHeaders + '</tr></thead>').appendTo(jTablaMarcador);

	$(jTablaMarcador).DataTable( {
	    "ajax": {
            "url": url,
            "dataSrc": ""
        },
    "aaSorting": [],
    "order": [],    
	"bPaginate":false,
	"bLengthChange":false,
	"bInfo":false,
	"bAutoWidth":true,
	"bFilter":false,
	"bJQueryUI":false,
	"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}},						        
    "columns": [
	            { "data": "materia" },
	            { "data": "diaSemana" },
	            { "data": "desde" },
	            { "data": "hasta" },
	            { "data": "duracion" },
	            { "data": "recreo" }
	        ]	
	});

	$(jTablaMarcador).animate({
		   width: "toggle",
		   opacity: "toggle"
	}, "slow" );
				
}



function listarMovimientos(id,texto) {
	var _id = $(this).closest("li").attr("id");
	var titulo = '<i class="fa fa-pencil"></i> Movimientos del Expediente  ' + texto;
	

	var elMarcador = "300999";
	var tablaMarcador = "tabla" + id;
	var jTablaMarcador = "#tabla" + id;
	var configuracionAtributosGrilla;
	url = "/4/expedientes/movimientos/"+ id + "";
	
	var arrayEncabezadoMapeo = (new Function("return 'id','orden','fechaIngreso','departamentoIngreso','fechaEgreso','departamentoEgreso','estado','observacion','enlace'"))();
	var arrayEncabezadoTitulo = (new Function('return [{ "sTitle": "Identificador" },{ "sTitle": "Orden" },{ "sTitle": "FechaIngreso"},{ "sTitle": "DepartamentoEgreso"},{ "sTitle": "Estado"},{ "sTitle": "Observacion"},{ "sTitle": ""}];'))();
	
	var estaAbierto = $("#dialogoEnlacesBases").data('bs.modal').isShown;
	
	$("#dialogoEnlacesBases").find("table").animate({
	   heigth: "toggle",
	   opacity: "toggle"
	 }, "slow" );
	

	$("#dialogoEnlacesBases .modal-body").append('<button type="button" id="volverDialogoEnlacesBases" class="btn navbar-btn navbar-left btn-success"><span class="fa fa-reply"></span> Volver </button><table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '" style="display:none"></table>');
	
	var arrayColumnas = ["Identificador" ,"Orden","Fecha Ingreso","Departamento Ingreso","Fecha Egreso","Departamento Egreso","Estado","Observación",""];		
	var losTitulo = arrayColumnas;
	var tableHeaders = "";
	for (i = 0; i < losTitulo.length; i++) {					    
        tableHeaders += "<th>" + losTitulo[i] + "</th>";
	}					
	
	$(jTablaMarcador).find("thead").remove();						
	$('<thead><tr>' + tableHeaders + '</tr></thead>').appendTo(jTablaMarcador);

	$(jTablaMarcador).DataTable( {
	    "ajax": {
            "url": url,
            "dataSrc": ""
        },
	"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":false,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}},						        
    "columns": [
	            { "data": "id","visible": false },
	            { "data": "orden" },
	            { "data": "fechaIngreso" },
	            { "data": "departamentoIngreso" },
	            { "data": "fechaEgreso" },
	            { "data": "departamentoEgreso" },
	            { "data": "estado" },
	            { "data": "observacion" }
	        ]	
	});

	$(jTablaMarcador).animate({
		   width: "toggle",
		   opacity: "toggle"
	}, "slow" );
				
}

function  ClickOnItem(_pIdItem)
{
	
	var _idMarcador =_pIdItem;
	var mensaje = Autogestion.Mensaje;

	switch(_idMarcador) {
    case "lnkRecibidosm":
    case"btnListarMensajesNuevos":
    	mensaje.listar("/recibidos");
        break;
    case "lnkAutorizados":
    	mensaje.listar("/list/autorizados");
        break;
    case "lnkMeHanBloqueado":
    	mensaje.listar("/list/mehanbloqueado");
        break;
    case "lnkQueHazBloqueado":
    	mensaje.listar("/list/quehazbloqueado");
        break;
        
        
    case "lnkAutorizacionesSolicitadas":
    case "btnListarMisSolicitudesPendientesdeAutorizar":
    	mensaje.listar("/list/missolicitudes");
        break;
        
        
    case "lnkAutorizacionesParaAutorizar":
    case "btnListarSolicitudesdeAutorizaciondeOtros":
    	mensaje.listar("/list/paraautorizar");
        break;
        
    case "lnkSolicitudesPendientes":
    	mensaje.listar("/list/pendientes");
        break;
    case "lnkOcultosm":
    	mensaje.listar("/list/ocultos");
        break;
    case "lnkLeidosm":
    	mensaje.listar("/list/leidos");
        break;
    case "lnkTodos":
        break;    
    default:
        mensaje.listar("");
}

}

var fechaActualDelCalendario = $('#calendar').fullCalendar('getDate');

$('body').on('click', '#volverDialogoEnlacesBases', function() {
	$("#dialogoEnlacesBases").find("table").animate({
		   heigth: "toggle",
		   opacity: "toggle"
		 }, "slow" );
	$("#dialogoEnlacesBases").find("table:eq(1)").remove();
	this.remove();
});

$('body').on('click', 'button.fc-prev-button', function() {
	  var moment = $('#calendar').fullCalendar('getDate');
	    //alert("PREV The current date of the calendar is " + moment.format());
	    var dif = moment.diff(fechaActualDelCalendario, 'days');
	    if (dif>120) {
	    	//console.log("volver a obtener info del calendario");
	    }
});

$('body').on('click', 'button.fc-next-button', function() {
	  var moment = $('#calendar').fullCalendar('getDate');
	   // alert("NEXT The current date of the calendar is " + moment.format());
	    var dif = moment.diff(fechaActualDelCalendario, 'days');
	    if (dif>120) {
	    	//console.log("volver a obtener info del calendario");
	    }

});

$('body').on('click', '#contenedorNotificaciones li a', function(e) {
	e.preventDefault();
	var _idMarcador = $(this).attr("id");
	
	if (!_idMarcador)
	{
		return;
	}
	
	ClickOnItem(_idMarcador);
});

var Autogestion = {
	Configuracion : {
		/* convierte las url con la version correspondiente de autogestion */
		urlCompleta : function(url) {
			return "/" + version + "/" + url;
		},
		urlCompletaSlash : function(url,slash) {
			var hasSlash = "";
			if (slash) { hasSlash = slash; }
			return "/" + version + hasSlash  + url;
		},
		/* convierte las url con los parametros del legajo y tipo de usuario */
		convertirUrl : function(url) {
			var cambio = '';
			var laUrl = url;
			if (laUrl != null) {
				//funcion cambiada por jose para que no envie el tipo de usuario se quita .replace(/{tipousuario}/gi, getTipoUsuarioNombre())
				cambio = laUrl.replace(/{legajo}/gi, getLegajo()).replace(/{tipousuario}/gi, getTipoUsuarioNombre()).replace(/{especialidad}/gi, getEspecialidad());
			}
			return cambio;
		},
		menu : function() {
			$("#menuMensaje li a,#menuContactos li a,#menuAutorizaciones li a").on('click', function(event) {
				
				var _idMarcador = $(this).attr("id");
				if (!_idMarcador)
				{
					return;
				}
				event.preventDefault();
				
				ClickOnItem(_idMarcador);			
		
			});
			var urlConfigMenu = "config/menu/" + getTipoUsuario().toUpperCase();
			$.getJSON(configuracion.urlCompleta(urlConfigMenu), {}, function(data) {
				var itemsCursado = [];
				var itemsExamen = [];
				var itemsMateria = [];
				var itemsBiblioteca = [];
				var itemsTramite = [];
				var itemsConstancia = [];
				
				$.each(data, function(key, val) {
					var laCategoria = val.categoria.trim();
					var elEnlace = val.enlace;
					var enlaceFinal = '';
					if (elEnlace != null && laCategoria != "Tramite") {
						enlaceFinal = configuracion.urlCompletaSlash($.convertirUrl(elEnlace),"");
					}

					if (laCategoria == "Cursado") {
						itemsCursado.push('<li id="mnu' + val.idMarcador+ '"><a href="' + enlaceFinal + '" id="e'+ val.idMarcador+ '"><i class="fa fa-angle-double-right"></i> '+ val.nombre + '</a></li>');
					}
					if (laCategoria == "Exámen") {
						itemsExamen.push('<li id="mnu' + val.idMarcador+ '"><a href="' + enlaceFinal + '" id="e'+ val.idMarcador+ '"><i class="fa fa-angle-double-right"></i> '+ val.nombre + '</a></li>');
					}
					if (laCategoria == "Materia") {
						itemsMateria.push('<li id="mnu' + val.idMarcador+ '"><a href="' + enlaceFinal + '" id="e'+ val.idMarcador+ '"><i class="fa fa-angle-double-right"></i> '+ val.nombre + '</a></li>');
					}
					if (laCategoria == "Biblioteca") {
						itemsBiblioteca.push('<li id="mnu' + val.idMarcador+ '"><a href="' + enlaceFinal + '" id="e'+ val.idMarcador+ '"><i class="fa fa-angle-double-right"></i> '+ val.nombre + '</a></li>');
					}					
					if (laCategoria == "Tramite") {
						itemsTramite.push('<li ><a href="'+ elEnlace +'" data-idtramite="' + val.idMarcador +'"  id="mnu' + val.idMarcador +'"  data-local="S" ><i class="fa fa-angle-double-right"></i> '+ val.nombre +'</a></li>');
					}					
					if (laCategoria == "Constancia") {
						itemsConstancia.push('<li ><a href="'+ elEnlace +'" data-idtramite="' + val.idMarcador +'"  id="mnu' + val.idMarcador +'"  data-local="S" ><i class="fa fa-angle-double-right"></i> '+ val.nombre +'</a></li>');
					}
				});

				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsCursado.join('')
				}).appendTo('#menuCursado');

				$("#menuCursado li a").on('click', function(event) {
					event.preventDefault();
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("e", "");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador, enlace, $(this));
				});

				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsExamen.join('')
				}).appendTo('#menuExamen');

				$("#menuExamen li a").on('click', function(event) {
					event.preventDefault();
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("e", "");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador, enlace, $(this));
				});
				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsMateria.join('')
				}).appendTo('#menuMateria');

				$("#menuMateria li a").on('click', function(event) {
					event.preventDefault();
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("e", "");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador, enlace, $(this));
				});

				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsBiblioteca.join('')
				}).appendTo('#menuBiblioteca');
				
				
				$("#menuBiblioteca li a").on('click', function(event) {
					event.preventDefault();
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("e", "");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador, enlace, $(this));
				});
				
			
				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsTramite.join('')
				}).appendTo('#menuTramitesA4');

				$("#menuTramitesA4 li a").on('click', function(event) {
					event.preventDefault();
					var enlace = ($(this).attr("href"));//.toLowerCase();
					var tipo = $(this).data("local")
					var idTramite = $(this).data("idtramite")
					if (idTramite==149)
					{
						document.location = '/4/tramite/preinscripcion/grado';
					}
					else
					{
						if(tipo && tipo =="S")
							abrirModalV4(enlace);
						else
							abrirModalV3(enlace);
					}
				});
						
				if (itemsConstancia.length==0) {
					$("#menuConstanciasA4").hide();
				}
				
				if (itemsTramite.length==0) {
					$("#menuTramitesA4").hide();
				}				
				
				$('<ul/>', {
					'class' : 'treeview-menu',
					html : itemsConstancia.join('')
				}).appendTo('#menuConstanciasA4');
				/*
				$("#rmenu").on('click', function(event) {
					event.preventDefault(); 
					var enlace = ($(this).attr("href"));
					$.ajax({
						url: enlace,
						type: "GET",
						dataType:"json"
						}).done(function(data) {
							console.log(data);
						});
					
				});
				*/
				$("#menuConstanciasA4 li a").on('click', function(event) {
					event.preventDefault();
					var enlace = ($(this).attr("href"));//.toLowerCase();
					var tipo = $(this).data("local")
					var idTramite = $(this).data("idtramite")
					if(tipo && tipo =="S")
						abrirModalV4(enlace);
					else
						abrirModalV3(enlace);
				});
				
				$("#menuExpediente a").on('click', function(event) {
					event.preventDefault();
					
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("e", "");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador, enlace, $(this));
				});
			});
		}
	},
	Ayuda : {
		url : function() {
			var config = this.configuracion();
			var urls = config.urlCompleta("ayuda/");
			return urls
		},
		configuracion : function() {
			return Autogestion.Configuracion;
		},

		mensajeSistema : function() {
			var sms = {
				agregar : {
					tipo : "agregar",
					titulo : "Felicitaciones",
					descripcion : "Se ha agregado un nuevo Favorito",
					error : "No se guardo el Favorito."
				},
				eliminar : {
					tipo : "eliminar",
					titulo : "Advertencia",
					descripcion : "Esta seguro que desea eliminar el Favortio?",
					error : "No se pudo eliminar el Favorito."
				},
				error : {
					tipo : "error",
					titulo : "Error",
					descripcion : "No se pudo eliminar el Favorito.",
					error : ""
				}
			};
			return sms;
		},
		obtener : function(id) {
			var config = this.configuracion();
			var laUrl = this.url() + id;

			$.ajax({
				url : laUrl,
				type : 'GET',
				dataType : "html",
				async : false				
			}).done(function(data) {
				var d = "";
				if (data) {
					d=data;
				} else {
					d="No se encuentra la ayuda buscada. ";
				}
				abrirModalGeneral("Ayuda Principal", d ,true,false,0);
				
			}).fail(function(data) {				
				notificar('danger', 'No se pudo obtener la ayuda correspondiente.');
			});
		},
	},	
	Favorito : {
		url : function() {
			var config = this.configuracion();
			var urls = config.urlCompleta("favoritos/");
			return urls
		},
		configuracion : function() {
			return Autogestion.Configuracion;
		},

		mensajeSistema : function() {
			var sms = {
				agregar : {
					tipo : "agregar",
					titulo : "Felicitaciones",
					descripcion : "Se ha agregado un nuevo Favorito",
					error : "No se guardo el Favorito."
				},
				eliminar : {
					tipo : "eliminar",
					titulo : "Advertencia",
					descripcion : "Esta seguro que desea eliminar el Favortio?",
					error : "No se pudo eliminar el Favorito."
				},
				error : {
					tipo : "error",
					titulo : "Error",
					descripcion : "No se pudo eliminar el Favorito.",
					error : ""
				}
			};
			return sms;
		},

		agregar : function(id) {
			var config = this.configuracion();
			var laUrl = this.url() + id;
			var f = Autogestion.Favorito;

			$.ajax({
				url : laUrl,
				type : 'POST',
			}).done(function(data) {
				f.refrescar();
			}).fail(function(data) {
				abrirModal(id, f, f.mensajeSistema().error);
			});
		},
		eliminar : function(id) {
			var config = this.configuracion();
			var item = "#itemFavorito" + id;
			var f = Autogestion.Favorito;

			$.ajax({
				url : config.urlCompleta("favoritos/") + id,
				type : 'DELETE',
			}).done(function(data) {
				$(item).remove();
			}).fail(function(data) {
				abrirModal(id, f, f.mensajeSistema().error);
			});
		},
		listar : function() {
			var config = this.configuracion();
			var ec = overlay.clone();
			$("#contenedorFavoritos").prepend(ec);
			$.getJSON(config.urlCompleta("favoritos"),{},function(data) {
				var items = [];
				
				$.each(data,function(key, val) {
					var idFavorito = val.idFavorito;
					var enlace = config.convertirUrl(val.enlace);
					var enlaceFinal = enlace;
					var nombre = val.nombre;
					var fechaCrea = moment(val.fechaCreacion);
					var fechaFinal = fechaCrea.format("DD/MM/YYYY");

					items.push('<li id="itemFavorito'+ idFavorito+ '"><span class="text"><a href="'+ enlaceFinal+ '" id="itemFavoritoMarcador'+ val.idMarcador+ '">'+ nombre+ '</a></span><small class="label label-info" title="Fecha Creación '+ fechaFinal+ '"><i class="fa-regular fa fa-clock"></i> '+ fechaFinal+ '</small><div class="tools"><a href="#"><i class="fa fa-trash" id="itemFavoritoEliminar'+ idFavorito+ '" data-toggle="tooltip" title="Eliminar Favorito"></i></a></div></li>');

				});

				if (items.length == 0) {
					items.push('<li class="itemVacio"><span class="text">No existen favoritos. Agrega nuevos con el ícono <i class="fa fa-heart"></i></span></li>');					
				}
				
				$('<ul/>', {
					'id' : 'listaFavoritos',
					'class' : 'todo-list',
					html : items.join('')
				}).appendTo('#contenedorListaFavoritos');

				if (items.length>=4) {
					$('#contenedorListaFavoritos').slimScroll({
				        height: altoGeneral
				    });						
				}
				
				if (preferenciaBarraFavorito=="1") {
				/*
					var listaFavoritosHtmlFinal = items.join('');
					
					var listaFavoritosSize = $("#listaFavoritos li :not(.itemVacio)").size();
					var barra = '<li class="dropdown favoritos-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-heart-o"></i><span class="label label-success">'+listaFavoritosSize+'</span></a><ul class="dropdown-menu">'+listaFavoritosHtmlFinal+' </ul></li>';
					
					agregarTopBar(barra);
					
					$("#btnQuitarFavoritos").trigger('click');
					*/
				}
				
				
				$("#listaFavoritos li span a").on('click',function(event) {
					event.preventDefault();
					var _idMarcador = $(this).attr("id");
					var idMarcador = _idMarcador.replace("itemFavoritoMarcador","");
					var enlace = ($(this).attr("href")).toLowerCase();
					armarTabla(idMarcador,enlace, $(this));
				});

				$("#listaFavoritos li div.tools i.fa-trash").on({click : function() {
					var _id = $(this).attr("id");
					var id = _id.replace("itemFavoritoEliminar","");

					var f = Autogestion.Favorito;
					var m = f.mensajeSistema().eliminar;
					abrirModal(id, f, m);
					}
				});

			}).always(function() {
				var esteOverlay = $("#contenedorFavoritos").find(ec);
				esteOverlay.animate({opacity : 0.25}, 1000, function() {
						$(this).remove();
					});
				});
		},
		refrescar : function() {
			var cantidad = 0;
			cantidad = $("#listaFavoritos li").size();
			if (cantidad > 0) {
				$("#listaFavoritos").remove();
				var f = Autogestion.Favorito;
				f.listar();
			}
		},
		buscarLocal : function(id) {
			var existe = false;
			var idMarcador = id.trim();
			$("#listaFavoritos li div a:not(div.botonEliminar a)").each(
					function() {
						var idItem = $(this).attr("id");
						var elId = idItem.replace("e", "").trim();
						if (idMarcador == elId) {
							return existe = true;
						}
					});
			return existe;
		}
	},
	Contacto : {
		url : function() {
			var config = this.configuracion();
			var urls = config.urlCompleta("mensajes/");
			return urls
		},
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		listar : function(pFuncion) {
			var config = this.configuracion();
			var ec = overlay.clone();
			$("#contenedorContactos").prepend(ec);
			$.getJSON(config.urlCompleta("mensajes/solicitudes"),{},function(data) {
								var itemsAutorizados = [];// Autorizados
								var itemsQueMeBloquearon = [];// Bloqueados
								var itemsQueHazBloqueado = [];// que haz Bloqueado
								var itemsPendientes = [];// Pendientes de autorizacion

								var htmlItem = '';

								$.each(data,function(key, val) {
									var nombreDestino = val.nombreDestino;
									var nombreOrigen = val.nombreOrigen;
									var legajoOrigen = val.legajoOrigen;
									var legajoDestino = val.legajoDestino;
									var dominio = val.dominio;
									var tipo = val.estado;
									var bloqueEmail = val.bloqueaEmail;
									var id = val.id;
									if (legajoOrigen == legajo) {
										if (tipo == 'Autorizado') {
											itemsAutorizados.push('<li id ="itemMensaje_' + id + '"><span class="text"><a href="#" class="busquedaUsuario" data-id="'+legajoOrigen+'">'+ nombreDestino + ' (' + dominio + ')' + '</a></span><div class="tools"><a href="javascript:void(0)" class="btn btn-warning btn-xs ladda-button" id="itemAutorizacion_Bloquear_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-ban" ></i>&nbsp;Bloquear </a>&nbsp;<a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-down" ></i>&nbsp;Quitar </a></div></li>');// <a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-down" ></i>&nbsp;Rechazar </a>se agrego el boton rechazar para que este coherente las accciones entre contactos autorizados										
										} else if (tipo == 'Pendiente') {
											itemsPendientes.push('<li id ="itemMensaje_' + id + '"><i class="fa fa-sign-out" /><span class="text"><a href="#" class="busquedaUsuario" data-id="'+legajoOrigen+'">'+ nombreDestino + ' (' + dominio + ')' + '</a></span><div class="tools"><a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Cancelar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Cancelar </a></div></li>');
										}
									}
									
									if(legajoOrigen != legajo) {
									
										if (tipo == 'Pendiente') {
												itemsPendientes.push('<li id ="itemMensaje_' + id + '"><i class ="fa fa-sign-in" /><span class="text"><a href="#" class="busquedaUsuario" data-id="'+legajoOrigen+'">'+ nombreDestino  + ' (' + dominio + ')' + '</a></span><div class="tools"><a href="javascript:void(0)" class="btn btn-success btn-xs ladda-button" id="itemAutorizacion_Autorizar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-up"></i>&nbsp;Autorizar </a>&nbsp;<a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Rechazar </a></div></li>');
										}
										else if (tipo == 'Autorizado') {
											itemsAutorizados.push('<li id="itemMensaje_' + id + '"><span class="text"><a href="#" class="busquedaUsuario" data-id="'+legajoOrigen+'">'+ nombreDestino  + ' (' + dominio + ')' + '</a></span><div class="tools"><a href="javascript:void(0)" class="btn btn-warning btn-xs ladda-button" id="itemAutorizacion_Bloquear_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-ban" ></i>&nbsp;Bloquear </a>&nbsp;<a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-thumbs-down" ></i>&nbsp;Quitar </a></div></li>');										
										}
									}
									
									if (tipo == 'Bloqueado') {
										if (bloqueEmail.toLowerCase()==mail.toLowerCase())
											{
											var botoneraBloqueados= '<a href="javascript:void(0)" class="btn btn-warning btn-xs ladda-button" id="itemAutorizacion_Desbloquear_'+ id+ '" data-publicador="'+ legajoOrigen+ '"><i class="fa fa-ban" ></i>&nbsp;Desbloquear </a>&nbsp;<a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Reinvitar_'+ id+ '" data-publicador="'+ bloqueEmail +'" ><i class="fa fa-plus" title="Solicitar una nueva autorizacion"></i>&nbsp;</a>';
											itemsQueHazBloqueado.push('<li id ="itemMensaje_' + id + '"><span class="text"><a href="#" id="xitemGrupoEditar'+ nombreDestino  + '" data-type="text" title ="'  + legajoDestino + '" >'+ nombreDestino + ' (' + dominio + ')' + '</a></span><div class="tools">' + botoneraBloqueados + '</div></li>');//<small class="label label-info"><i class="fa-regular fa-clock-o"></i> '+ tipo+ ' miembros</small>
											}
										else
											{  //
												if (legajoOrigen==legajo)
												{	
													itemsQueMeBloquearon.push('<li id ="itemMensaje_' + id + '"><span class="text"><a href="#" id="xitemGrupoEditar'+ nombreDestino  + '" data-type="text" title ="'  + legajoDestino + '" >' + nombreDestino +   ' (' + dominio + ')</a></span><div class="tools"></div></li>');//<small class="label label-info"><i class="fa-regular fa-clock-o"></i> '+ tipo+ ' miembros</small>
												}
												else
												{
													itemsQueMeBloquearon.push('<li id ="itemMensaje_' + id + '"><span class="text"><a href="#" id="xitemGrupoEditar'+ nombreOrigen  +  '" data-type="text" title ="'  + legajoDestino + '" >' + nombreOrigen +  ' (' + dominio + ') </a></span><div class="tools"></div></li>');//<small class="label label-info"><i class="fa-regular fa-clock-o"></i> '+ tipo+ ' miembros</small>
												}
											}
											
									}  
								});

								if (itemsAutorizados.length == 0) {
									itemsAutorizados.push('<li><span class="text">No existen contactos autorizados. Agrega nuevos en <i class="fa fa-plus btn-success btn-sm" id="fireOpenNuevos"></i></span></li>');
								}

								if (itemsPendientes.length == 0) {
									itemsPendientes.push('<li><span class="text">No existen solicitudes pendientes</span></li>');
								}

								if (itemsQueMeBloquearon.length == 0) {
									// jose cambiamos de conecpto   en la lista se van a poner las personas que me han bloqueado  
									itemsQueMeBloquearon.push('<li><span class="text">Ninguna persona te ha bloqueado</span></li>');
								}
								if (itemsQueHazBloqueado.length == 0) {
									// jose cambiamos de conecpto   en la lista se van a poner las personas que me han bloqueado  
									itemsQueHazBloqueado.push('<li><span class="text">No has bloqueado a ninguna persona </span></li>');
								}
						
								$("#listaContactosAutorizados").remove();
								$("#listaContactosBloqueados").remove();
								$("#listaContactosQueMeBloquearon").remove();
								$("#listaContactosPendientes").remove();
								
								$('<ul/>', {
									'id' : 'listaContactosAutorizados',
									'class' : 'todo-list ui-sortable',
									html : itemsAutorizados.join('')
								}).appendTo('#tabContactosAutorizados');
								/*
								$('<ul/>', {
									'id' : 'listaContactosAutorizados',
									'class' : 'users-list clearfix',
									html : itemsAutorizados.join('')
								}).appendTo('#tabContactosAutorizados');
	 							*/
								$('<ul/>', {
									'id' : 'listaContactosPendientes',
									'class' : 'todo-list ui-sortable',
									html : itemsPendientes.join('')
								}).appendTo('#tabContactosPendientes');

								$('<ul/>', {
									'id' : 'listaContactosBloqueados',
									'class' : 'todo-list ui-sortable',
									html : itemsQueHazBloqueado.join('')
								}).appendTo('#tabContactosBloqueados');
								
								$('<ul/>', {
									'id' : 'listaContactosQueMeBloquearon',
									'class' : 'todo-list ui-sortable',
									html : itemsQueMeBloquearon.join('')
								}).appendTo('#tabContactosQueMeBloquearon');

								$("#contenedorContactos h3.box-title").text("Contactos Autorizados");

								$("#listaContactosAutorizados li div.tools i.fa-trash").on({click : function() {
									var _id = $(this).attr("id");
									var id = _id.replace("itemContactoEliminar","");
									}
								});

								$("#listaContactosAutorizados li div.tools i.fa-pencil").on({click : function(e) {
									var _id = $(this).attr("id");
									var id = _id.replace("itemContactoEditar","");							

									var idx = '#x' + _id;
									e.stopPropagation();
									$(idx).editable({
										type : 'text',
										url : '/4/compadres/'+ id,
										toggle : 'manual'
										});
									$(idx).editable('toggle');
									}
								});

								$("#listaContactosAutorizados li div.tools i.fa-plus").on({click : function(e) {
									var _id = $(this).attr("id");
									var id = _id.replace("itemContactoAgregar","");
									}
								});

							
			}).fail(function(data) {
				var esteOverlay = $("#contenedorContactos").find(ec);
				esteOverlay.animate({opacity : 0.25}, 1000, function() {
						$(this).remove();
					});
			}).always(function() {
								var esteOverlay = $("#contenedorContactos").find(ec);
								esteOverlay.animate({opacity : 0.25}, 1000, function() {
										$(this).remove();
									});
								
								if (typeof pFuncion==="function")
								{
									pFuncion();
								}

								
								});
		}
	},
	Grupo : {
		url : function() {
			var config = this.configuracion();
			var urls = config.urlCompleta("grupos/");
			return urls
		},
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		misc : function() {
			return Autogestion.Misc;
		},		
		mensajeSistema : function() {
			var sms = {
				agregar : {
					tipo : "agregar",
					titulo : "Felicitaciones",
					descripcion : "Se ha agregado un nuevo Grupo",
					error : "No se guardo el Grupo."
				},
				eliminar : {
					tipo : "eliminar",
					titulo : "Advertencia",
					descripcion : "Esta seguro que desea eliminar el Grupo?",
					error : "No se pudo eliminar el Grupo."
				},
				error : {
					tipo : "error",
					titulo : "Error",
					descripcion : "No se pudo eliminar el Grupo.",
					error : ""
				}
			};
			return sms;
		},

		agregar : function(nombre) {
			if (nombre.length<=3) {				
				notificar('warning', 'Ingrese al menos 3 letras!')
				return;
			}			 
			var config = this.configuracion();
			var laUrl = this.url() + nombre;
			$.ajax({
				url : laUrl,
				type : 'POST',
			}).done(function(data) {
				$("#txtGrupo").val('');
				var o = Autogestion.Grupo;
				o.refrescar();
			}).always(function(data) {
				$(data).find('respuestaRetorno').each(function() {
					var tipo = $(this).find('codigo').text();
					var mensajeResultado = $(this).find('mensaje').text();
					var valor = $(this).find('valor').text();
					notificar(tipo, mensajeResultado);
				});
			});
		},

		invitarContacto : function(id) {

			var _id = id.replace("btnAgregarMiembrosGrupoInvitacion", "");
			
			var idGrupo = id.split("|")[0];
			var idDestino = id.split("|")[1];
			var nombreGrupo = id.split("|")[2];

			var elMensaje = "";
			var textoMensajeIncial = "";
			var config = this.configuracion();
			var test = $('#destinatarioDialog');
			var jsonselecctions = $(test).select2('data');
			$("#divDestinatariosInformados2").empty();
			$("#itemRespuestasMensaje2").empty();
			var tamanioJson = jsonselecctions.length;
			for (var i = 0; i < tamanioJson; i++) {
				var iddestino = jsonselecctions[i].id;
				var tipo = jsonselecctions[i].categoria;
				var nombredestino = jsonselecctions[i].descripcion;
				elMensaje = elMensaje + ', ' + '<span><a href="#" data-id="'+iddestino+'">' + nombredestino.trim() + '</a></span>';
			}
			
			$('#destinatarioDialog').select2('data', null);
			$('#txtMensaje2').val("");
			
			if (tamanioJson>1) {
				textoMensajeIncial = "Agregar a los Usuarios ";
			} else {
				textoMensajeIncial = "Agregar a ";
			}
			 
			elMensaje = textoMensajeIncial + elMensaje + ' al Grupo <span><a href="#" data-id="'+idGrupo+'">' + nombreGrupo + '</a></span>';

			$.ajax({
				
				async : false,
				url : config.urlCompleta("mensajes/"),
				type : 'POST',
				data : {
					tipo : 'INVITACION' + idGrupo,
					destino : idDestino,
					mensaje : elMensaje
				}
			}).done(function(data) {				
			}).fail(function(data) {
			});
			
			
		},
		agregarContacto : function(id) {
			 //var person = {firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"};
			//var _id = id.replace("btnAgregarMiembrosGrupo", "");

			var config = this.configuracion();
			var test = $('#destinatarioDialog');
			var jsonselecctions = $(test).select2('data');
			$("#divDestinatariosInformados2").empty();
			$("#itemRespuestasMensaje2").empty();
			for (var i = 0; i < jsonselecctions.length; i++) {

				var iddestino = jsonselecctions[i].id;
				var tipo = jsonselecctions[i].categoria;
				var nombredestino = jsonselecctions[i].descripcion;

				$.ajax({
					async : false,
					url : config.urlCompleta("grupos"),
					type : 'POST',
					data : {
						destino : iddestino,
						id : id
					}
				}).done(function(data) {
					
					$(data).find('respuestaRetorno').each(function() {
						var tipo = $(this).find('codigo').text();
						var mensajeResultado = $(this).find('mensaje').text();
						var valor = $(this).find('valor').text();
						var itemGrupoAgregar = "itemGrupoAgregar" + id;
						$(itemGrupoAgregar).parent().find("small").text(valor);
						notificar(tipo, mensajeResultado);
					});

				}).fail(function(data) {
					var sMensajeResultado = "";
					$(data).find('mensaje').each(function() {
						sMensajeResultado = $(this).text();
					});
				});

			}
			$('#destinatarioDialog').select2('data', null);
			$('#txtMensaje2').val("");

		},
		eliminar : function(id) {
			var config = this.configuracion();
			var item = "#idGrupoPropio" + id;

			$.ajax({
				url : config.urlCompleta("grupos/") + id,
				type : 'DELETE',
			}).done(function(data) {
				//$(item).parent().parent().remove();
				$(item).fadeOut(300, function() {
			        $(this).remove();
			    });				
				//$(item).remove();
			}).fail(function(data) {
			}).always(function(data) {
				$(data).find('respuestaRetorno').each(function() {
					var tipo = $(this).find('codigo').text();
					var mensajeResultado = $(this).find('mensaje').text();
					notificar(tipo, mensajeResultado);
				});
			});
		},
		refrescar : function(tab) {
			var cantidadGruposPropios = 0;var cantidadGruposAcademicos = 0; var listar = 0; var listaGruposCatedra = 0; var cantidadGruposDirector = 0; 
			cantidadGruposPropios  = $("#listaGruposPropios li").size();
			cantidadGruposAcademicos  = $("#listaGruposAcademicos li").size();
			cantidadGruposCatedra = $("#listaGruposCatedra li").size();
			cantidadGruposDirector = $("#listaGruposDirector li").size();

			if (cantidadGruposPropios > 0) {
				$("#listaGruposPropios").remove();
			}
			if (cantidadGruposAcademicos > 0) {
				$("#listaGruposAcademicos").remove();
			}			
			if (cantidadGruposCatedra > 0) {
				$("#listaGruposCatedra").remove();
			}
			if (cantidadGruposDirector > 0) {
				$("#listaGruposDirector").remove();
			}

			var o = Autogestion.Grupo;
			o.listar();
		},

		listar : function(porTipo) {
			if (estadoModuloGrupos==0) {return;}
			var config = this.configuracion();
			var ec = overlay.clone();
			$("#contenedorGrupos").prepend(ec);

			var laUrl = config.urlCompleta("grupos");
			if (porTipo) {
				laUrl = laUrl + "/tipo/" + porTipo;  
			}
			
			$.getJSON(laUrl,{},function(data) {
				
				var itemsPropios = [];
				var itemsAcademicos = [];
				var itemsDirector = [];
				var itemsCatedra = [];
				var itemsDocenteComisiones = [];
				var htmlItem = '';
				
				if(!data) { 
					itemsPropios.push('<li><span class="text">Información no determinada</span></li>');
					$('<ul/>', {
						'id' : 'listaGruposPropios',
						'class' : 'todo-list ui-sortable',
						html : itemsPropios.join('')
					}).appendTo('#tabPropio');


					itemsAcademicos.push('<li><span class="text">Información no determinada. </span></li>');					
					$('<ul/>', {
						'id' : 'listaGruposAcademicos',
						'class' : 'todo-list ui-sortable',
						html : itemsAcademicos.join('')
					}).appendTo('#tabAcademico');
					
					var esteOverlay = $("#contenedorGrupos").find(ec);
					esteOverlay.animate({opacity : 0.25}, 1000, function() {
							$(this).remove();
						});
					return ;
				}				
				
				$.each(data,function(key, val) {
					var idGrupo = val.idGrupo;
					var enlace = config.convertirUrl(val.enlace);
					var enlaceFinal = enlace;
					var nombre = val.nombre;
					var cantidad = val.cantidad;
					var tipo = val.tipo;
					var creadoPor = val.creadoPor;
					var creadoPorFinal = ""; 
					var eMailCreadoPorFinal = "";
					var nombreCreadoPorFinal = "";
					var colorCreado = "label-success";
					var toolBar = ""

					if (creadoPor==null) { creadoPor="N/A|N/A"; }
					var eMailCreadoPorFinal = creadoPor.split("|")[0];
					var nombreCreadoPorFinal = creadoPor.split("|")[1];
						
					/*
					if ((nombreCreadoPorFinal.replace(",","").trim()) == (getNombreCompleto().trim())) {
						creadoPorFinal = "x mí ";
						colorCreado = "label-info";
						toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i><i class="fa fa-plus" data-toggle="tooltip" title="Agregar Integrantes al Grupo"></i><i class="fa fa-pencil" data-toggle="tooltip" title="Editar el Grupo"></i><i class="fa fa-trash-o" data-toggle="tooltip" title="Eliminar el Grupo"></i>';
					} else {
						creadoPorFinal = nombreCreadoPorFinal.split(",")[0]+"...";
						colorCreado = "label-success";
						toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i><i class="fa fa-bullhorn" data-id="'+eMailCreadoPorFinal+'" data-toggle="tooltip" title="Avisar al Creador con Invitación"></i>';
					}
					*/
					if ((eMailCreadoPorFinal.trim()) == (getMail().trim())) {
						creadoPorFinal = "x mí ";
						colorCreado = "label-info";
						toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i><i class="fa fa-plus" data-toggle="tooltip" title="Agregar Integrantes al Grupo"></i><i class="fa fa-pencil" data-toggle="tooltip" title="Editar el Grupo"></i><i class="fa fa-trash" data-toggle="tooltip" title="Eliminar el Grupo"></i>';
					} else {
						creadoPorFinal = nombreCreadoPorFinal.split(",")[0]+"...";
						colorCreado = "label-success";
						toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i><i class="fa fa-bullhorn" data-id="'+eMailCreadoPorFinal+'" data-toggle="tooltip" title="Avisar al Creador con Invitación"></i>';
					}					
					
					if (cantidad==0) { cantidad = "sin "; }
					
					if (tipo == 'GRUPO') {
						
						var esGrupoExamen = nombre.indexOf("EXAMEN");
						
						if (esGrupoExamen!=-1) {

							var tieneSeparadorGrupo = nombre.indexOf("|");
							
							if (tieneSeparadorGrupo!=-1) {

								var elNombreGrupoExamen = nombre.split("|")[0];
								var elEnlaceActas = nombre.split("|")[1];
								//toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i>';
								itemsPropios.push('<li id="idGrupoPropio'+idGrupo+'"><span class="text"><a href="#" id="grupoPropioExamen'+ idGrupo+ '" data-type="text" data-pk="'+ idGrupo+ '">'+ elNombreGrupoExamen + '</a> ' + elEnlaceActas + '</span><small class="label label-info"> ' + cantidad + ' miembros</small><small class="label label-success" data-toggle="tooltip" title="Creado por ' + nombreCreadoPorFinal + '"> '+ creadoPorFinal  + '</small><div class="tools">' + toolBar + '</div></li>');																						
							} else {								
								//puede ser un grupo comun, pero de todos modos no tenemos que basarnos en eso.
								itemsPropios.push('<li id="idGrupoPropio'+idGrupo+'"><span class="text"><a href="#" id="grupoPropioEditar'+ idGrupo+ '" data-type="text" data-pk="'+ idGrupo+ '">'+ nombre+ '</a></span><small class="label label-info"> ' + cantidad + ' miembros</small><small class="label label-success" data-toggle="tooltip" title="Creado por ' + nombreCreadoPorFinal + '"> '+ creadoPorFinal  + '</small><div class="tools">' + toolBar + '</div></li>');
							}
						} else {
							itemsPropios.push('<li id="idGrupoPropio'+idGrupo+'"><span class="text"><a href="#" id="grupoPropioEditar'+ idGrupo+ '" data-type="text" data-pk="'+ idGrupo+ '">'+ nombre+ '</a></span><small class="label label-info"> ' + cantidad + ' miembros</small><small class="label label-success" data-toggle="tooltip" title="Creado por ' + nombreCreadoPorFinal + '"> '+ creadoPorFinal  + '</small><div class="tools">' + toolBar + '</div></li>');
						}
															
					} else if (tipo == 'EXAMEN') {
						var elNombreGrupoExamen = nombre.split("|")[0];
						var elEnlaceActas = nombre.split("|")[1];
												
						toolBar = '<i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i>';
												
						itemsPropios.push('<li id="idGrupoPropio'+idGrupo+'"><span class="text"><a href="#" id="grupoPropioExamen'+ idGrupo+ '" data-type="text" data-pk="'+ idGrupo+ '">'+ elNombreGrupoExamen + '</a> ' + elEnlaceActas + '</span><small class="label label-info"> ' + cantidad + ' miembros</small><small class="label label-success" data-toggle="tooltip" title="Creado por ' + nombreCreadoPorFinal + '"> '+ creadoPorFinal  + '</small><div class="tools">' + toolBar + '</div></li>');
						
					} else if (tipo == 'CATEDRA') {						
						itemsCatedra.push('<li id="idGrupoAcademico'+idGrupo+'"><small class="label label-success" style="margin-left:0px"> CATEDRA</small><span class="text"><a href="#">'+ nombre+ '</a></span><div class="tools"><i class="fa fa-user" data-toggle="tooltip" title="Docentes"></i></div></li>');
					} else if (tipo == 'DEPARTAMENTO') {						
						itemsDirector.push('<li id="idGrupoAcademico'+idGrupo+'"><small class="label label-warning" style="margin-left:0px"> DPTO</small><span class="text"><a href="#">Ingeniería '+ nombre+ '</a></span><div class="tools"><i class="fa fa-user" data-toggle="tooltip" title="Docentes"></i></div></li>');
					} else if (tipo == 'GRUPO ACADEMICO') {						
						itemsDocenteComisiones.push('<li id="idGrupoAcademico'+idGrupo+'"><span class="text"><a href="#">'+ nombre+ '</a></span><small class="label label-info"> '+ cantidad+ ' miembros</small><div class="tools"><i class="fa fa-user" data-toggle="tooltip" title="Docentes"></i><i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i></div></li>');
						itemsAcademicos.push('<li id="idGrupoAcademico'+idGrupo+'"><span class="text"><a href="#">'+ nombre+ '</a></span><small class="label label-info"> '+ cantidad+ ' miembros</small><div class="tools"><i class="fa fa-user" data-toggle="tooltip" title="Docentes"></i><i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i></div></li>');
					} else {
						itemsAcademicos.push('<li id="idGrupoAcademico'+idGrupo+'"><span class="text"><a href="#">'+ nombre+ '</a></span><small class="label label-info"> '+ cantidad+ ' miembros</small><div class="tools"><i class="fa fa-user" data-toggle="tooltip" title="Docentes"></i><i class="fa fa-group" data-toggle="tooltip" title="Ver Integrantes del Grupo"></i></div></li>');
					}
					
				});

				if (itemsPropios.length == 0) {				//&& ($("#listaGruposPropios").length)==0
					itemsPropios.push('<li><span class="text">No existen nuevos grupos</span></li>');
				}

				if (itemsAcademicos.length == 0) {
					itemsAcademicos.push('<li><span class="text">No existen grupos académicos definidos.</span></li>');
				}
				
				if (itemsAcademicos.length>=5) {
					$('#contenedorTabsGrupos').slimScroll({
				        height: 'auto',/*altoGeneral*/
				    });						
				}
							
				$('<ul/>', {
					'id' : 'listaGruposPropios',
					'class' : 'todo-list ui-sortable',
					html : itemsPropios.join('')
				}).appendTo('#tabPropio');

				$('<ul/>', {
					'id' : 'listaGruposAcademicos',
					'class' : 'todo-list ui-sortable',
					html : itemsAcademicos.join('')
				}).appendTo('#tabAcademico');

				$('<ul/>', {
					'id' : 'listaGruposDirector',
					'class' : 'todo-list ui-sortable',
					html : itemsDirector.join('')
				}).appendTo('#tabesDirector');

				$('<ul/>', {
					'id' : 'listaGruposCatedra',
					'class' : 'todo-list ui-sortable',
					html : itemsCatedra.join('')
				}).appendTo('#tabesJefeCatedra');
				
				$('<ul/>', {
					'id' : 'listaGruposDocenteComisiones',
					'class' : 'todo-list ui-sortable',
					html : itemsDocenteComisiones.join('')
				}).appendTo('#tabesDocenteComisiones');

				$("#listaGruposPropios li div.tools i.fa-group").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Integrantes del Grupo ' + texto;

					abrirModalListas(id,titulo);
					
					}
				});

				$("#listaGruposPropios li span a").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					var texto = $(this).text();
					
					var href = $(this).attr("href");
					
					if (href!=null) {
						if (href.includes("Actas")) {
							//no hace na
						} else {
							mensaje.listar("/grupo/G-"+id+"/"+texto);
						}
					} else {
						mensaje.listar("/grupo/G-"+id+"/"+texto);						
					}
					
					}
				});

				$("#listaGruposPropios li div.tools i.fa-trash").on({click : function() {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					var texto = $(this).closest("li").find("span").text();
					
					var o = Autogestion.Grupo;
					var m = o.mensajeSistema().eliminar;
					abrirModalGeneral(m.titulo, m.descripcion ,true,true,1, function(i) {
						o.eliminar(id);
						$('#dialogoGeneral').modal('hide');
					}, function(i) {
						$('#dialogoGeneral').modal('hide');
					});
					}
				});

				$("#listaGruposPropios li div.tools i.fa-pencil").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					var idx = '#grupoPropioEditar' + id;

					e.stopPropagation();
					$(idx).editable({
						type : 'text',
						url : '/4/grupos/'+ id,
						toggle : 'manual',
						success: function(response, newValue) {
							notificar("info", "Se ha actualizado la información del grupo!");
						},
						error: function(response, newValue) {
					        notificar("danger", "Ha ocurrido un error!")
						}						
					});
					$(idx).editable('toggle');
					}
				});

				 
				$("#listaGruposPropios li div.tools i.fa-plus").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					abrirModalAgregarContacto("G", id);
					}
				});

				$("#listaGruposPropios li div.tools i.fa-bullhorn").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					var nombreGrupo = $(this).closest("li").find('a').text();
						
					var id = _id.replace("idGrupoPropio","") + "|" + $(this).attr("data-id") +"|"+ nombreGrupo;
					
					abrirModalAgregarContacto("I", id);
					}
				});

				$("#listaGruposAcademicos li div.tools i.fa-user").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Docente' + texto;
					
					//var url = '/4/academico/docentes/'+id+'/grupo';
					var url = '/4/grupos/integrantes/'+id+'/docente';
					
					var misc = grupo.misc();
										
					//misc.modalTabla(id, url, 100, titulo, function(e){}, function(e){});
					misc.modalTabla(id, url, 39, titulo, function(e){}, function(e){});
					
					}
				});

				$("#listaGruposAcademicos li div.tools i.fa-group").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Integrantes del Grupo ' + texto;
					
					var url = '/4/grupos/integrantes/'+id;
					var url = '/4/grupos/integrantes/'+id+'/alumno';

					var misc = grupo.misc();
					
					//misc.modalTabla(id, url, 100, titulo, function(e){}, function(e){});
					misc.modalTabla(id, url, 39, titulo, function(e){}, function(e){});				
					}
				});


				$("#listaGruposDocenteComisiones li div.tools i.fa-group").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Integrantes del Grupo ' + texto;
					
					var url = '/4/grupos/integrantes/'+id+'/alumno';

					var misc = grupo.misc();
					
					misc.modalTabla(id, url, 39, titulo, function(e){}, function(e){});				
					}
				});
				
				$("#listaGruposDocenteComisiones li div.tools i.fa-user").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Docente' + texto;
					
					var url = '/4/grupos/integrantes/'+id+'/docente';
					
					var misc = grupo.misc();
										
					misc.modalTabla(id, url, 39, titulo, function(e){}, function(e){});					
					}
				});

				
				
				$("#listaGruposAcademicos li span a").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).text();

					mensaje.listar("/grupo/G-"+id+"/"+texto);

					}
				});
				
				$("#listaGruposAcademicos li div.tools i.fa-plus").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoPropio","");
					//abrirModalAgregarContacto("G", id);
					}
				});
				
				$("#listaGruposCatedra li span a").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).text();

					mensaje.listar("/catedra/G-"+id+"/"+texto);

					}
				});

				$("#listaGruposDirector li span a").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idGrupoAcademico","");
					var texto = $(this).text();

					mensaje.listar("/director/G-"+id+"/"+texto);

					}
				});
			}).fail(function(data) {
				console.log("Error: " + data);
			}).always(function() {
				var esteOverlay = $("#contenedorGrupos").find(ec);
				esteOverlay.animate({opacity : 0.25}, 1000, function() {
						$(this).remove();
					});
			});
			/*
			if (getTipoUsuario()=="D") {
				$('#contenedorGrupos .box-footer').hide();
			}
			*/
		},
		listarIntegrantes : function(id) {
			var config = this.configuracion();

			$.getJSON(config.urlCompleta("grupos/integrantes/") + id, {},
					function(data) {
						var itemsPropios = [];
						var itemsAcademicos = [];
						var htmlItem = '';

						$.each(data, function(key, val) {
							var idGrupo = val.idGrupo;
						});

					});
		},
	},
	Mensaje : {
		eliminar : function(id) {					
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("mensajes/eliminar/"+ id),
				type : 'DELETE',
				async : false
			}).done(function(data) {
				var tipo = mostrarNotificacion(data);
				if (tipo=="success") {				

				} else {

				}
								
			});
		},		
		responderMensaje:function(publicador, id, texto) { // el publicador
			nombredestino = id;
			var config = this.configuracion();
			$.ajax({
				async : false,
				url : config.urlCompleta("mensajes/responder/" + id),
				type : 'PUT',
				data : {
					para : publicador,
					contenido : texto,
					tipo : 'USUARIO'
				}, // VER LUEGO COMO OBTENER EL TIPO DEL DESTINATARIO
				dataType : "xml",
				params : {
					headers : {
						"A4-Token" : A4Token,
						"A4-TimeStamp" : A4TimeStamp,
						"A4-Data" : A4Data
					}
				},
			}).done(function(data) {
				var sTitle = "";
				$(data).find('mensaje').each(function() {
					sTitle = $(this).text();
				});

				$("#txtMensaje_" + id).val("");
				var m = sTitle;
				$.notify({
					title: '<strong>Enviando Mensaje</strong>',
					message: sTitle
				},{
					type: "success"
				});
				
				$( "#btnIdCloseMensaje_" + id ).trigger( "click" );

			}).fail(function(data) {
				// var nombredestino = jsonselecctions[i].descripcion;
				alert('Fallo proceso Autorizacion Estado ' + estado)
				// resultadoFAIL(nombredestino);
			});
		}
		,conversacion:function(pRespuestaAMensajeId,pPersona,pFunction,pFoto)
		{
			//console.log(pFoto);
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("mensajes/conversacion/"+ pRespuestaAMensajeId),{},function(data) {
				var items = [];
				var mensajes = {};
				var elTotal = '';
				var currentMail = mail.toLowerCase();
				var lastId=0;
				$.each(data,function(key, val) {
					var id = val.id;
					lastId = id;
					var elMensaje = val.nota;
					var mailPublicador = val.emailOrigen;
					var mailReceptor = val.emailDestino;
					var momentoFechaPublicacionCompleta = moment(val.fechaPublicacion);
					var fechaPublicacionCompletaFinal = momentoFechaPublicacionCompleta.format("DD/MM/YYYY HH:mm:ss");
					var fechaPublicacionCompletaFinalMuestra = momentoFechaPublicacionCompleta.format("DD/MM HH:mm");
					var fechaPublicacion = val.fechaPublicacion;
					var nombreImagen = "avatars.png";
					var elHtml ="";
					var laClase ="right";
					if(currentMail == mailPublicador.toLowerCase() ) {	
					  laClase = "right";
					  elHtml = '<div class="direct-chat-info clearfix"><span class="direct-chat-name pull-right"><a href="#">Yo</a> </span><span class="direct-chat-timestamp pull-left">' +  fechaPublicacionCompletaFinalMuestra + '</span></div><img alt="message user image" src="'+pFoto+'" class="direct-chat-img" /><div class="direct-chat-text">'+ elMensaje+ '</div>';					  
					} else {					 
					 laClase = "left";
					 elHtml = '<div class="direct-chat-info clearfix"><span class="direct-chat-name pull-left"><a href="#">' + pPersona + '</a> </span><span class="direct-chat-timestamp pull-right">' +  fechaPublicacionCompletaFinalMuestra + '</span></div><img alt="message user image" src="'+pFoto+'" class="direct-chat-img" /><div class="direct-chat-text">'+ elMensaje+ '</div>';
					}
					items.push('<div id="itemConversacionMensaje' + id  + '" class="direct-chat-msg ' + laClase + '">' + elHtml+ '</div>');

				});

				$('#itemConversacion_'+ +pRespuestaAMensajeId).html("");			

				$('<div />', {
					'class' : 'menu',
					'id' : 'contenedorListaConversacion' + pRespuestaAMensajeId, 
					html : items.join('')
				}).appendTo('#itemConversacion_'+ +pRespuestaAMensajeId);

				if (items.length>=5) {
					$('#contenedorListaConversacion'+pRespuestaAMensajeId ).slimScroll({
				        height: altoGeneralConversacion,
				        start:'bottom',
				        alwaysVisible: true
				    });						
				}
				
			})
			.fail(function() {
				$('#itemConversacion_'+ +pRespuestaAMensajeId).html('<li>No se puede obtener la conversacion</li>');
			});
			
		},
		/* La idea es procesar el pedido y ejecutar la funcion que se pasa por parametro una vez que se recibio respuesta del server */
		procesar:function(pPublicador,pIdMensaje,pIdAccion,pFuncion)
		{
			nombredestino = pIdMensaje;
			var config = this.configuracion();
			
			
			$.ajax({
				async : true,
				url : config.urlCompleta("mensajes/autorizacion/"+ pIdMensaje + "/"+ pIdAccion.toUpperCase() + ""),
				type : 'PUT', 
				data : {
					para : pPublicador
					},
				dataType : 'xml',
				beforeSend: function( xhr ) {
						xhr.setRequestHeader("A4-Token", A4Token);
						xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
						xhr.setRequestHeader("A4-Data", A4Data);
						myApp.showPleaseWait();
						 },	
				}).done(function(data, textStatus, jqXHR) {
					
					var mensajeRetorno = $(jqXHR.responseText).find("mensaje").text();
					var codigoRetorno =  $(jqXHR.responseText).find("codigo").text();
					var tit = codigoRetorno == 1?"Exito":" Problemas";
					
					// para evitar que se llame varias veces el codigo se implementara el notify en esta seccion
				 	var tipoRetorno = codigoRetorno ==1?'success':'danger';
					var contacto = Autogestion.Contacto;
					contacto.listar();
					var refrescar = Autogestion.Mensaje;
					refrescar.refrescarTimeline();
					
					$("#idMensaje"+pIdMensaje + " div.timeline-item h3.timeline-header").html(mensajeRetorno);
					
					$.notify({
						title: '<strong>Respuesta</strong>',
						message: mensajeRetorno
					},{
						type: tipoRetorno
					});

					
					if (typeof pFuncion==="function")
					{
						var ret ="Proceso ejecutado con " + tit + " (" + pIdAccion + ") : "  + mensajeRetorno ;
						pFuncion(codigoRetorno==1?"OK":"FAIL",ret);
					}
					else
					{
						alert("Proceso de Mensaje ejecutado con Exito");
					}
					
				}).fail(function(data) {

					var msg = $(data.responseText).find("mensaje").text();

					
					if (typeof pFuncion==="function")
					{
						var ret ="Proceso ejecutado con Errores (" + pIdAccion + ") : "  + mensajeRetorno ;
						pFuncion("FAIL",ret);
					}
					else
					{
						alert("Proceso de Mensaje ejecutado con Errores");
					}
					
					
				}).always(function() {
					myApp.hidePleaseWait();
				});
			
			
		}
		,
		cambiarEstadoAutorizacion : function(publicador, id, estado) {
			nombredestino = id;
			var config = this.configuracion();
			$.ajax({
				async : false,
				url : config.urlCompleta("mensajes/autorizacion/"+ id + "/"+ estado.toUpperCase() + ""),
				type : 'PUT', 
				data : {
					para : publicador
					},
				dataType : "xml",
				params : {
					headers : {
						"A4-Token" : A4Token,
						"A4-TimeStamp" : A4TimeStamp,
						"A4-Data" : A4Data
						}
					},
				}).done(function(data) {
					var sTitle = "";
					$(data).find('mensaje').each(function() {
						sTitle = $(this).text();
						// alert(sTitle);
					});

					if (estado == 'Aceptar' || estado == 'Cancelar' || estado == 'Rechazar' || estado == 'Bloquear') {

						var template = $("#divSolicitudProcesada").clone();
						template.attr("id", "accionRealizada_"+ estado + "_" + id);
						$('#itemBotoneraMensaje' + id).html("");

						template.append("<div>" + sTitle + "</div>");
						template.appendTo($('#itemBotoneraMensaje'+ id));
						$("#itemEstadoSolicitud_" + id).html("Accion Procesada : " + estado);// limpiamos
						$("#accionRealizada_" + estado + "_" + id).show();		
					}
				}).fail(function(data) {
					// var nombredestino = jsonselecctions[i].descripcion;
					alert('Fallo proceso Autorizacion Estado ' + estado)
					// resultadoFAIL(nombredestino);
				});
		},
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		agregar : function() {
			var config = this.configuracion();
			var resultadoOK = function(destino, mensajeRespuesta) {
				agregarRespuestaOK("", destino, mensajeRespuesta);
			};
			/*
			var resultadoFAIL = function(destino, mensajeRespuesta) {
				agregarRespuestaFAIL("", destino, mensajeRespuesta);
			};
			*/
			var smensaje = $("#txtMensaje").val();
			if (smensaje.length <= 0) {
				abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Debe ingresar el mensaje a publicar',true,false,0);
				return;
			}
			/*Script para parser fecha, tambien para pasarlo a */
			var stringToParse = smensaje;//"You have a doctor's appointment on 2012/03/13 16:00.  Please show up on time.";
			var dateString    = stringToParse.match(/\d{4}\/\d{2}\/\d{2}\s+\d{2}:\d{2}/);
			var dt            = new Date(dateString);
			//var elmensaje = $("#txtMensaje").val();
			var test = $('#destinatariosMensaje');
			var jsonselecctions = $(test).select2('data');
			if (jsonselecctions.length <= 0) {
				abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Debe seleccionar el Contacto Confiable',true,false,0, function(i) {}, function(i) {});				
				return;
			}		
			var myArray = [];
			$("#itemRespuestasMensaje").empty();
			for (var i = 0; i < jsonselecctions.length; i++) {
				var iddestino = jsonselecctions[i].id;
				var tipo = jsonselecctions[i].tipo;

				$.ajax({
					async : false,
					url : config.urlCompleta("mensajes/"),
					type : 'POST',
					data : {
						tipo : tipo,
						destino : iddestino,
						mensaje : smensaje
					}
				}).done(function(data) {
					var nombredestino = jsonselecctions[i].descripcion;
					var sCodigo = ""; 
					var sMensaje = "";
					var sMensajeResultado = "";
					$(data).find('respuestaRetorno').each(function(){
						sCodigo  = $(this).find('codigo').text();
						sMensaje = $(this).find('mensaje').text();
					});
					if (sCodigo =='success') {
						notificar(sCodigo, sMensaje)
					} else {
						notificar(sCodigo, sMensaje)
					}
					 

				}).fail(function(data) {
					var nombredestino = jsonselecctions[i].descripcion;
					var sMensajeResultado = "";
					$(data).find('respuestaRetorno').each(function(){
						sCodigo  = $(this).find('codigo').text();
						sMensaje = $(this).find('mensaje').text();
						sMensajeResultado = sMensaje;
					});

					agregarRespuestaFAIL("", nombredestino, sMensajeResultado);
				});

			}
			$('#destinatariosMensaje').select2('data', null);
			$('#txtMensaje').val("");

		},
		agregarMaterial : function() {
			var config = this.configuracion();
			var resultadoOK = function(destino, mensajeRespuesta) {
				agregarRespuestaOK("", destino, mensajeRespuesta);
			};
			var smensaje = $("#txtMensaje").val();
			if (smensaje.length <= 0) {
				abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Debe ingresar el mensaje a publicar',true,false,0);
				return;
			}

			var stringToParse = smensaje;//"You have a doctor's appointment on 2012/03/13 16:00.  Please show up on time.";
			var dateString    = stringToParse.match(/\d{4}\/\d{2}\/\d{2}\s+\d{2}:\d{2}/);
			var dt            = new Date(dateString);
			var elmensaje = $("#txtMensaje").val();
			var test = $('#destinatariosMensaje');
			var jsonselecctions = $(test).select2('data');
			if (jsonselecctions.length <= 0) {
				abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Debe seleccionar el Contacto Confiable',true,false,0, function(i) {}, function(i) {});				
				return;
			}		
			var myArray = [];
			$("#itemRespuestasMensaje").empty();
			for (var i = 0; i < jsonselecctions.length; i++) {
				var iddestino = jsonselecctions[i].id;
				var tipo = jsonselecctions[i].tipo;

				$.ajax({
					async : false,
					url : config.urlCompleta("mensajes/material"),
					type : 'POST',
					data : {
						tipo : tipo,
						destino : iddestino,
						mensaje : smensaje,
						adjuntos: uploadedFilesByDocente.join('\|')
					}
				}).done(function(data) {
					var nombredestino = jsonselecctions[i].descripcion;
					var sCodigo = ""; 
					var sMensaje = "";
					var sMensajeResultado = "";
					$(data).find('respuestaRetorno').each(function(){
						sCodigo  = $(this).find('codigo').text();
						sMensaje = $(this).find('mensaje').text();
					});
					if (sCodigo =='success') {
						notificar(sCodigo, sMensaje)
						agregarAlTimeLine("999999", "fa-location-arrow", "Publicaste " + smensaje + ' a ' + nombredestino);
					} else {
						//resultadoFail(nombredestino, sMensajeResultado);
						notificar(sCodigo, sMensaje)
						//agregarRespuestaFAIL("", nombredestino, sMensajeResultado);
					}
					 

				}).fail(function(data) {
					var nombredestino = jsonselecctions[i].descripcion;
					var sMensajeResultado = "";
					$(data).find('respuestaRetorno').each(function(){
						sCodigo  = $(this).find('codigo').text();
						sMensaje = $(this).find('mensaje').text();
						sMensajeResultado = sMensaje;
					});

/*					$(data).find('mensaje').each(function() {
						sMensajeResultado = $(this).text();
					});
					*/
					//resultadoFAIL(nombredestino, sMensajeResultado);
					agregarRespuestaFAIL("", nombredestino, sMensajeResultado);
				});

			}
			$('#destinatariosMensaje').select2('data', null);
			$('#txtMensaje').val("");

		},

		refrescarTimeline : function (){
			
				var mensaje = Autogestion.Mensaje;
				if ($("#listaMensajes.listadoAutorizados").length>0)
				{
					mensaje.listar("/list/autorizados");
				}
				
				if ($("#listaMensajes.listadoMisSolicitudes").length>0)
				{
					mensaje.listar("/list/missolicitudes");
				}

				if ($("#listaMensajes.listadoParaAutorizar").length>0)
				{
					mensaje.listar("/list/paraautorizar");
				}
				
				if ($("#listaMensajes.listadoPendientes").length>0)
				{
					mensaje.listar("/list/pendientes");
				}
				
				if ($("#listaMensajes.listadoMeHanBloqueado").length>0)
				{
					mensaje.listar("/list/mehanbloqueado");
				}
				
				if ($("#listaMensajes.listadoQueHazBloqueado").length>0)
				{
					mensaje.listar("/list/quehazbloqueado");
				}

		},
		solicitarAceptacion : function() {
			var config = this.configuracion();
			var resultadoOK = function(destino, mensajeRespuesta) {
				agregarRespuestaOK("2", destino, mensajeRespuesta);
				
			};
			var resultadoFAIL = function(destino, mensajeRespuesta) {
				agregarRespuestaFAIL("2", destino, mensajeRespuesta);
			};

			//console.log("agregando Mensaje solicitud de Confianza");
			var smensaje = $("#txtMensaje2").val();
			if (smensaje.length <= 0) {
				abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Debe ingresar el mensaje a enviar',true,false,0);
				return;
			}
			var elmensaje = $("#txtMensaje2").val();
			var test = $('#destinatarioDialog');
			var jsonselecctions = $(test).select2('data');
			// var myArray = [];
			$("#divDestinatariosInformados2").empty();// .append("<span>" +
			// nombredestino +
			// "</span>");
			$("#itemRespuestasMensaje2").empty();
			for (var i = 0; i < jsonselecctions.length; i++) {

				var iddestino = jsonselecctions[i].id;
				var tipo = jsonselecctions[i].tipo;
				var nombredestino = jsonselecctions[i].descripcion;
				var estado = jsonselecctions[i].estado;
				
				if(estado==4)
				{
					var nombredestino = jsonselecctions[i].descripcion;
					var sMensajeResultado ="No se puede enviar la solicitud por estar bloqueado el contacto";
					resultadoFAIL(nombredestino, sMensajeResultado);
				}
				else
				{	
				$.ajax({
					async : false,
					url : config.urlCompleta("mensajes/solicitar"),
					type : 'POST',
					data : {
						tipo : tipo,
						destino : iddestino,
						mensaje : smensaje,
						mensajeid : 0
					}
				}).done(function(data) {
					var contacto = Autogestion.Contacto;
					contacto.listar();
					var sMensajeResultado = "";
					/*$(data).find('mensaje').each(function() {
						sMensajeResultado = $(this).text();
					});
					*/
					 var sMensajeResultado = $(data).find('mensaje').first().text();
					 var sCodigoResultado = $(data).find('codigo').first().text();
					 
					var nombredestino = jsonselecctions[i].descripcion;
					if(sCodigoResultado=="OK")
						resultadoOK(nombredestino, sMensajeResultado);
					else
						resultadoFAIL(nombredestino, sMensajeResultado);
					
				}).fail(function(data) {
					var sMensajeResultado = "";
					$(data).find('mensaje').each(function() {
						sMensajeResultado = $(this).text();
					});
					var nombredestino = jsonselecctions[i].descripcion;
					resultadoFAIL(nombredestino, sMensajeResultado);
				});
				}// fin if

			}
			$('#destinatarioDialog').select2('data', null);
			$('#txtMensaje2').val("");
			$('#trustedperson-modal').modal("hide");
		},
		estado : function(id) {
		},
		marcar : function(id, estado) {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("mensajes/estado/") + id + "/" + estado,
				type : 'PUT',
				async : false
			}).done(function(data) {
				var tipo = mostrarNotificacion(data);
				if (tipo=="success") {
					var elId = '#idMensaje' + id;
					$(elId).find("i").first().replaceWith('<i class="fa fa-check bg-gray"></i>');
					$(elId).find(".timeline-item").remove(".time");
					$(elId).find("div.timeline-item").remove(".timeline-body");
					$(elId).find("div.timeline-item").remove(".timeline-footer");
					
				} else {

				}
				
				
			});
		},
		denunciar : function(id) {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("mensajes/denunciar/") + id,
				type : 'PUT',
				async : false
			}).done(function(data) {
				alert(data);
			});
		},
		
		listar : function(tipomensaje,pagina) {
			var strUrlCompleta = "";
			var titlePrincipal = timelineTitlePrincipal;
			var timelineSinContenido = "No dispones de nuevos mensajes";
			var iconfaDefault = "fa-frown";//fa-smile-o
			var classTipoMensajeLista="";
			var urlConPagina  = ""; 
			var paginaActual = 1;
			var esTimeLineBase = 1;
			var enlaceVolverTimelinePrincipal = ' Volver al <a href="javascript:void(0);" id="enlaceVolverTimeLinePrincipal">Principal.</a>';

			if (pagina) {
				urlConPagina = "/"+pagina;
				paginaActual = pagina;
			} else {
				urlConPagina  = "";
				paginaActual = 1;
				
				var btnFiltroFechaActual = $('#btnFiltroFecha');				
				$("#timelinePrincipal").html("");
				$("#timelinePrincipal").append('<div class="loading-img"></div>');				
			}
			
			if (tipomensaje == "/todos")
				strUrlCompleta = "mensajes" + urlConPagina;
			else
				strUrlCompleta = "mensajes" + tipomensaje;			
			
			if (tipomensaje == "/enviados")
			{	titlePrincipal = "Mensajes Enviados<small class=\"hidden-xs hidden-sm hidden-md\">tus mensajes enviados</small>";
				timelineSinContenido ="No se encontraron registros de Mensajes Enviados";
				esTimeLineBase = 0;
			}
			
			if (tipomensaje == "/recibidos")
			{	
				titlePrincipal = "Mensajes Recibidos<small class=\"hidden-xs hidden-sm hidden-md\">tus mensajes recibidos</small>";
				timelineSinContenido ="No se encontraron Mensajes Recibidos";
				classTipoMensajeLista =" listadoMensajesRecibidos";
				esTimeLineBase = 0;
			}

			if (tipomensaje == "/autorizaciones") {
				titlePrincipal = "Mensajes Recibidos<small class=\"hidden-xs hidden-sm hidden-md\">tus mensajes recibidos</small>";
				esTimeLineBase = 0;
			}
			if (tipomensaje == "/list/autorizados")
			{	
				titlePrincipal = "Contactos Autorizados<small class=\"hidden-xs hidden-sm hidden-md\">estos son los contactos con los que puedes establecer una conversacion</small>";
				timelineSinContenido ="No se encontraron Contactos Autorizados";
				classTipoMensajeLista =" listadoAutorizados";
				esTimeLineBase = 0;
			}
			if (tipomensaje == "/list/mehanbloqueado")
			{
				titlePrincipal = "Contactos que te han bloqueado<small class=\"hidden-xs hidden-sm hidden-md\">estos son los contactos con por algun motivo no desean mantener conversaciones contigo</small>";
				timelineSinContenido ="Nadie te ha bloqueado";
				iconfaDefault = "fa-smile";
				classTipoMensajeLista = " listadoMeHanBloqueado";
				esTimeLineBase = 0;
			}
			if (tipomensaje == "/list/quehazbloqueado")
			{
				titlePrincipal = "Contactos que has bloqueado en algun momento<small class=\"hidden-xs hidden-sm hidden-md\">estos son los contactos que por algun motivo no deseas mantener conversaciones </small>";
				timelineSinContenido ="No has bloqueado a ninguna persona";
				iconfaDefault = "fa-times";
				classTipoMensajeLista = " listadoQueHazBloqueado";
				esTimeLineBase = 0;
			}
			
			if (tipomensaje == "/list/missolicitudes")
			{
				titlePrincipal = "Mis Solicitudes pendientes<small class=\"hidden-xs hidden-sm hidden-md\">estos son tus solicitudes realizadas con el motivo de que te autorizen para poder establecer alguna conversacion </small>";
				timelineSinContenido ="No se encontraron registros de Solicitudes";
				classTipoMensajeLista =" listadoMisSolicitudes";
				esTimeLineBase = 0;
			}

			if (tipomensaje == "/list/paraautorizar")
			{
				titlePrincipal = "Solicitudes de Otras Personas Pendientes de Autorizar<small class=\"hidden-xs hidden-sm hidden-md\">Son solicitudes de personas que quieren establecer una conversacion contigo </small>";
				timelineSinContenido ="No se encontraron registros de Solicitudes para Autorizar";
				classTipoMensajeLista = " listadoParaAutorizar";
				esTimeLineBase = 0;
			}

			if (tipomensaje == "/list/pendientes")
			{
				titlePrincipal = "Solicitudes Pendientes de Autorizacion<small class=\"hidden-xs hidden-sm hidden-md\"></small>";
				timelineSinContenido ="No se encontraron registros de Solicitudes Pendientes de Autorizar";
				classTipoMensajeLista = " listadoPendientes";
				esTimeLineBase = 0;
			}
			if (tipomensaje == "/list/ocultos")
			{
				titlePrincipal = "Mensajes Ocultos<small class=\"hidden-xs hidden-sm hidden-md\"> que fueron marcados como ocultos</small>";
				timelineSinContenido ="No se encontraron registros de mensajes ocultos";
				classTipoMensajeLista = " listadoOcultos";
				esTimeLineBase = 0;
			}
			
			if (tipomensaje.indexOf("/grupo")!=-1)
			{	
				var inicioTextoGrupo = strUrlCompleta.indexOf("/EXAMEN ");
				var textoGrupo = '';
				
				if (inicioTextoGrupo!=-1) {
					//es un grupo de examen
					//length de /EXAMEN + fecha + -
					//strUrlCompleta.length-1 para quitar el |
					var lengthExamen = 21; 					
					var textoGrupo = strUrlCompleta.substr(inicioTextoGrupo+lengthExamen,strUrlCompleta.length);
					strUrlCompleta = strUrlCompleta.substr(0,inicioTextoGrupo);
					
				} else {

					inicioTextoGrupo = strUrlCompleta.lastIndexOf("/");
					textoGrupo = strUrlCompleta.substr(inicioTextoGrupo+1,strUrlCompleta.length);
					strUrlCompleta = strUrlCompleta.substr(0,inicioTextoGrupo);
				}
				
				titlePrincipal = "Mensajes del Grupo "+textoGrupo+"<small class=\"hidden-xs hidden-sm hidden-md\"> todos los mensajes en el Grupo</small>";
				timelineSinContenido ="No se encontraron mensajes en el Grupo <a href='#'>" + textoGrupo + "</a>." + enlaceVolverTimelinePrincipal;
				classTipoMensajeLista =" listadoMensajesGrupoPropio";
				esTimeLineBase = 0;
			}

			if (tipomensaje.indexOf("/catedra")!=-1)
			{	
				strUrlCompleta = strUrlCompleta.replace("/catedra","/grupo");
				var inicioTextoGrupo = strUrlCompleta.lastIndexOf("/");
				var textoGrupo = strUrlCompleta.substr(inicioTextoGrupo+1,strUrlCompleta.length);
				strUrlCompleta = strUrlCompleta.substr(0,inicioTextoGrupo);

				titlePrincipal = "Mensajes de la Cátedra "+textoGrupo+"<small class=\"hidden-xs hidden-sm hidden-md\"> todos los mensajes</small>";
				timelineSinContenido ="No se encontraron mensajes en la Cátedra <a href='#'>" + textoGrupo + "</a>." + enlaceVolverTimelinePrincipal;
				classTipoMensajeLista =" listadoMensajesGrupoPropio";
				esTimeLineBase = 0;
			}

			if (tipomensaje.indexOf("/director")!=-1)
			{	
				strUrlCompleta = strUrlCompleta.replace("/director","/grupo");
				var inicioTextoGrupo = strUrlCompleta.lastIndexOf("/");
				var textoGrupo = strUrlCompleta.substr(inicioTextoGrupo+1,strUrlCompleta.length);
				strUrlCompleta = strUrlCompleta.substr(0,inicioTextoGrupo);

				titlePrincipal = "Mensajes del Departamento "+textoGrupo+"<small class=\"hidden-xs hidden-sm hidden-md\"> todos los mensajes</small>";
				timelineSinContenido ="No se encontraron mensajes en el Dpto <a href='#'>" + textoGrupo + "</a>." + enlaceVolverTimelinePrincipal;
				classTipoMensajeLista =" listadoMensajesGrupoPropio";
				esTimeLineBase = 0;
			}
			if (tipomensaje.indexOf("/curso")!=-1)
			{	
				var inicioTextoCurso = strUrlCompleta.lastIndexOf("/(");
				if (inicioTextoCurso==-1) {
					inicioTextoCurso = strUrlCompleta.lastIndexOf("/ (");
				} 
				var textoCurso = strUrlCompleta.substr(inicioTextoCurso+1,strUrlCompleta.length);
				strUrlCompleta = strUrlCompleta.substr(0,inicioTextoCurso);
				
				if (pagina>1) {
					strUrlCompleta = strUrlCompleta + "?pagina="+pagina;
				}
								
				titlePrincipal = "Mensajes del Curso "+textoCurso+"<small class=\"hidden-xs hidden-sm hidden-md\"> mensajes publicados en el Curso</small>";
				timelineSinContenido ="No se encontraron mensajes en el Curso <a href='#'>" + textoCurso + "</a>." + enlaceVolverTimelinePrincipal;;
				classTipoMensajeLista =" listadoMensajesCurso";
				esTimeLineBase = 0;
			}
			
			$(".content-header h1").html(titlePrincipal);

			var config = this.configuracion();
			var items = [];
						
			if (tipomensaje == "/inscripciones") {
				pagina = 0;
				urlConPagina = "/"+pagina;
				strUrlCompleta = "mensajes" + urlConPagina;
				paginaActual = pagina;
				items.push('<li id="itemFinalPagina" style="padding-left:60px;"><i class="fa fa-chevron-down"></i><a href="1" id="masElementosDelTimeLine">Obtener los mensajes ahora</a></li>');
				
				$('<ul/>', {
					'id' : 'listaMensajes',
					'class' : 'timeline',
					html : items.join('')
				}).appendTo('#timelinePrincipal');

				var loadingTimelinePrincipal = $("#timelinePrincipal div.loading-img");
				loadingTimelinePrincipal.animate({opacity : 0.25}, 600, function() {
					$(this).remove();
				});

				return;
			}

			$.getJSON(config.urlCompleta(strUrlCompleta),{},function(data) {
				var mensajes = {};
				var laFechaPublicacion = "";
				var elMomentoDesdeAhora = "";
				var elTipoMensajes = "";
				var htmlFecha = "";
				var htmlMensaje = "";
				var publicadorActual = '';
				var fechaPublicacionActual = '';
				var today = new Date();
				var divArchivo = '';
				var idArchivos = '';
				var cantidadArchivosPublicados = 0;
				var archivos = [];
				var mensajesToppy = [];
				var mensajesToppyExamen = [];
				var claseFpp = "";
				var arr = [], len;
				for (key in data) {
					arr.push(key);
				}
				
				mensajesToppy = jQuery.grep(data,function(mensaje, i) {
					return (mensaje.mensajeTipo=="TOPPY")										
				});			
				
				mensajesToppyExamen = jQuery.grep(data,function(mensaje, i) {
					return (mensaje.mensajeTipo=="TOPPYEXAMEN")										
				});			

				if (mensajesToppy.length!=0) {
					$(".mensajeToppyInTimeline").remove();
				}	

				$.each(mensajesToppy, function(i) {
					var elMensaje = mensajesToppy[i];
					var htmlExtasClass = "bg-light-blue";
					var momentoFecha = moment(elMensaje.fechaPublicacion);
					var fechaFinal = momentoFecha.format("DD/MM/YYYY");
					var html = '';		
					var titulo = elMensaje.nombreUsuarioPublica;
					var elTipoMensajeToppy = elMensaje.NombreDocumento;
					
					var id = elMensaje.id;
					var mensaje = elMensaje.mensaje;
					var htmlExtasToppy = elMensaje.data;
					
					if (htmlExtasToppy!=null || htmlExtasToppy!="") {
						//verificamos y parseamos valorem, clases, etc..
						htmlExtasClass = "bg-light-blue";
					}
					
					if (titulo=="No Definido" || titulo==null || titulo=="") {
						titulo = "Info";
					}
					
					html+= '<div id="' + id + '" class="mensajeToppyInTimeline row" style="padding-bottom:16px">'
					html+= '<div class="' + htmlExtasClass + '" style="-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);border-radius: 3px;margin-top: 0px;background: #fff;color: #444;margin-left: 16px;margin-right: 26px;padding: 10px;position: relative;padding-top:1px;">'
					html+= '<div class="timeline-item"> <span class="time" title="'+fechaFinal+'" style="float:right"><i class="fa-regular fa fa-clock"></i> '+fechaFinal+'</span><h3 class="timeline-header">'+titulo+'</h3><div class="timeline-body">'+mensaje+'</div></div>'
					//html+= '<a id="iniciarInscripcionExamenTribunales" href="javascript:void(0);">Inscribirme</a>';
					html+= '</div>'
					html+= '</div>'

					$('#timelinePrincipal').before(html);	
					
				});
				
				var htmlMensajeToppy = '';
				$.each(mensajesToppyExamen, function(i) {
					var elMensajeToppyExamen = mensajesToppyExamen[i];
					var htmlExtasClass = "bg-light-blue";
					var momentoFechaMensajeToppy = moment(elMensajeToppyExamen.fechaPublicacion);
					var fechaFinalMensajeToppy = momentoFechaMensajeToppy.format("DD/MM/YYYY");
							
					var tituloMensajeToppy = elMensajeToppyExamen.nombreUsuarioPublica;
				
					var idMensajeToppy = elMensajeToppyExamen.id;
					var mensajeMensajeToppy = elMensajeToppyExamen.mensaje;
					var htmlExtasToppy = elMensajeToppyExamen.data;
					
					if (htmlExtasToppy!=null || htmlExtasToppy!="") {
						//verificamos y parseamos valorem, clases, etc..
						htmlExtasClass = "bg-light-blue";
					}
					
					if (tituloMensajeToppy=="No Definido" || tituloMensajeToppy==null || tituloMensajeToppy=="") {
						tituloMensajeToppy = "Examenes";
					}
					
					htmlMensajeToppy+= '<div id="' + idMensajeToppy + '" class="timeline-item"> <span class="time" title="'+fechaFinalMensajeToppy+'" style="float:right"><i class="fa-regular fa fa-clock"></i> '+fechaFinalMensajeToppy+'</span>';
					htmlMensajeToppy+= '<div class="timeline-body"><a class="btn bg-purple" id="iniciarInscripcionExamenTribunales" href="javascript:void(0);">Inscribirme</a> ' + mensajeMensajeToppy + '</div>';					
					htmlMensajeToppy+= '</div>'
					
				});
				
				if (htmlMensajeToppy.length!=0) {
					var htmlMensajeToppyBody = htmlMensajeToppy;
					var htmlMensajeToppyFull = '<div class="mensajeToppyInTimeline row" style="padding-bottom:16px">';
					htmlMensajeToppyFull+= '<div class="bg-light-blue" style="-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);border-radius: 3px;margin-top: 0px;background: #fff;color: #444;margin-left: 16px;margin-right: 26px;padding: 10px;position: relative;padding-top:1px;">';
					htmlMensajeToppyFull+= htmlMensajeToppyBody;
					htmlMensajeToppyFull+= '</div>';
					htmlMensajeToppyFull+= '</div>';
					
					$('#timelinePrincipal').before(htmlMensajeToppyFull);				
				} 				
				
				var momentoFechasArray = [];
				var tipoMensajesArray = [];
				var makesArray = [];
				var docDoc = [];
				
				var encabezadoAnterior = '';
				var htmlAccionMensajeAnterior = '';
				var claseIconoAnterior = '';				
				var fechaPublicacionAnterior = '';
				
				var xDe ='';
				var xFechaPublicacion = '';
				var xJuntoEncabezado = '';
				var xJuntoArchivos = '';
				var xArchivoFisico = '';
				var xHtmlMensaje = '';
				
				var xMensajesAdjunto = []; 
				var xDex = '';
				var xEsta = [];
				var xID ='';
				var xData = '';
				
				$.each(data, function(key, val) {
					xData = data;
					armaTimeLine(key, val);
				})
				
				if (esTimeLineBase==1) {
					cache.set("timeLineBase", data);
				}
				
				function armaTimeLine(key, val) {
					var id = val.id;
					var nombrePublica = val.id;
					var nombre = val.nombre;
					var elMensaje = val.nota;
					var publicador = val.nombreUsuarioPublica;
					var mailPublicador = val.emailOrigen;
					var emailOrigen = val.emailOrigen;
					var emailDestino = val.emailDestino;
					var fechaPublicacion = val.fechaPublicacion;
					var antiguedad = val.antiguedad;
					var mensajeTipo = val.mensajeTipo;
					var alcance = val.alcance;
					var archivoFisico = val.archivoFisico;
					var extensionArchivoFisico = "";
					var tieneAdjunto = val.tieneAdjunto;
					var momentoFecha = moment(fechaPublicacion);
					var fechaPublicacionCompleta = val.fechaPublicacionCompleta;
					var momentoFechaPublicacionCompleta = moment(fechaPublicacionCompleta);
					var fechaPublicacionCompletaFinal = momentoFechaPublicacionCompleta.format("DD/MM/YYYY HH:mm:ss");
					var pideAutorizacion = val.pideAutorizacion;
					var mensajeContactoAutorizacionEstadoDescripcion = val.mensajeContactoAutorizacionEstadoDescripcion;
					var mensajeContactoAutorizacionEstadoId = val.mensajeContactoAutorizacionEstadoId;
					var de = val.de;
					var respuestaAmensajeId = val.respuestaAmensajeId;
					var conversationIcon = respuestaAmensajeId == "0" ? "": "<li class='fa fa-comments' />&nbsp;"
					var verboTexto = "";
					var verboTextoYoPresente = "escribó";
					var verboTextoYoPasado = "escribí";
					var verboTextoOtroPasado = "escribió";
					var verboTextoOtro = "escribí";
					var bloqueaEmail = val.bloqueaEmail;
					var respuestaAMensajeId = val.respuestaAmensajeId;
					var foto = val.foto;
					var especialidad = val.especialidad;
					var plan = val.plan;
					var materia = val.materia;
					var comision = val.comision;
					var anioComision = val.anioAcademico; 
					var espamacoan = anioComision+'-'+especialidad+'-'+plan+'-'+materia+'-'+comision;
					var elAdjuntoEsUnaImagen = false;
					var elAdjuntoEsUnPdf = false;
					var enlaceParaVerLaImagen = '';
					var enlaceParaVerElArchivo = '';
					var incluirFechaDerecha = 1;
					var htmlIncluirFechaDerechaFinal = "";
					var htmlIncluirFechaDerecha = "";
					var claseFppColor = "bg-red";
					var laData = val.data;
					var tipoEspecial = "";

					var hayFoto = "";
					var dominio = "";
					
					if (urlifyMensajes==1) elMensaje = anchorme(elMensaje, {
								attributes:[{
									name:"target",
									value:"_blank"
								},
								function(urlObj){
									if(urlObj.protocol !== "mailto:") return {name:"target",value:"blank"};
								}]
							}							
					);
					if (replaceLineBreakWithHtml==1) {
						elMensaje = elMensaje.replace(/(?:\r\n|\r|\n)/g, '<br>');
					}
					
					if (emailOrigen != null) {
						if (getMail() == emailDestino) {
							var ind = emailOrigen.indexOf("@") + 1;
							var fin = emailOrigen.indexOf(".",ind) + 1 ;
							var largo = fin - ind;
							dominio = emailOrigen.substring(ind,fin);
						} else {
							var ind = emailDestino.indexOf("@") + 1;
							var fin = emailDestino.indexOf(".",ind) + 1;
							var largo = fin - ind;
							
							dominio = emailDestino.substring(ind,fin);
						}
						dominio = dominio.toUpperCase(); 
					}
					
					if (typeof publicador === "undefined") {
						publicador = "";
					}
					
					var fpp = moment().diff(momentoFechaPublicacionCompleta, 'day');
					if (fpp<0) {
						claseFpp = "futuro";
						claseFppColor = "bg-orange";
					} else if (fpp==0) {
						claseFpp = "presente";
						claseFppColor = "bg-aqua";
					} else {
						claseFpp = "pasado";
						claseFppColor = "bg-red";
					}
					
					
					if (nombre == "")
						nombre = alcance;

					var conjuncionTexto = " a ";
					var ambito = alcance;

					if (emailOrigen != null) {
						if (emailOrigen != getMail()) {
							verboTexto = " me "
									+ verboTextoOtroPasado;
						} else {
							verboTexto = verboTextoYoPasado;
						}
					}
					/*
					 * organizado por fecha de publicacion con
					 * moment from today
					 */
					var momentoDesdeAhora = momentoFecha.from(today);
					momentoDesdeAhora = ((momentoDesdeAhora));				

					if ($.inArray(elMomentoDesdeAhora,momentoFechasArray) == -1) {
						var momentoFechaFiltroTexto = momentoFecha.from(today);// fechaPublicacion;
						momentoFechaFiltroTexto = ((momentoFechaFiltroTexto));
						momentoFechasArray.push(momentoFechaFiltroTexto);
					}

					if (elMomentoDesdeAhora == momentoDesdeAhora) {
						htmlFecha = "";
					} else {
						if (mensajeTipo == 'F02') { momentoDesdeAhora = momentoFecha.calendar(); }
						
						htmlFecha = '<li class="time-label ' + claseFpp + '"><span class="' + claseFppColor + '">'+ momentoDesdeAhora+ '</span></li>';
						elMomentoDesdeAhora = momentoDesdeAhora;
					}

					if (tieneAdjunto == 1) {
						if ($.inArray("ADJUNTOS",tipoMensajesArray) == -1) {
							tipoMensajesArray.push("ADJUNTOS");
						}
					}
					
					if ($.inArray(elTipoMensajes,tipoMensajesArray) == -1) {
						var tipoMensajeFiltroTexto = mensajeTipo
						tipoMensajesArray.push(tipoMensajeFiltroTexto);
					}

					if (elTipoMensajes == mensajeTipo) {
					} else {
						elTipoMensajes = mensajeTipo;
					}

					extensionArchivoFisico = "generico";
					var dot = "bin";
					if (archivoFisico!=null) {
						dot = archivoFisico.lastIndexOf(".");
						if (dot > 0) {
							extensionArchivoFisico = archivoFisico.substring(dot + 1).toLowerCase();
						}
					}
										
					if (extensionArchivoFisico=="png" || extensionArchivoFisico=="jpg" || extensionArchivoFisico=="gif" || extensionArchivoFisico=="jpeg") {
						elAdjuntoEsUnaImagen = true;	
					} 

					if (extensionArchivoFisico=="pdf") {
						elAdjuntoEsUnPdf  = true;	
					} 
					
					var infoAdicionalEncabezado = '';
					var encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador+ '</a> '+ infoAdicionalEncabezado + '</h3>';
					var cuerpo = '<div class="timeline-body"> '+ elMensaje + '</div>';
					var pie = '';
					var claseIcono = 'fa-envelope bg-blue';
					var fechaPublicacionFinal = '';
					var htmlAccionMensajeInicial = '<div class="btn-group"><button type="button" class="btn btn-default btn-flat dropdown-toggle" data-toggle="dropdown" style="padding:0px 5px 3px 5px;border:0px solid white;"><span class="caret"></span></button><ul class="dropdown-menu">';
					var htmlAccionMensajeEliminar = '<li> <a href="javascript:void(0);" class="marcaEliminado" id="marcaEliminado'+ id+ '"><i class="fa fa-trash"></i> Eliminar</a></li>';
					var htmlAccionMensajeLeido = '<li><a href="javascript:void(0);" class="marcaEstadoLeido" id="marcaEstadoLeido'+ id+ '">Leido</a></li>';
					var htmlAccionMensajeOcultar = '<li><a href="javascript:void(0);" class="marcaEstadoOculto" id="marcaEstadoOculto'+ id+ '">Ocultar</a>';
					var htmlAccionMensajeBloquear = '<li><a href="javascript:void(0);" class="marcaBloquear" id="marcaBloquear'+ id+ '">Bloquear</a></li>';
					var htmlAccionMensajeReportar = '<li><a href="javascript:void(0);" class="marcaDenuncia" id="marcaDenuncia'+ id+ '">Reportar</a></li>';
					var htmlAccionMensajeConfigurar = '<li><a href="javascript:void(0);" class="marcaConfiguracion" id="marcaConfiguracion'+ id+ '">Visibilidad</a></li>';
					var htmlSeparador = '<li class="divider"></li>';					
					var htmlAccionMensajeFinal = '</ul></div>';
					var htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlSeparador + htmlAccionMensajeBloquear + htmlSeparador + htmlAccionMensajeReportar + htmlAccionMensajeFinal;

					if (!nombre) {
						nombre = '';
					}

					if (mensajeTipo == 'EXPEDIENTE') {
						claseIcono = "fa-sticky-note bg-green";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						
						var data = $(this).attr("data");
						var splitData = laData.split("|");
						var idData = splitData[0];
						var estadoData = splitData[1];
						
						var cadenaExpediente = idData.split("-");
						var anioExpediente = cadenaExpediente[0];
						var idExpediente = cadenaExpediente[1];					
						var tipoExpediente = cadenaExpediente[3];
						var urlDescargaExpediente = " <a href=\"archivo/descargar/expediente/" + idData + "\" class=\"archivoExpedientes\" title=\"Descargar Expediente\"><i class=\"fa fa-download text-green\"></i> descargar</a> ";
						var urlDescargaExpedienteFinal = "";
						
						if (estadoData=='Aprobado') {
							if (tipoExpediente==83 || tipoExpediente==62) {
								urlDescargaExpedienteFinal = urlDescargaExpediente;
							}
						}
						var losExpedientes = ' <a href="#" class="menuExpendienteTimelineTodos small" data="' + laData + '" title="Ver todos los expedientes">(Todos)</a> ';
						
						var indexOfMensajeExpediente = elMensaje.indexOf('de'); 
						var inicioMensajeExpediente = elMensaje.substring(0,indexOfMensajeExpediente);
						var finMensajeExpediente = elMensaje.substring(indexOfMensajeExpediente,elMensaje.length);

						var finalInicioMensajeExpediente = ' <a href="#" class="menuExpendienteTimeline" data="' + laData + '" title="Ver el expediente">detalle. </a> '; 					
					
						var elMensajeAModificar = elMensaje + '. <a href="#" class="menuExpendienteTimeline" data="' + laData + '" title="Ver el expediente">detalle. </a> ' + urlDescargaExpedienteFinal ;						
						encabezado = '<h3 class="timeline-header no-border">'+ elMensajeAModificar + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
					}
					
					if (mensajeTipo == 'TOPPY') {
						claseIcono = "fa-thumb-tack bg-blue";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						var elMensajeAModificar = elMensaje;						
						encabezado = '<h3 class="timeline-header no-border">'+ elMensajeAModificar + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
					}

					if (mensajeTipo == 'TRAMITE') {
						claseIcono = "fa-exchange bg-green";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						var elMensajeAModificar = elMensaje;						
						encabezado = '<h3 class="timeline-header no-border">'+ elMensajeAModificar + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
					}
					
					if (mensajeTipo == 'CURSADO') {
						claseIcono = 'fa-briefcase bg-yellow';
						var enlaceCompletoPublicador = 'El Docente <a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador + '</a> publicó ';
						if (publicador=="No Definido") { enlaceCompletoPublicador = 'El Docente publicó'; } 						
						encabezado = '<h3 class="timeline-header">'+enlaceCompletoPublicador+'</h3>';
						var elMensajeAModificar = elMensaje;						
						var mensajeModificarInicial = elMensajeAModificar.replace('En La materia','En la materia <a data-id="'+espamacoan+'" class="alcance" href="#">');
						var mensajeModificarFinal = mensajeModificarInicial.replace('se ha modificado','</a>se ha modificado');						
						var cuerpo = '<div class="timeline-body"> '+ mensajeModificarFinal + '</div>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;						
						pie = '';
					}

					if (mensajeTipo == 'CURSADO' && (emailOrigen==emailDestino)) {
						var estaElMensajeTeInscribiste = elMensaje.indexOf("Te inscribiste a cursar");
						
						if (estaElMensajeTeInscribiste!=-1) {

							var lastIndexOfTeInscribiste = elMensaje.lastIndexOf("Te inscribiste a cursar");
							var laMateriaTeInscribisteLimpia  = elMensaje.substring(lastIndexOfTeInscribiste, elMensaje.length);
							var laMateriaTeInscribisteCompleta = '<a data-id="'+espamacoan+'" class="alcance" href="#">' + laMateriaTeInscribisteLimpia + '</a>';
							elMensaje = '<a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'"> Me </a> inscribí a cursar ' + laMateriaTeInscribisteCompleta.replace("Te inscribiste a cursar","");
							encabezado = '<h3 class="timeline-header no-border">' + elMensaje + '</h3>';

						} else {
							encabezado = '<h3 class="timeline-header no-border"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador + '</a> ' + elMensaje + '</h3>';	
						}
						
											
						cuerpo = '';
						pie = '';				
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
					}

					if (mensajeTipo == 'EXAMENES') {
						claseIcono = 'fa-file-text bg-red';
						var encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador+ '</a> '+ infoAdicionalEncabezado + '</h3>';
						var elMensajeAModificar = elMensaje;
						var mensajeModificarInicial = elMensajeAModificar.replace('En la materia','En <a data-id="'+espamacoan+'" class="alcance" href="#">');				
						var mensajeModificarFinal = mensajeModificarInicial.replace('se ha Cargado','</a><span class="hidden-xs hidden-md hidden-sm">se ha cargado</span>');
						var mensajeModificarFinal = mensajeModificarFinal.replace(':',': <strong>');						
						
						var cuerpo = '<div class="timeline-body"> '+ mensajeModificarFinal + '</strong></div>';						
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
						pie = '';				
						
					}
					if (mensajeTipo == 'E01') {
						claseIcono = 'fa-file-text bg-red';

						var estaElMensajeTeInscribiste = elMensaje.indexOf("Acta Impresa");
						
						if (estaElMensajeTeInscribiste!=-1) {
							var elMensajeAModificar = elMensaje;
							var mensajeModificarInicial = elMensajeAModificar.replace('Exámenes: Estás Inscripto al Examen de','Estás inscripto al Examen de <a data-id="'+espamacoan+'" class="alcance" href="#">');
							var mensajeModificarFinal = mensajeModificarInicial.replace('Acta Impresa','</a>Acta Impresa');
							var mensajeModificarFinal = mensajeModificarFinal.replace('Fecha del Exámen ','.<strong> Fecha del Exámen <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">');
							var cuerpo = '<div class="timeline-body"> '+ mensajeModificarFinal + '</a></strong></div>';
							htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
							pie = '';

						} else {
							var elMensajeAModificar = elMensaje;
							
						    var inicioDeLaFechaDelExamen = elMensajeAModificar.indexOf("Fecha del Exámen");
						    var mensajeModificarFinal = elMensajeAModificar.substring(inicioDeLaFechaDelExamen, elMensajeAModificar.length);
						    var FechaDelExamenFinalAMostrar = mensajeModificarFinal.replace("Fecha del Exámen","");
							
							
							var mensajeModificarInicial = elMensajeAModificar.replace('Exámenes: Estás Inscripto al Examen de','Me inscribí al Examen <a data-id="'+espamacoan+'" class="alcance" href="#">');
							mensajeModificarFinal = mensajeModificarInicial.replace('<br/>Aun no ha sido Impresa tu Acta de Examen','</a> del <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">' + FechaDelExamenFinalAMostrar + '</a>. Aun no ha sido impresa el acta de Examen');
							
							var inicioFinalDeLaFechaDelExamen = mensajeModificarFinal.indexOf("Fecha del Exámen");
							mensajeModificarFinal = mensajeModificarFinal.substring(0, inicioFinalDeLaFechaDelExamen);
						
							var encabezado = '<h3 class="timeline-header no-border">' + mensajeModificarFinal + '</h3>';
							var cuerpo = '';
							htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
							pie = '';

						}						
					}

					if (mensajeTipo == 'DOCENTE') {
						claseIcono = "fa-user bg-aqua";
						encabezado = '<h3 class="timeline-header">El Docente <a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador + '</a> publicó</h3>';
						pie = '<div class="timeline-footer">En <b><a data-id="'+espamacoan+'" href="#" class="alcance">'+ alcance + '</a></b></div>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;						
					}

					if (mensajeTipo == 'MENSAJECANCELADO') {
						claseIcono = "fa-user bg-aqua";
						encabezado = 'h3 class="timeline-header">El Docente <a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador + '</a> publicó</h3>';
						pie = '<div class="timeline-footer">En <b>'+ alcance + '</b></div>';
					}

					if (mensajeTipo == 'E03') {
						claseIcono = "fa-calendar bg-light-blue";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazoTexto = 'Feriado: <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">'+ fechaReemplazo + '</a> ';
						fechaReemplazoFinal = elMensaje.replace("Feriado: ",fechaReemplazoTexto);
						encabezado = '<h3 class="timeline-header no-border">'+ fechaReemplazoFinal + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
					}

					if (mensajeTipo == 'F01') {					
						claseIcono = "fa-calendar bg-purple";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazoTexto = 'Feriado: <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">'+ fechaReemplazo + '</a> ';
						fechaReemplazoFinal = elMensaje.replace("Feriado: ",fechaReemplazoTexto);
						//casos especiales 
						if (foto=="externa") {
							hayFoto = '<img src="//st.frc.utn.edu.ar/autogestion/4/i/special/'+momentoFecha.format("DDMMYYYY")+'.gif" style="margin-bottom:-40px" alt="' + tipoEspecial + '" title="'+ tipoEspecial + '" />';							
						}
						//if (elMensaje.indexOf("Navidad")!=-1) {
							//hayFoto = '<img src="//st.frc.utn.edu.ar/autogestion/4/i/special/'+momentoFecha.format("DD/MM/YYYY")+'.gif" style="margin-bottom:-40px" alt="'+tipoEspecial+'" title="Feliz Navidad!" />';
							//hayFoto = '<img src="/4/archivo/recursos/'+momentoFecha.format("DDMMYYYY")+'.gif" style="margin-bottom:-40px" alt="'+mensajeTipo+'" title="Feliz Navidad!" />';						
						
						//}						
						encabezado = '<h3 class="timeline-header no-border">'+ fechaReemplazoFinal + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
						
					}

					if (mensajeTipo == 'F02') {
						claseIcono = "fa-birthday-cake bg-red";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazo = momentoFecha.calendar();
						if (fechaReemplazo=="Mañana") {
							fechaReemplazoTexto = 'Es tu Cumpleaños!!!';
						} else {
							fechaReemplazoTexto = 'Te deseamos un muy Feliz Cumpleaños!!!';
						}						
						encabezado = '<h3 class="timeline-header no-border bg-red">'+ fechaReemplazoTexto + '&nbsp;<!--<a id="enviarInvitacionCumple" class="btn btn-success btn-xs">Invitar Grupo </a>--></h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial.replace("btn-default","btn-danger") + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						incluirFechaDerecha = 0;
						htmlIncluirFechaDerecha = '<span class="time"> ' + htmlAccionMensaje + '</span>';
						cuerpo = '';
						pie = '';
					}

					if (mensajeTipo == 'BIBLIOTECA') {
						claseIcono = "fa-book bg-red";
	
						claseIcono = "fa-book bg-yellow";
						var elMensajeAModificar = elMensaje;
						var fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						var mensajeModificarInicial = elMensajeAModificar.replace('El Préstamo del Libro','Próximo a Vencer: <a href="#" class="busquedaLibro">');
						var mensajeModificarFinal = mensajeModificarInicial.replace('Autor:','</a> Autor:');
						var mensajeModificarFinal = mensajeModificarFinal.replace('vence el',' vence el <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">');
						var encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">Prestamo Biblioteca</a> </h3>';						
						var cuerpo = '<div class="timeline-body"> '+ mensajeModificarFinal + '</a></div>';
						//var cuerpo = '';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;						
						pie = '';

					}

					if (mensajeTipo == 'B01') {
						claseIcono = "fa-book bg-teal";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazoTexto = 'Préstamo Próximo a Vencer: <i class="fa fa-calendar"></i> <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" rel="popover">'+ fechaReemplazo + '</a> ';
						fechaReemplazoFinal = elMensaje.replace("Feriado: ",fechaReemplazoTexto);
						encabezado = '<h3 class="timeline-header no-border">'+ fechaReemplazoFinal + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '';
						pie = '';
					}

					if (mensajeTipo == 'B02') {
						claseIcono = "fa-book bg-red";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						var lastIndexOfFechaVencimiento = elMensaje.lastIndexOf("venció el");
						var fechaVencimiento = elMensaje.substring(lastIndexOfFechaVencimiento+9,elMensaje.length);
						
						var elMensajeParser = elMensaje.replace("El Préstamo del Libro","");
						var elMensajeParserFinal = elMensajeParser.substring(0,lastIndexOfFechaVencimiento-22);
						
						fechaReemplazoFinal = 'Préstamo Vencido: <i class="fa fa-calendar"></i> '+ fechaVencimiento + '</a> del libro ' + elMensajeParserFinal;
						   
						encabezado = '<h3 class="timeline-header no-border">'+ fechaReemplazoFinal + '</h3>';
						cuerpo = '';
						pie = '';
					}

					if (mensajeTipo == 'R01') {
						claseIcono = "fa-clipboard bg-maroon";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazoTexto = '<i class="fa fa-calendar"></i> <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');">'+ fechaReemplazo+ '</a> ';
						fechaReemplazoFinal = elMensaje.replace(fechaReemplazo,fechaReemplazoTexto);
						encabezado = '<h3 class="timeline-header">El Docente <a href="#" class="busquedaUsuario">'+ publicador+ '</a> reserva la fecha</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;						
						cuerpo = '<div class="timeline-body"> '+ fechaReemplazoFinal+ '</div>';
						pie = '<div class="timeline-footer"><a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" class="btn btn-primary btn-xs"><i class="fa fa-calendar"></i> &nbsp;Ver en Calendario</a></div>';
					}

					if (mensajeTipo == 'R01') {
						claseIcono = "fa-clipboard bg-maroon";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						fechaReemplazoTexto = '<i class="fa fa-calendar"></i> <a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');">'+ fechaReemplazo+ '</a> ';
						fechaReemplazoFinal = elMensaje.replace(fechaReemplazo,fechaReemplazoTexto);
						encabezado = '<h3 class="timeline-header">El Docente <a href="#" class="busquedaUsuario">'+ publicador+ '</a> reserva la fecha</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;						
						cuerpo = '<div class="timeline-body"> '+ fechaReemplazoFinal+ '</div>';
						pie = '<div class="timeline-footer"><a href="javascript:verAgenda(\'#contenedorCalendario\',\''+ momentoFecha.format("YYYY-MM-DD")+ '\');" class="btn btn-primary btn-xs"><i class="fa fa-calendar"></i> &nbsp;Ver en Calendario</a></div>';
					}


					if (mensajeTipo == 'V01') {
						claseIcono = "fa-calendar bg-purple";
						encabezado = '<h3 class="timeline-header">Publicaste en tu agenda</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						cuerpo = '<div class="timeline-body"> '+ elMensaje + '</div>';
					}
										
					if (mensajeTipo == 'PRIVADO') {
						claseIcono = "fa-comments bg-teal";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");

						encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario">'+ publicador+ '</a> '+ verboTexto+ conjuncionTexto+ ambito + '</h3>';
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeEliminar + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlSeparador + htmlAccionMensajeBloquear + htmlSeparador + htmlAccionMensajeReportar + htmlAccionMensajeFinal;						
						// este es un mensaje privado
						if(respuestaAmensajeId == "0") // es un mensaje que no se ha transformado en conversacion
						{	
							if (mailPublicador.toUpperCase() != mail.toUpperCase())//UN MENSAJE DE UN TERCERO 
							{ 
								encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario">'+ publicador + '</a> '+ verboTextoOtroPasado+ ':' + '</h3>';
								pie = '<div class="timeline-footer"><div id="itemBotoneraMensaje'+ id+ '" class="botoneraAcciones" data-tipomensaje='+ mensajeTipo+ '  data-conversacion="'  + id + '"><a class="btn btn-success btn-xs"  id="itemConversacion_EscribirRespuesta_'+ id + '" data-publicador="'+ mailPublicador+ '" data-conversacion="'  + id + '"><i class="fa fa-mail-reply"></i>&nbsp;Responder </a></div> </div>';
							} else  {//// un mensaje que yo envie a alguien	DE ACUERDO CON CESAR SI NO ES UNA CONVERSACION NO VOY A PODER CONTESTAR UN MENSAJE MIO
								claseIcono = "fa-bookmark bg-olive";
								if (mailPublicador.toUpperCase() == emailDestino.toUpperCase()) {
									encabezado = '<h3 class="timeline-header">'+ conversationIcon+ '<a href="#" class="busquedaUsuario">'+ publicador+ '</a> '+ ' anoté </a></h3>';
								} else {
									encabezado = '<h3 class="timeline-header">'+ conversationIcon+ ' Mensaje para <a href="#" class="busquedaUsuario">' + nombre + '</a></h3>';
								}
																
								pie = "";
							}
						} else {							
							if (mailPublicador.toUpperCase() != mail.toUpperCase()) {
								encabezado = '<h3 class="timeline-header">Conversación con <a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'" data-foto="'+ urlFotoPerfil(foto)+'">'+ nombre + '</a></h3>';
							} else {
								encabezado = '<h3 class="timeline-header">Conversación con <a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'" data-foto="'+urlFotoPerfil(foto)+'">'+ publicador + '</a></h3>';
							}
							htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
							var cuerpo = '<div class="timeline-body" id="itemConversacion_' + respuestaAMensajeId + '">'+ elMensaje + ' ... <a href="#" id ="itemConversacion_Obtener_' + respuestaAMensajeId + '"  data-persona="'+ nombre + '" data-foto="' + urlFotoPerfil(foto) + '"><i	class="fa fa-plus-square"> más ...</i></a></div>';
							pie = '<div class="timeline-footer"><div id="itemBotoneraMensaje'+ id+ '" data-conversacion="'  + respuestaAmensajeId + '" class="botoneraAcciones" data-tipomensaje='+ mensajeTipo+ '><a class="btn btn-success btn-xs"  id="itemConversacion_EscribirRespuesta_'+ id + '" data-publicador="'+ mailPublicador+ '" data-conversacion="'  + respuestaAMensajeId + '" data-persona="'+ nombre + '" data-foto="'+foto+'"><i class="fa fa-mail-reply"></i>&nbsp;Responder </a></div> </div>';
							
						}
						if (foto!=null) {							
							if (usuarioPublicoFotoPerfil(foto)) {
								hayFoto = '<img alt="" src="'+urlFotoPerfil(foto)+'" class="direct-chat-img" style="margin-left:12px"/>';
							} else {
								hayFoto = ""; 
							}
							
						}
					
					}

					if (mensajeTipo == 'PRIVADO-AUTOMATICO') {
						claseIcono = "fa-user bg-red";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");						
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeConfigurar + htmlAccionMensajeFinal;
						pie = '';
					}	
					if (mensajeTipo == 'GRUPO-PRIVADO') {
						claseIcono = "fa-group bg-orange";
						
						if (ambito){					
							if (ambito.indexOf("(Eliminado)")>0) {
								ambito = "<del>"+ambito+"</del>";
							}
						}
						encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador+ '</a> '+ verboTexto + ' en el grupo <a href="#">' + ambito + '</a></h3>';
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						pie = '';
						
						if (foto!=null) {							
							if (usuarioPublicoFotoPerfil(foto)) {
								hayFoto = '<img alt="" src="'+urlFotoPerfil(foto)+'" class="direct-chat-img" style="margin-left:12px"/>';
							} else {
								hayFoto = ""; 
							}
							
						}
						htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeEliminar + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlSeparador + htmlAccionMensajeBloquear + htmlSeparador + htmlAccionMensajeReportar + htmlAccionMensajeFinal;
					
					}

					if (mensajeTipo == 'GRUPO-INVITACION') {
						claseIcono = "fa-bullhorn bg-navy";
						
						encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ publicador+ '</a> invitó al Grupo <a href="#">' + ambito + '</a></h3>';
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						
						var invitacionSingular = 'Agregar a ';
						var invitacionSingularTamanio = invitacionSingular.length-1;
						var invitacionPlural = 'Agregar a los Usuarios';
						var invitacionSingularTamanio = invitacionPlural.length-1;
						var elBoton = '';
						
						var elMensajeIndexOf = elMensaje.indexOf(invitacionSingular);
						
						if (elMensajeIndexOf!=-1) {
							elMensaje = elMensaje.substr(invitacionSingularTamanio);
							elMensaje = invitacionSingular + elMensaje;
							elBoton = '<a href="#" class="btn btn-success btn-xs"><i class="fa fa-plus"></i> &nbsp;Agregar al Usuario</a>';
							
						} else {
							elMensajeIndexOf = elMensaje.indexOf(invitacionPlural);

							elMensaje = elMensaje.substr(invitacionSingularTamanio);
							elMensaje = invitacionSingular + elMensaje;
							elBoton = '<a href="#" class="btn btn-success btn-xs"><i class="fa fa-plus"></i> &nbsp;Agregar a los Usuarios</a>';

						}
							
						var cuerpo = '<div class="timeline-body"> ' + elMensaje + '</div>';
						pie = '<div class="timeline-footer">'+elBoton+'</div>';
						
					}
					

					if (pideAutorizacion == '1') {
						claseIcono = "fa-user bg-red";
						fechaReemplazo = momentoFecha.format("DD/MM/YYYY");
						pie = '<div class="timeline-footer"><div id="itemBotoneraMensaje'+ id+ '" class="botoneraAcciones"><a href="javascript:void(0)" class="btn btn-success btn-xs" id="itemAutorizacion_Autorizar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-up" ></i>&nbsp;Autorizar </a>&nbsp; <a href="javascript:void(0)" class="btn btn-danger btn-xs" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Rechazar </a></div></div>';
					}
					// estados Pendiente Autorizado Rechazado
					// Bloqueado Cancelado
					var estadoMensaje = "";
					if (mensajeContactoAutorizacionEstadoId.length > 0 && mensajeContactoAutorizacionEstadoId != 0) {
						// independiente de la persona que comenzo la solicitud de contacto
						var currentMail = mail.toLowerCase();
						if (mensajeContactoAutorizacionEstadoId == 4) {
							saccion = "bloqueado"
							if (currentMail == bloqueaEmail.toLowerCase())
							{	encabezado = '<h3 class="timeline-header no-border">has bloqueado a '+ nombre + '(' +dominio + ')'; // +// '</h3>';
								pie="";//sin Botones por ahora";
							}
							else
							{
								encabezado = '<h3 class="timeline-header no-border">' + nombre + '(' +dominio + ')'  + ' te ha bloqueado ' ; // +// '</h3>';
							}
						}
						else
						{	
								if (mailPublicador.toUpperCase() != mail.toUpperCase()) 
								{// no es mi
			
									encabezado = '<h3 class="timeline-header no-border"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ nombre + '</a> solicitó agregarme &nbsp;';
									if (mensajeContactoAutorizacionEstadoId == '3' ) {
										pie = ''; // lo bloquee o
										// rechace
									} 
									else if (mensajeContactoAutorizacionEstadoId == '2') 
									{
										
										encabezado = encabezado + '<a href="javascript:void(0)" class="btn btn-warning btn-xs" id="itemAutorizacion_Bloquear_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-ban" ></i>&nbsp;Bloquear </a> <a href="javascript:void(0)" class="btn btn-danger btn-xs" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Quitar </a>';
									} 
									else if (mensajeContactoAutorizacionEstadoId == '1' && pideAutorizacion == '1') 
									{
									
										encabezado = encabezado+ '<a href="javascript:void(0)" class="btn btn-success btn-xs" id="itemAutorizacion_Aceptar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-up" ></i>&nbsp;Autorizar </a> <a href="javascript:void(0)" class="btn btn-danger btn-xs" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Rechazar </a>';
									}
									pie = '';
									encabezado = encabezado + '</h3>';
			
								} 
								else // es una solicitud mia a terceros
								{
									encabezado = '<h3 class="timeline-header no-border"><a href="#" class="busquedaUsuario" data-id="'+mailPublicador+'">'+ 'Yo'+ '</a> solicit&eacute a <a href="#">'+ nombre+ '</a> me agregue a sus contactos';
									if (mensajeContactoAutorizacionEstadoId == '3'  || mensajeContactoAutorizacionEstadoId == '5') { // rechzado
										claseIcono = "fa-comment bg-purple";
										var saccion = "";
										if (mensajeContactoAutorizacionEstadoId == 3) {
											saccion = "rechazado"
											encabezado = '<h3 class="timeline-header no-border">'+ mailPublicador+ ' ha ' + saccion;// + '// tu// solicitud</h3>';
										}
										if (mensajeContactoAutorizacionEstadoId == 5) {
											saccion = "cancelado"
											encabezado = '<h3 class="timeline-header no-border">'+ ' has '+ saccion+ ' la solicitud que realizaste a '+ alcance; // +// '</h3>';
										}
			
										cuerpo = '';
										pie = '';
									} 
									else if (mensajeContactoAutorizacionEstadoId == '2') 
									{ // esta
										pie = '<a href="javascript:void(0)" class="btn btn-warning btn-xs ladda-button" id="itemAutorizacion_Bloquear_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-ban" ></i>&nbsp;Bloquear </a><a href="javascript:void(0)" class="btn btn-danger btn-xs" id="itemAutorizacion_Rechazar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Quitar </a>';
									} 
									else if (mensajeContactoAutorizacionEstadoId == '1') 
									{ // esuna
										pie = '<a href="javascript:void(0)" class="btn btn-danger btn-xs ladda-button" id="itemAutorizacion_Cancelar_'+ id+ '" data-publicador="'+ mailPublicador+ '"><i class="fa fa-thumbs-down"></i>&nbsp;Cancelar </a>';
									}
			
								}
						}
						cuerpo = '';					
						encabezado = encabezado + ' ' + pie + '</h3>';// + pie;
						pie = '';
					}

					if (elMensaje.indexOf("Agregar a ,")>0) {
						claseIcono = "fa-group bg-orange";						
						encabezado = '<h3 class="timeline-header"><a href="#" class="busquedaUsuario">'+ publicador+ '</a> '+ verboTexto+ conjuncionTexto+ ambito + '</h3>';
						fechaReemakesArraymplazo = momentoFecha.format("DD/MM/YYYY");
						pie = '<div class="timeline-footer"><a href="#" class="btn btn-primary btn-xs"><i class="fa fa-plus"></i> &nbsp;Agregar al Grupo</a></div>';
					}
					
					
					if (tieneAdjunto == 1) {

						if (mensajeTipo == 'DOCENTE') {
							var quien = 'El Docente';
						}

						encabezado = '<h3 class="timeline-header">'+ quien+ ' <a href="#" class="busquedaUsuario" data-id="' + mailPublicador + '">'+ publicador + '</a> publicó archivo(s)</h3>';
						claseIcono = "fa-file bg-green";
						xEsta = jQuery.grep(xMensajesAdjunto,function(mensaje, i) {
							return (mensaje.id==id);
						});

						if (xEsta.length==1) {
							
						} else {
							xMensajesAdjunto = jQuery.grep(xData,function(mensaje, i) {					
								if (fechaPublicacion==mensaje.fechaPublicacion && de==mensaje.de && tieneAdjunto==mensaje.tieneAdjunto) {
									return mensaje;
								}																
							});
							
							var cantidadMensajes = 0;
							var idArchivos = '';
							var separadorIdArchivos = '';
							
							if (xMensajesAdjunto) {
								
								divArchivo = '';
								var enlaceParaVerLaImagen = '';
								var enlaceParaVerElArchivo = '';
								var fechaPublicacionArchivoUnico = '';
								var momentoFechaPublicacionArchivoUnico = '';
								var fechaPublicacionArchivoUnicoFinal = '';
								var htmlFechaPublicacionArchivoUnico = '';

								cantidadMensajes = xMensajesAdjunto.length;
								divArchivo = divArchivo + '<table id="tablaArchivoDescarga'+ id + '">'
								
								for (var i = 0; i < cantidadMensajes; i++) {
									var elMensajeArchivo = xMensajesAdjunto[i];
																										
									extensionArchivoFisico = "generico";
									var dot = "bin";
									if (elMensajeArchivo.archivoFisico!=null) {
										dot = elMensajeArchivo.archivoFisico.lastIndexOf(".");
										if (dot > 0) {
											extensionArchivoFisico = elMensajeArchivo.archivoFisico.substring(dot + 1).toLowerCase();
										}
									}
														
									if (extensionArchivoFisico=="png" || extensionArchivoFisico=="jpg" || extensionArchivoFisico=="gif" || extensionArchivoFisico=="jpeg") {
										elAdjuntoEsUnaImagen = true;	
									} else {
										elAdjuntoEsUnaImagen = false;
									}

									if (extensionArchivoFisico=="pdf") {
										elAdjuntoEsUnPdf  = true;	
									} else {
										elAdjuntoEsUnPdf  = false;
									}
									
									if (elAdjuntoEsUnaImagen) {
										enlaceParaVerLaImagen = ' <a class="archivoVerEnLinea" href="archivo/ver/imagen/'+elMensajeArchivo.id+'" target="_blank" data-toggle="tooltip" title="Ver Imagen"><i class="fa fa-eye"></i></a>';
									} else {
										enlaceParaVerLaImagen = '';
									}
									if (elAdjuntoEsUnPdf) {
										enlaceParaVerElArchivo = ' <a class="archivoVerEnLinea" href="archivo/ver/documento/'+elMensajeArchivo.id+'" target="_blank" data-toggle="tooltip" title="Ver Documento"><i class="fa fa-eye"></i></a>';
									} else {
										enlaceParaVerElArchivo = '';
									}

									var fechaPublicacionArchivoUnico = elMensajeArchivo.fechaPublicacionCompleta;
									var momentoFechaPublicacionArchivoUnico = moment(fechaPublicacionCompleta);
									var fechaPublicacionArchivoUnicoFinal = momentoFechaPublicacionCompleta.format("DD/MM/YYYY HH:mm:ss");
									var htmlFechaPublicacionArchivoUnico = ' <span class="time" title="' + fechaPublicacionArchivoUnicoFinal + '" style="color:#3c8dbc"><i class="fa-regular fa fa-clock"></i></span>';
									
									idArchivos = elMensajeArchivo.id + ',' + idArchivos;
									
									if (i==(cantidadMensajes-1)) { 
										idArchivos = idArchivos.slice(0,-1);
									} 

									divArchivo = divArchivo + '<tr><td rowspan="2" align="center" valign="top" style="padding-bottom:10px;"><a href="archivo/descargar/'+ elMensajeArchivo.id+ '" class="archivosDescarga" id="archivosDescarga'+ elMensajeArchivo.id+ '">';
									//if (elAdjuntoEsUnaImagen) //ver si continuamos usando esta preferencia  nates && preferenciaMostrarThumbnail!=0
									//	{
									//	divArchivo = divArchivo + '<img src="/4/archivo/ver/imagen/th/'+elMensajeArchivo.id+'?A4-Token='+A4Token+'&A4-TimeStamp='+A4TimeStamp+'&A4-Data='+A4Data + '" />'; 									
									//} else {
									//	divArchivo = divArchivo + '<img src="' + urlCDNIconType + extensionArchivoFisico + '.png" style="padding:2px" alt="' + extensionArchivoFisico + '"/>';
									//}
									divArchivo = divArchivo + '<img src="' + urlCDNIconType + extensionArchivoFisico + '.png" style="padding:2px" alt="' + extensionArchivoFisico + '"/>';
									divArchivo = divArchivo + '</a></td><td><a href="archivo/descargar/'+elMensajeArchivo.id+'" class="archivosDescarga" id="archivosDescarga'+ elMensajeArchivo.id + '">' + elMensajeArchivo.archivoFisico + '</a>' + enlaceParaVerLaImagen + enlaceParaVerElArchivo + htmlFechaPublicacionArchivoUnico + '</td></tr><tr><td>'+ elMensajeArchivo.mensaje+ '</td></tr>';

								}
								
								divArchivo = divArchivo + '</table>';								
								
							}
							
							cuerpo = divArchivo;
							
							pie = '<div class="timeline-footer">En <b><a href="#" class="alcance" data-id="'+espamacoan+'">'+ alcance+ '</a></b>. <a class="archivosComprimidos btn btn-success btn-xs" href="archivo/descargar/'+ idArchivos + '/zip"><i class="fa fa-download"></i>&nbsp;<span class="hidden-xs hidden-sm hidden-md">Descargar Archivo </span>Comprimido </a> <!-- <a href="#" class="archivosHistorial btn btn-info btn-xs"><span class="hidden-xs hidden-md hidden-sm">Historial de Descarga </span><i class="fa fa-history"></i></a> --></div>';
							publicadorActual = publicador;
							fechaPublicacionFinal = momentoFecha.format("DD/MM/YYYY");
							htmlAccionMensaje = htmlAccionMensajeInicial + htmlAccionMensajeLeido + htmlAccionMensajeOcultar + htmlAccionMensajeFinal;
							htmlAccionMensaje = "";
							htmlMensaje = '<li id="idMensaje'+ id+ '" class="tieneAdjuntos"><i class="fa '+ claseIcono+ '"></i><div class="timeline-item" id=><span class="time" title="'+ fechaPublicacionCompletaFinal+ '"><i class="fa-regular fa fa-clock"></i> '+ fechaPublicacionFinal + htmlAccionMensaje + '</span>' + encabezado + cuerpo + pie + '</div></li>';
														
							items.push(htmlFecha + htmlMensaje);							
															
						}
					} else {
						fechaPublicacionFinal = momentoFecha.format("DD/MM/YYYY");
						htmlMensaje = '<li id="idMensaje'+ id+ '">';
						if (hayFoto.length!=0) {
							htmlMensaje = htmlMensaje + hayFoto;
						} else {
							htmlMensaje = htmlMensaje + '<i class="fa '+ claseIcono+ '"></i>';
							
						}
						if (incluirFechaDerecha==1) {
							htmlIncluirFechaDerechaFinal = '<span class="time" title="'+ fechaPublicacionCompletaFinal+ '"><i class="fa-regular fa fa-clock"></i> '+ fechaPublicacionFinal + htmlAccionMensaje + '</span>';
						} else if (htmlIncluirFechaDerecha.length!=0) {
							htmlIncluirFechaDerechaFinal = htmlIncluirFechaDerecha;
						}	else {
							htmlIncluirFechaDerechaFinal = ""; 
						}
												
						htmlMensaje = htmlMensaje + '<div class="timeline-item"> ' + htmlIncluirFechaDerechaFinal + encabezado + cuerpo + pie+ '</div></li>';
						items.push(htmlFecha + htmlMensaje);
					}
				}//fin function armaTimeLine

				len = arr.length;
				if (len == 0) {
					if (tipomensaje == "/inscripciones") {
						items.push('<li id="itemFinalPagina" style="padding-left:60px;"><i class="fa fa-chevron-down"></i><a href="1" id="masElementosDelTimeLine">Obtener los mensajes ahora</a></li>');
					} else {
						items.push('<li><i class="fa-regular fa fa-clock"></i></li>');
						items.push('<li style="margin-top:50px"><i class="fa ' + iconfaDefault + '"></i><div class="timeline-item"> <h3 class="timeline-header no-border">'  + timelineSinContenido + '</h3></div></li>');//No dispones de nuevos mensajes						
					}
				}
				
				if (len<maximaPaginacion) {
					items.push('<li><i class="fa-regular fa fa-clock"></i></li>');
				} else {
					paginaActual++;
					
					if (tipomensaje.indexOf("/curso")!=-1) {
						items.push('<li id="itemFinalPagina" style="padding-left:60px;"><i class="fa fa-chevron-down"></i><a href="'+tipomensaje+'?pagina='+paginaActual+'" id="masElementosDelTimeLineCurso">Obtener más mensajes del curso</a></li>');	
					} else {
						items.push('<li id="itemFinalPagina" style="padding-left:60px;"><i class="fa fa-chevron-down"></i><a href="'+paginaActual+'" id="masElementosDelTimeLine">Obtener más mensajes</a></li>');
					}
								
					//items.push('<li id="itemFinalPagina" style="padding-left:60px;"><i class="fa fa-chevron-down"></i><a href="'+paginaActual+'" id="masElementosDelTimeLine">Obtener más mensajes</a></li>');					
				}
				
				var $filtroFecha = $("#filtroFecha");

				if (len!=0) {
					if (pagina==1 || pagina==null) { $filtroFecha.append('<li><a href="#lnkTodos" class="">Todos los Mensajes</a></li><li role="separator" class="divider"></li>'); }
				}
				
				$.each(momentoFechasArray, function(i) {
					$filtroFecha.append('<li><a href="'+ momentoFechasArray[i] + '">'+ momentoFechasArray[i]+ '</a></li>');
				});

				$("#filtroFecha li").click(function(e) {
					e.preventDefault();
					var fechaSeleccionada = $(this).find("a").attr("href");
					
					$(".btnFiltroFechaTexto").html('<i class="fa fa-calendar"></i> Filtrado: ' +$(this).text()).removeClass("btn-default").addClass("btn-success");
					
					if ($(".btnQuitarFiltroFecha")) {
						$(".btnQuitarFiltroFecha").remove();
					}

					$(".btnFiltroFechaTexto").after('<button type="button" class="btn btnQuitarFiltroFecha btn-primary"><i class="fa fa-times"></i>  </button>');					

					if (fechaSeleccionada == "#lnkTodos") {
						if (data!=null) {							
							$(".btnFiltroFechaTexto").html('<i class="fa fa-calendar"></i> Filtrar').removeClass("btn-success").addClass("btn-default");
							$(".btnQuitarFiltroFecha").remove();							
							updateTimeLine(data);
						}						
					} else {
						makesArray = jQuery.grep(data,function(mensaje, i) {
							var momentoFechaGrep = moment(mensaje.fechaPublicacion);
							var momentoFechaGrepDesde = momentoFechaGrep.from(today);
							return momentoFechaGrepDesde == fechaSeleccionada;
							});
						updateTimeLine(makesArray);
					}
					
				});

				$('body').on('click', '.btnQuitarFiltroFecha', function(e) {
					if (data!=null) {
						$(".btnFiltroFechaTexto").html('<i class="fa fa-calendar"></i> Filtrar').removeClass("btn-success").addClass("btn-default");
						$(".btnQuitarFiltroFecha").remove();
						updateTimeLine(data);
					}
				});

				var itemsFiltroMensajeTipo = [];
				var $filtroMensajeTipo = $("#filtroTipo");
				//if (pagina==1) { $filtroMensajeTipo.append('<li><a href="#lnkTodos">Todos los Mensajes</a></li>'); }
				$.each(tipoMensajesArray, function(i) {
					var elValorMensajeTipo = tipoMensajesArray[i];
					var elValorMensajeTipoTexto = elValorMensajeTipo;
					if (tipoMensajesArray[i]=="B01") { elValorMensajeTipo = "Préstamos"; }
					if (tipoMensajesArray[i]=="B02") { elValorMensajeTipo = "Préstamos"; }					
					if (tipoMensajesArray[i]=="E01") { elValorMensajeTipo = "Exámenes"; }
					if (tipoMensajesArray[i]=="E02") { elValorMensajeTipo = "Exámenes"; }
					if (tipoMensajesArray[i]=="E03") { elValorMensajeTipo = "Efemérides"; }
					if (tipoMensajesArray[i]=="F01") { elValorMensajeTipo = "Feriados"; }
					if (tipoMensajesArray[i]=="F02") { elValorMensajeTipo = "Cumpleaños"; }
					if (tipoMensajesArray[i]=="V01") { elValorMensajeTipo = "Tus Eventos"; }
					if (tipoMensajesArray[i]=="R01") { elValorMensajeTipo = "Parcial"; }
					if (elValorMensajeTipo!=null) {					
						itemsFiltroMensajeTipo.push('<li><a href="'+ tipoMensajesArray[i] + '">' + elValorMensajeTipo.toUpperCase() + '</a></li>'); 
					}
				});
				
				if (len!=0) {
					itemsFiltroMensajeTipo.push('<li class="divider"></li>');
					itemsFiltroMensajeTipo.push('<li><a href="#lnkRecibidosm">Leidos</a></li>');
					itemsFiltroMensajeTipo.push('<li><a href="#lnkOcultosm">Borrados</a></li>');
					itemsFiltroMensajeTipo.push('<li><a href="#lnkOcultosm">Ocultos</a></li>');
				
					itemsFiltroMensajeTipo = jQuery.unique( itemsFiltroMensajeTipo );

				
					$filtroMensajeTipo.append(itemsFiltroMensajeTipo.join(''));
				}

				$("#filtroTipo li").click(function(e) {
					e.preventDefault();
					var filtroSeleccion = $(this).find("a").attr("href");
					
					$(".btnFiltroTipoTexto").html($(this).text() + ' <i class="fa fa-filter"></i> <span class="caret"></span>').removeClass("btn-default").addClass("btn-success");

					if ($(".btnQuitarFiltroTipo")) {
						$(".btnQuitarFiltroTipo").remove();
					}
					
					$(".btnFiltroTipoTexto").after('<button type="button" class="btn btnQuitarFiltroTipo btn-primary"><i class="fa fa-times"></i>  </button>');
					
					makesArray = jQuery.grep(data,function(mensaje, i) {
						var mensajeTipoGrep = mensaje.mensajeTipo;
						if (mensajeTipoGrep=="DOCENTE" && filtroSeleccion=="ADJUNTOS") {
							if (mensaje.tieneAdjunto==1) {
								return true;
							}							
						} 
						return mensajeTipoGrep == filtroSeleccion;
						});				
					
					updateTimeLine(makesArray);
					
				});

				$('body').on('click', '.btnQuitarFiltroTipo', function(e) {
					if (data!=null) {
						$(".btnFiltroTipoTexto").html('<i class="fa fa-filter"></i> <span class="caret"></span>').removeClass("btn-success").addClass("btn-default");
						$(".btnQuitarFiltroTipo").remove();
						updateTimeLine(data);
					}
				});

				updateTimeLine = function(collaction) {					
					var btnFiltroFecha = $('#btnFiltroFecha').detach();
					
					$("#listaMensajes").empty();
					items = [];

					var t = collaction.length;
					
					for (var i = 0; i < collaction.length; i++) {
						armaTimeLine(i, collaction[i]);
					}

					if (t==0) {
						items.push('<li><i class="fa-regular fa fa-clock"></i></li>');
						items.push('<li style="margin-top:60px"><i class="fa fa-ban bg-red"></i><div class="timeline-item"> <h3 class="timeline-header no-border">No se encuentran disponibles este tipo de mensajes. Gracias!</h3></div></li>');			
						items.push('<li><i class="fa-regular fa fa-clock"></i></li>');						
					} else {
						items.push('<li><i class="fa-regular fa fa-clock"></i></li>');	
					}

					$("#timelinePrincipal ul").remove();

					$('<ul/>', {
						'id' : 'listaMensajes',
						'class' : 'timeline',
						html : items.join('')
					}).appendTo('#timelinePrincipal');

					$(btnFiltroFecha).first().prependTo($('#timelinePrincipal li').first());

				};

				if (pagina) {
					var itemsPagina = items.join('');
					$("#itemFinalPagina").replaceWith(itemsPagina);
				} else {					
					$('<ul/>', {
						'id' : 'listaMensajes',
						'class' : 'timeline' + classTipoMensajeLista,
						html : items.join('')
					}).appendTo('#timelinePrincipal');
				}
				
				if (btnFiltroFechaActual!=null) {
					var btnFiltroFecha = btnFiltroFechaActual;
					$('#timelinePrincipal li:eq(0)').append(btnFiltroFecha);
					$('#btnFiltroFecha').show();					
				}				

				if (esTimeLineBase==0) {
					$("#volverTimeLinePrincipal").toggleClass('hidden');
				} else {
					$("#volverTimeLinePrincipal").addClass('hidden');
				}
				
				$("#volverTimeLinePrincipal").on('click', function(e) {
					e.preventDefault();					
					var elTimeLineBase = cache.get("timeLineBase")
					
					if (elTimeLineBase != null) {
						$("#volverTimeLinePrincipal").toggleClass('hidden');
						if ($(".btnQuitarFiltroTipo")) {
							$(".btnQuitarFiltroTipo").remove();
						}
						if ($(".btnQuitarFiltroFecha")) {
							$(".btnQuitarFiltroFecha").remove();
						}
						
						updateTimeLine(elTimeLineBase); 
					}
				});
				
			}).fail(function() {
				$("#btnFiltroFecha").hide();
				items.push('<li><i class="fa-regular fa fa-clock"></i></li>');
				items.push('<li style="margin-top:60px"><i class="fa fa-ban bg-red"></i><div class="timeline-item"> <h3 class="timeline-header no-border">No se han podido obtener tus mensajes en este momento. Intenta nuevamente <a href="javascript:void(0)" id="reloadTimeLineNow" class="refrescarTimeline">más tarde</a>. Gracias!</h3></div></li>');			
				items.push('<li><i class="fa-regular fa fa-clock"></i></li>');

				$("#timelinePrincipal ul").remove();

				$('<ul/>', {
					'id' : 'listaMensajes',
					'class' : 'timeline',
					html : items.join('')
				}).appendTo('#timelinePrincipal');

			}).always(function() {
				var loading = $("#timelinePrincipal div.loading-img");
				loading.animate({opacity : 0.25}, 600, function() {
					$(this).remove();
				});
				
			});
		},
		listarAcademicos : function() {
			var config = this.configuracion();
			var ec = overlay.clone();
			$("#contenedorMensajesAcademicos").prepend(ec);
			var itemsNacion = [];
			var itemsCarreras = [];
			var optionSelected = 'selected="selected"';
			
			$.getJSON(config.urlCompleta("mensajes/academico"), {},
					function(data) {

						var items = [];
						var itemsTotales = [];
						var itemsServicios = [];
						var mensajes = {};
						
						$.each(data, function(key, val) {
							
							
							var id = val.id;
							var cantidad = val.valor;
							var tipo = val.nombre;
							var elMensaje = '';
							
							if (tipo=='Totales') {
								if (id == 'Promedio') {
									
									if (cantidad=="0.00" && anioIngreso==anioActual) {
										cantidad = "Aún indeterminado"; 
									} else {
										cantidad = cantidad;
									}
									
									miPromedio = '<li> Mi promedio: <b>' + cantidad + '</b> <span class="small"></span></li>';
									miPromedio = '';
								}

								if (id == 'MensajesNuevos') {
									//elMensaje = '<a href="#" id="btnListarMensajesNuevos"> <i class="fa fa-envelope success"></i>Tenés '+ cantidad+ ' mensajes nuevos.</a>';
									//elTotalMensajesNuevos = cantidad;
									return true; // para no ponerlo en la lista de las notificaciones								
								} else if (id == 'AutorizacionesQueSolicitefrom') {
									elMensaje = '<a href="#" id="btnListarMisSolicitudesPendientesdeAutorizar"> <i class="fa-regular fa-circle danger"></i>Mis Solicitudes Pendientes ('+ cantidad+ ')</a>';//Tenés '+ cantidad+ ' solicitudes de autorizaciones pendientes.</a>';
								} else if (id == 'AutorizacionesQueMeSolicitaron') {
									elMensaje = '<a href="#" id="btnListarSolicitudesdeAutorizaciondeOtros"> <i class="fa fa-warning warning"></i>Solicitudes para Autorizar ('+ cantidad+ ')</a>';//Tenés '+ cantidad+ ' solicitudes  pendientes de autorizar.</a>';
								}

								if (id == 'Suma') {
									elMensaje = '';
									elTotal = cantidad;
								}

								if (id != 'Suma') {
									itemsTotales.push('<li>'+ elMensaje+ '</li>');
								}
								
							} else if (tipo=='Nacion') {
								itemsNacion.push('<li id="CUEFacultad">CUE Facultad: <b>' + cantidad + '</b> <a href="http://mapa.educacion.gob.ar/maps/mapa-navegable-de-las-universidades" target="_blank">Mapa</a></li>');
							} else if (tipo=='Carreras') {
								var selected = "";
								if (getLegajo()==cantidad) { selected=optionSelected; }
								itemsCarreras.push('<option value="'+cantidad+'" '+selected+'>'+id+'</option>');

							} else {
								var elMensaje = val.nombre;
								items.push("<li>" + elMensaje + "</li>");																
							}							
														
						});

						$('#listaMensajesAcademicos').remove();

						$('<ol/>', {
							'id' : 'listaMensajesAcademicos',
							'class' : '',
							html : items.join('')
						}).appendTo('#contenedorAcademica');
						
						$('<ul/>', {
							'id' : 'listaMensajesTotales',
							'class' : 'menu',
							html : itemsTotales.join('')
						}).appendTo('#contenedorNotificaciones');

						$('.notifications-menu span').html(elTotal);
						
						//$('.messages-menu span').html(elTotalMensajesNuevos);
						
						$('<li class="header">Tenés ' + elTotal+ ' notificaciones</li>').prependTo('li.notifications-menu ul.dropdown-menu');
						
					}).always(function() {
					
					if ($('#listaMensajesAcademicosPropios').length>0) { $('#listaMensajesAcademicosPropios').remove(); };
					
					var tipoUsuario = getTipoUsuario();
					var itemsAcademicosPropios = [];
					var anioAcademico = "Año Académico: <b>" + getAnioAcademico() + "</b>";
					var CUEFacultad = itemsNacion.join('');
					var carreras = itemsCarreras.join('');
					
					if (tipoUsuario=="A") {
						var promedio = "";					
						itemsAcademicosPropios.push('<li id="miPromedio">' + promedio  + '</li>');
						itemsAcademicosPropios.push('<li id="anioAcademico">' + anioAcademico  + '</li>');
						itemsAcademicosPropios.push(miPromedio);
						if (itemsCarreras.length>1) {
							itemsAcademicosPropios.push('<li id="cambioCarrera"><select id="cmbCarrerasAlumno">'+carreras+'</select><i id="btnCambiarCarrera" class="fa fa-arrow-right btn-primary btn-sm" title="Cambiar Especialidad"></i></li>');
						}
					} 
					
					if (tipoUsuario=="D") {
						itemsAcademicosPropios.push('<li><a href="#" id="sitioWebAcademica">Secretaría Académica <span class="fa fa-external-link" style="font-size:12px"></span></a></li>');
						itemsAcademicosPropios.push('<li><a href="#" id="concursosAcademicos">Concursos <span class="fa fa-external-link" style="font-size:12px"></span></a></li>');
						itemsAcademicosPropios.push('<li id="anioAcademico">' + anioAcademico  + ' <a href="#" id="cambiarAnioAcademicoDocente" class="small"> Ver otros</a></li> ');
					}
					itemsAcademicosPropios.push(CUEFacultad);						


					$('<ul/>', {
						'id' : 'listaMensajesAcademicosPropios',
						'style' : 'list-style-type:none',
						html : itemsAcademicosPropios.join('')
					}).appendTo('#contenedorAcademica');

					var esteOverlay = $("#contenedorMensajesAcademicos").find(ec);
					esteOverlay.animate({opacity : 0.25}, 1000, function() {
							$(this).remove();
						});
					});
		},
		listarTotales : function() {
			var config = this.configuracion();

			$.getJSON(config.urlCompleta("mensajes/totales"),{},function(data) {
				var items = [];
				var mensajes = {};
				var elTotal = '';
				var elTotalMensajesNuevos = '';
				$.each(data,function(key, val) {
					var cantidad = val.valor;
					var tipo = val.nombre;
					var elMensaje = '';
					if (tipo == 'Promedio') {
						miPromedio = '<li> Mi promedio: <b>' + cantidad + '</b> <span class="small"></span></li>';
					}

					if (tipo == 'MensajesNuevos') {
						//elMensaje = '<a href="#" id="btnListarMensajesNuevos"> <i class="fa fa-envelope success"></i>Tenés '+ cantidad+ ' mensajes nuevos.</a>';
						//elTotalMensajesNuevos = cantidad;
						return true; // para no ponerlo en la lista de las notificaciones
						
					} else if (tipo == 'AutorizacionesQueSolicitefrom') {
						elMensaje = '<a href="#" id="btnListarMisSolicitudesPendientesdeAutorizar"> <i class="fa-regular  fa-circle danger"></i>Mis Solicitudes Pendientes ('+ cantidad+ ')</a>';//Tenés '+ cantidad+ ' solicitudes de autorizaciones pendientes.</a>';
					} else if (tipo == 'AutorizacionesQueMeSolicitaron') {
						elMensaje = '<a href="#" id="btnListarSolicitudesdeAutorizaciondeOtros"> <i class="fa fa-warning warning"></i>Solicitudes para Autorizar ('+ cantidad+ ')</a>';//Tenés '+ cantidad+ ' solicitudes  pendientes de autorizar.</a>';
					}

					if (tipo == 'Suma') {
						elMensaje = '';
						elTotal = cantidad;
					}

					if (tipo != 'Suma') {
						items.push('<li>'+ elMensaje+ '</li>');
					}
				});

				$('<ul/>', {
					'id' : 'listaMensajesTotales',
					'class' : 'menu',
					html : items.join('')
				}).appendTo('#contenedorNotificaciones');

				$('.notifications-menu span').html(elTotal);
				
				//$('.messages-menu span').html(elTotalMensajesNuevos);
				
				$('<li class="header">Tenés ' + elTotal+ ' notificaciones</li>').prependTo('li.notifications-menu ul.dropdown-menu');

			}).fail(function() {
			}).always(function() {
			});
		},
		listarNuevos : function() {
			var config = this.configuracion();

			$.getJSON(config.urlCompleta("mensajes/nuevos"),{},function(data) {
				var items = [];
				var mensajes = {};
				var elTotal = '';
				
				$('li.messages-menu ul.dropdown-menu li').remove();
				
				$.each(data,function(key, val) {
					var id = val.id;
					var nombrePublica = val.id;
					var elMensaje = val.nota;
					var publicador = val.nombreUsuarioPublica;
					var mailPublicador = val.eMailOrigen;
					var fechaPublicacion = val.fechaPublicacion;
					var antiguedad = val.antiguedad;
					var mensajeTipo = val.mensajeTipo;
					var alcance = val.alcance;
					var archivoFisico = val.archivoFisico;
					var extensionArchivoFisico = "";
					var tieneAdjunto = val.tieneAdjunto;
					var momentoFecha = moment(fechaPublicacion);
					var pideAutorizacion = val.pideAutorizacion;

					var elHtml = '<li><a href="#"><div class="pull-left"><img src="../img/avatar.png" class="img-circle" alt="user image"/></div><h4>'+ publicador+ '<small><i class="fa-regular fa fa-clock"></i> '+ momentoFecha.format("DD/MM/YYYY")+ '</small></h4><p>'+ elMensaje+ '</p></a></li>';
					items.push('<li>' + elHtml+ '</li>');

				});

				elTotal = items.length;

				$('#listaMensajesNuevos').remove();
				
				$('<ul/>', {
					'id' : 'listaMensajesNuevos',
					'class' : 'menu',
					html : items.join('')
				}).appendTo('#contenedorMensajesNuevos');

				var html = $('.messages-menu span').html(elTotal);
				
				if (elTotal>0) {
					beep();
					html.animate({ top: 40 }, {
				        duration: 'slow',
				        easing: 'easeOutBack'
				       }).animate({ top: 6 }, {
				        duration: 'slow',
				        easing: 'easeOutBack'
				       });
				}
				
				$('<li class="header">Tenés ' + elTotal+ ' mensajes nuevos</li>').prependTo('li.messages-menu ul.dropdown-menu');
			})
			.fail(function() {
				$('#contenedorMensajesNuevos ul').html('<li>No se pueden obtener los mensajes</li>');
			});
		},
		contexto : function(id, tipoMensaje) {
			var config = this.configuracion();

			if (cache.get(id)) {
				return;
			};

			$.getJSON(config.urlCompleta("mensajes/contexto") + "/" + id + "/"+ tipoMensaje,{},function(data) {
				var items = [];

				$.each(data, function(key, val) {

					var id = val.id;
					var nombre = val.nombre;
					var valor = val.valor;

					var elHtml = '<a href="#" id=contexto"'
							+ tipoMensaje + id + '"><p>' + nombre
							+ valor + '</p></a>';
					items.push('<li>' + elHtml + '</li>');

				});

				$('<ul/>', {
					'id' : 'listaMensajesContexto',
					'class' : 'menu',
					html : items.join('')
				}).appendTo('#popover-content');

				cache.set(id, items);
			}).fail(function() {
			});
		},
		configuraciones : function() {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("mensajes/configuraciones"),
				type : 'GET',
				dataType : "html",
				async : false
			}).done(function(data) {
				
				abrirModalGeneral("Configuración Visibilidad Mensajes", data ,true,true,1);
				$('#toggle-demo').bootstrapToggle()
				$(':checkbox').bootstrapToggle();
				$(".mails").append(htmlMails("Seleccione el mail"));
				
			});
		},
		visibilidad : function(id, tipoAccion) {
			var config = this.configuracion();
			if (!id) {return;}
			var laUrl = config.urlCompleta("configuracion/mensajes/visibilidad/") + id;
			var tipo = "GET";
			
			switch (tipoAccion) {
				case 1 :
					tipo = "DELETE";
					break;
				case 0 :
					tipo = "POST";
					break;

				default :
					break;
			}
						
			$.ajax({
				url : laUrl,
				type : tipo,
			}).done(function(data) {
			}).fail(function(data) {
			}).always(function(data) {
				$(data).find('respuestaRetorno').each(function() {
					var tipo = $(this).find('codigo').text();
					var mensajeResultado = $(this).find('mensaje').text();
					notificar(tipo, mensajeResultado);
				});
			});
		},				
	},// Fin Objeto Mensaje

	Calendario : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		agregar : function() {
		},
		estado : function(id) {
		},
		listar : function() {
			if (estadoModuloCalendario==0) { return; }
			var config = this.configuracion();
			// http://www.mikesmithdev.com/demo-fullcalendar-with-event-filtering/
			$.getJSON(config.urlCompleta("calendario"), {}, function(data) {
						var events = [];
						$.each(data, function(key, val) {
							var id = val.id;
							var descripcion = val.descripcion;
							var mensajeTipo = val.mensajeTipo;
							var descripcionCorta = '';
							var momentoFecha = moment(val.fecha);
							var momentoFecha1 = moment(val.fecha).add(1,"day");
							var fechaISO = momentoFecha.format("YYYY-MM-DD");
							var fechaHoraISO = momentoFecha.format("YYYY-MM-DD HH:mm:ss");
							var fecha = new Date(fechaISO);
							var color = '#3a87ad';
							var editable = false;
							var rendering = '';
							var todoElDia = false;
							var fechaFinal = fechaISO;
							var incluirFechaInicio = 0;
							var opciones = {};

							if (mensajeTipo == 'F01') {
								color = '#00c0ef';
								descripcionCorta = "Feriado";
								editable = false;
								rendering = "";//"background";
								todoElDia = true;								
							}
							if (mensajeTipo == 'F02') {
								color = '#ff0000';
								descripcionCorta = "Cumple";
								descripcion = "¡Feliz Cumpleaños!";
								editable = false;
								rendering = "";
								todoElDia = true;								
							}						
							if (mensajeTipo == 'R01') {
								color = '#f39c12';
								descripcionCorta = "Parcial";
								editable = false;
								rendering = "";
							}
							if (mensajeTipo == 'E01') {
								color = '#FF851B';
								descripcionCorta = "Examen";
								editable = false;
								rendering = "";
							}
							if (mensajeTipo == 'V01') {
								color = '#3d9970';
								descripcionCorta = "Propio";
								editable = false;
								rendering = "";
							}
							if (mensajeTipo == 'C01') {
								color = '#3d9970';
								descripcionCorta = "Dicta";
								descripcion = descripcion + " a las " + momentoFecha.format("HH:mm") + "hs.";
								editable = false;
								rendering = "";
								fechaFinal = fechaHoraISO;
								incluirFechaInicio = 1;
							}							
							
							if (incluirFechaInicio==0) {
								opciones = {
										title : descripcionCorta,
										description : descripcion,
										start : fechaHoraISO,
										editable : editable,
										rendering : rendering,
										backgroundColor : color,
										borderColor : color,
										tip : descripcion,
										allDay : todoElDia};
							} else {
								opciones = {
										title : descripcionCorta,
										description : descripcion,
										start : fechaFinal,
										editable : editable,
										rendering : rendering,
										backgroundColor : color,
										borderColor : color,
										tip : descripcion,
										allDay : todoElDia};
								
							}						

							events.push(opciones);
						});

						$('#calendar').fullCalendar('addEventSource', events);
					}).fail(function() {
			});
			/**/
		}// fin listar calendario
	},// fin Objeto Calendario

	Biblioteca : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		recomendados : function() {
			var config = this.configuracion();
			var tam = $("#listaTopLibros li").length;
			if (tam!=0) { return; } 			
			var ec = overlay.clone();
			$("#tabTop5").prepend(ec);

			$.getJSON(config.urlCompleta("biblioteca/libros/recomendados/5"), {}, function(data) {
				var itemsMasRetirados = [];
				var itemsRecomendadosDocentes = [];
				var itemsRecomendadosAlumnos = [];
				
				$.each(data,function(key, val) {
					var id = val.especialid;
					var titulo = val.titulo.trim();
					var autor = val.autor;					
					var cantidad = val.estado;
					var tipo = val.esp;
				
					var cadenaBusqueda = "http://www.frc.utn.edu.ar/bibliotecacentral/busqueda.asp?tx="+titulo+"&tm=99&bp=Titulo&bb=EQU&rp=10&p=1&av=1";
					
					if (tipo="MR") {
						itemsMasRetirados.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-success"> ' + cantidad + ' prestamos</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '" data-toggle="tooltip" title="Me gusta"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '" data-toggle="tooltip" title="No fue de mi interes"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');
					}
					
					if (tipo="RD") {
						itemsRecomendadosDocentes.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-info"> ' + cantidad + '</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');
					}

					if (tipo="RA") {
						itemsRecomendadosAlumnos.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-info"> ' + cantidad + '</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');
					}
																		
				});

				$("#listaTopLibros").remove();
				$("#listaLibrosRecomendadosDocentes ul").remove();
				$("#listaLibrosRecomendadosAlumnos ul").remove();
				
				$('<ul/>', {
					'id' : 'listaTopLibros',
					'class' : 'todo-list ui-sortable',
					html : itemsMasRetirados.join('')
				}).appendTo('#tabTop5');

				$('<ul/>', {
					'id' : 'listaLibrosRecomendadosDocentes',
					'class' : 'todo-list ui-sortable',
					html : itemsRecomendadosDocentes.join('')
				}).appendTo('#collapseOne div.box-body');

				$('<ul/>', {
					'id' : 'listaLibrosRecomendadosAlumnos',
					'class' : 'todo-list ui-sortable',
					html : itemsRecomendadosAlumnos.join('')
				}).appendTo('#collapseTwo div.box-body');

								
				}).always(function() {
					
					var esteOverlay = $("#tabTop5").find(ec);
					esteOverlay.animate({opacity : 0.25}, 1000, function() {
							$(this).remove();
						});
					});
		},
		top5 : function() {
			var config = this.configuracion();
			var tam = $("#listaTopLibros li").length;			
			if (tam!=0) { return; } 			
			$.getJSON(config.urlCompleta("biblioteca/libros/top"), {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var id = val.especialid;
					var titulo = val.titulo;
					var autor = val.autor;					
					var cantidad = val.estado;
				
					var cadenaBusqueda = "http://www.frc.utn.edu.ar/bibliotecacentral/busqueda.asp?tx="+titulo+"&tm=99&bp=Titulo&bb=EQU&rp=10&p=1&av=1";
					items.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-success"> ' + cantidad + ' prestamos</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '" data-toggle="tooltip" title="Me gusta"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '" data-toggle="tooltip" title="No fue de mi interes"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');				
								
				});

				$('<ul/>', {
					'id' : 'listaTopLibros',
					'class' : 'todo-list ui-sortable',
					html : items.join('')
				}).appendTo('#tabTop5');
				
				});
		},
		recomendadosDocentes : function() {
			var config = this.configuracion();
			var tam = $("#listaLibrosRecomendadosDocentes li").length;			
			if (tam!=0) { return; } 			
			$.getJSON(config.urlCompleta("biblioteca/libros/recomendados/docentes"), {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var id = val.especialid;
					var titulo = val.titulo;
					var autor = val.autor;					
					var cantidad = val.estado;
				
					var cadenaBusqueda = "http://www.frc.utn.edu.ar/bibliotecacentral/busqueda.asp?tx="+titulo+"&tm=99&bp=Titulo&bb=EQU&rp=10&p=1&av=1";
					items.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-info"> ' + cantidad + '</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');					
								
				});

				$('<ul/>', {
					'id' : 'listaLibrosRecomendadosDocentes',
					'class' : 'todo-list ui-sortable',
					html : items.join('')
				}).appendTo('#collapseOne div.box-body');
								
				});
		},
		recomendadosAlumnos : function() {
			var config = this.configuracion();
			var tam = $("#listaLibrosRecomendadosAlumnos li").length;			
			if (tam!=0) { return; } 			

			$.getJSON(config.urlCompleta("biblioteca/libros/recomendados/alumnos"), {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var id = val.especialid;
					var titulo = val.titulo;
					var autor = val.autor;					
					var cantidad = val.estado;
				
					var cadenaBusqueda = "http://www.frc.utn.edu.ar/bibliotecacentral/busqueda.asp?tx="+titulo+"&tm=99&bp=Titulo&bb=EQU&rp=10&p=1&av=1";
					items.push('<li><span class="text"><a href="' + cadenaBusqueda + '" data-toggle="tooltip" title="Buscar en la Biblioteca">' + titulo + ' - ' + autor + '</a></span><small class="label label-info"> ' + cantidad + '</small><div class="tools"><i class="fa fa-thumbs-up" id="itemLibroSi'+ id + '"></i><i class="fa fa-thumbs-down" id="itemLibroNo'+ id + '"></i><i class="fa fa-book" id="itemLibroReserva'+ id + '" data-toggle="tooltip" title="Reservar Libro"></i></div></li>');					
								
				});
			
				$('<ul/>', {
					'id' : 'listaLibrosRecomendadosAlumnos',
					'class' : 'todo-list ui-sortable',
					html : items.join('')
				}).appendTo('#collapseTwo div.box-body');

				
				});
		}// fin listar biblioteca
	},// fin Objeto Biblioteca

	Archivo : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		agregar : function() {
		},
		estado : function(id) {
		},
		estadisticas : function(o,id) {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("stats/descargas/"+id),
				type : 'GET',
				dataType : "text",
				async : false
			}).done(function(data) {
				
				var valores = data.split(",");

				var output = 0;
				for (var i = 0, len = valores.length; i<len; i++){
					valor = +valores[i];
				    output += +parseInt(+valor);
				}				
				
				o.after('<div class="description-block margin-bottom bg-primary"><div class="sparkbar pad" data-color="#fff">'+data+'</div><h5 class="description-header"></h5><span class="description-text">'+output+' Descargas</span></div>');		
				
				//-----------------
				//- SPARKLINE BAR -
				//-----------------
				$('.sparkbar').each(function () {
				  var $this = $(this);
				  $this.sparkline('html', {
				    type: 'bar',
				    height: $this.data('height') ? $this.data('height') : '30',
				    barColor: $this.data('color')
				  });
				});

			});
			
		},
		historial : function(id) {
			var config = this.configuracion();
			var url = config.urlCompleta("archivo/historial/"+id);
			
			$.getJSON(url,{},function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var cantidad = val.valor;
					var tipo = val.nombre;
//					var elMensaje = '';
					items.push('<li>'+ elMensaje+ '</li>');
				});


			}).fail(function() {
			}).always(function() {
			});
			
		},	
		descargar : function(id) {
			var config = this.configuracion();
			var url = config.urlCompleta("archivo/descargar/"+id);
			var _id = id; 
			var idTabla = "#tablaArchivoDescarga" + id + ", #tablaArchivoDescarga" + id + " a";
			$.ajax({
				url : url,
				type : 'POST',
				async : false
			}).done(function(data) {
				$(idTabla).removeClass("text-bold text-danger bg-danger");
			}).fail(function(data) {
				$(idTabla).addClass("text-bold text-danger bg-danger");
			});
		}// fin descargar
	},// fin Objeto Archivo
	Usuario : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		seguir : function() {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("perfil/seguir/a"),
				type : 'GET',
				dataType : "html",
				async : false
			}).done(function(data) {
				abrirModalGeneral("Seguir Materia", data ,true,true,1);
			});
		},		
		perfil : function() {
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("perfil/"+getTipoUsuarioNombre().toLowerCase()),
				type : 'GET',
				dataType : "html",
				async : false
			}).done(function(data) {
				//abrirModalGeneral("Seguir Materia", data ,true,true,1);
			});
		},
		preferencias : function(reload) {
			var config = this.configuracion();
			cache.set("preferencias", cadenaPreferenciasUsuario);
			if (reload) { 
				$.getJSON(config.urlCompleta("perfil/preferencias"), {}, function(data) {
						cache.set("preferencias", data);
					});
			}
		},
		estaFidelizado : function() {
			
			var estadoFidelizacion = estadoFidelizacionMail();

			if (typeof estadoFidelizacion === "undefined") { return; }
			
			var estado = estadoFidelizacion[0]; 
			var mail = estadoFidelizacion[1];
			var htmlTituloSinFidelizacionMail = 'Fideliza tu mail';
			var htmlIndicadorSinFidelizacionMail = '<span class="fa fa-times text-warning"></span>';
			var htmlTituloFidelizacionEnProceso = 'En proceso de fidelización';
			var htmlIndicadorFidelizacionEnProceso = '<span class="fa fa-exclamation text-warning"></span>';
			var htmlTituloMailFidelizado = 'Mail Fidelizado!';
			var htmlIndicadorMailFidelizado = '<span class="fa fa-check text-blue"></span>';
			var htmlIndicadorMailFidelizadoEstado = '';
			var htmlTituloMailFidelizadoFinal = '';
			
			if (mail==null || mail.length==0) {
				$("#mailAFidelizar").html("");
				$("#mailAFidelizar").append("Mail no definido"); 
				$("#htmlStatusFidelizacionMail").removeClass()
				$("#htmlStatusFidelizacionMail").addClass("small-box bg-orange");
				$("#moduloFidelizacionMail").show();
				$("#btnCambiarMail").show();
				$("#btnFidelizarMail").remove();					
				$("#btnReenviarMail").remove();
				
			} else {
				
				//los ingresantes 2020 viene con mail fidelizado.
				if (anioIngreso==2020) { estado = 1; }
			
				if (estado!=null) {
									
					if (estado==0) {
						htmlIndicadorMailFidelizadoEstado = htmlIndicadorSinFidelizacionMail;
						htmlTituloMailFidelizadoFinal = htmlTituloSinFidelizacionMail;
						
						var valor = mail;
						if (valor) {  $("#mailAFidelizar").append(valor); }
	
						$("#htmlStatusFidelizacionMail").removeClass()
						$("#htmlStatusFidelizacionMail").addClass("small-box bg-orange");
						$("#moduloFidelizacionMail").show();
						$("#btnCambiarMail").show();
						$("#btnFidelizarMail").removeClass();
						$("#btnFidelizarMail").addClass("btn btn-sm btn-warning");
						$("#btnFidelizarMail").html("Aceptar");					
						$("#btnReenviarMail").remove();
											
					}
					if (estado==1) {
						htmlIndicadorMailFidelizadoEstado = htmlIndicadorMailFidelizado;
						htmlTituloMailFidelizadoFinal = htmlTituloMailFidelizado;
	
						$("#htmlStatusFidelizacionMail").removeClass();
						$("#htmlStatusFidelizacionMail").addClass("small-box bg-green");
						$("#btnCambiarMail").remove();					
						$("#btnFidelizarMail").removeClass("btn-warning");
						$("#btnFidelizarMail").addClass("btn-info");
						$("#btnFidelizarMail").html("Revisar tu mail");
						$("#btnFidelizarMail").attr("disabled","disabled");
						$("#btnReenviarMail").remove();
	
					}
					if (estado==3) {
						htmlIndicadorMailFidelizadoEstado = htmlIndicadorFidelizacionEnProceso;
						htmlTituloMailFidelizadoFinal = htmlTituloFidelizacionEnProceso;					
						
						var valor = mail
						if (valor) { $("#mailAFidelizar").append(valor); }
	
						$("#moduloFidelizacionMail").show();
						$("#htmlStatusFidelizacionMail").removeClass();
						$("#htmlStatusFidelizacionMail").addClass("small-box bg-purple");
						$("#btnCambiarMail").remove();
						$("#btnFidelizarMail").removeClass();
						$("#btnFidelizarMail").addClass("btn btn-sm btn-info");
						$("#btnFidelizarMail").html("Revisar tu mail");
						$("#btnFidelizarMail").attr("disabled","disabled");
						//$("#htmlStatusFidelizacionMail div.inner").append('<a href="#" class="btn btn-sm btn-primary" id="btnReenviarMail">Reenviar</a>');
	
					}
					htmlIndicadorFidelizacionMail = mail + " " + htmlIndicadorMailFidelizadoEstado;
					
					$("#indicadorFidelizacionMail").html(htmlIndicadorFidelizacionMail);
					$("#indicadorFidelizacionMail").attr("title",htmlTituloMailFidelizadoFinal);				
				}
			}
		},
		reenviarMailFideliza : function(mail) {
			var config = this.configuracion();
			
			var url = config.urlCompleta("perfil/fidelizar/reenviar");
			
			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				data : {
					mail : mail,
				},			
				beforeSend: function( xhr ) {
	                xhr.setRequestHeader("A4-Token", A4Token);
	                xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                xhr.setRequestHeader("A4-Data", A4Data);
	             },	
			}).done(function(data) {
				
				var estado = data.estado;
				var codigoPreinscripcion = data.codigo;
				var mensaje = data.descripcion; 
				

				if (estado==0) { notificar("warning", mensaje);} 				
				
				if (estado==1) {
					notificar("success", "Se han enviado un correo. <br/>Agregar <strong>" + mailNoReplyA4 + "</strong> a tus direcciones válidas");
					$("#moduloFidelizacionMail div.small-box").removeClass("bg-orange");
					$("#moduloFidelizacionMail div.small-box").addClass("bg-purple");
					$("#btnFidelizarMail").removeClass("btn-warning");
					$("#btnFidelizarMail").addClass("btn-info");
					$("#btnFidelizarMail").html("Revisar tu mail");
					$("#btnFidelizarMail").attr("disabled","disabled");
				
					var dataType = "text";
					
					$.ajax({
						url : config.urlCompleta("perfil/mails"),
						type : 'GET',
						dataType : dataType,
						async : false
					}).done(function(data) {
						if (mails) {
							mails = data;	
						}
						
					});
				} 
				
			}).fail(function(data) {
				notificar("danger", "Ha ocurrido un inconveniente.");
			});				
			
		},
		fidelizarMail : function(mail) {
			var config = this.configuracion();
			
			var url = config.urlCompleta("perfil/fidelizar");
			
			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				data : {
					mail : mail,
				},			
				beforeSend: function( xhr ) {
	                xhr.setRequestHeader("A4-Token", A4Token);
	                xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                xhr.setRequestHeader("A4-Data", A4Data);
	             },	
			}).done(function(data) {
				
				var estado = data.estado;
				var codigoPreinscripcion = data.codigo;
				var mensaje = data.descripcion; 
				

				if (estado==0) { notificar("warning", mensaje);} 				
				
				if (estado==1) {
					notificar("success", "Se han enviado un correo. <br/>Agregar <strong>" + mailNoReplyA4 + "</strong> a tus direcciones válidas");
					$("#moduloFidelizacionMail div.small-box").removeClass("bg-orange");
					$("#moduloFidelizacionMail div.small-box").addClass("bg-purple");
					$("#btnFidelizarMail").removeClass("btn-warning");
					$("#btnFidelizarMail").addClass("btn-info");
					$("#btnFidelizarMail").html("Revisar tu mail");
					$("#btnFidelizarMail").attr("disabled","disabled");
				
					var dataType = "text";
					
					$.ajax({
						url : config.urlCompleta("perfil/mails"),
						type : 'GET',
						dataType : dataType,
						async : false
					}).done(function(data) {
						if (mails) {
							mails = data;	
						}
						
					});
				} 
				
			}).fail(function(data) {
				notificar("danger", "Ha ocurrido un inconveniente.");
			});				
		},		
		preferencia : function(id, retorno) {
			var config = this.configuracion();
			var enCache = cache.get("preferencias");
			
			if (!enCache) {
				return;
			} else {
				if (id) {
					var enCacheJSON = $.parseJSON(enCache);
					$.each(enCacheJSON, function(key, val) {
						var idPreferencia = val.idPreferenciaUsuarios;
						var valor = val.valor;
						if (idPreferencia == id) {
							retorno(valor);
							return;
						}
					});
				}				
			}
		},
		actualizarPreferencia : function(id,valor) {					
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("perfil/preferencia/"+ id +"/"+valor),
				type : 'PUT',
				beforeSend: function( xhr ) {
	                xhr.setRequestHeader("A4-Token", A4Token);
	                xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                xhr.setRequestHeader("A4-Data", A4Data);
	             },					
				async : false
			}).done(function(data) {
				var tipo = mostrarNotificacion(data);
				if (tipo=="success") {
					
				} else {

				}
								
			});
		},
		quitar : function(id) {					
			var config = this.configuracion();
			$.ajax({
				url : config.urlCompleta("perfil/preferencia/"+ id),
				type : 'DELETE',
				beforeSend: function( xhr ) {
	                xhr.setRequestHeader("A4-Token", A4Token);
	                xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                xhr.setRequestHeader("A4-Data", A4Data);
	             },					
				async : false
			}).done(function(data) {
				var tipo = mostrarNotificacion(data);
				if (tipo=="success") {				

				} else {

				}
								
			});
		},
	},// fin Objeto Usuario
	Dictado : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		actual : function(anio,como) {
			var ec = overlay.clone();
			$("#contenedorCursos").prepend(ec);

			var jTab ="#tabCargos" + como; 
			var lista ="listaCargos" + como;
			
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/comisiones/docente?como="+como), {}, function(data) {
				
				var items = [];
				var cursoActual = "Curso1";
				var asc = true;
				dataSort = data.sort(function(a, b) {
			        if (asc) {
			            return (a['curso'] > b['curso']) ? 1 : ((a['curso'] < b['curso']) ? -1 : 0);
			        } else {
			            return (b['curso'] > a['curso']) ? 1 : ((b['curso'] < a['curso']) ? -1 : 0);
			        }
			    });
				
				if (dataSort.length>10) {
					$("#txtCursoSearch").show();
					$('#contenedorTabsCursos').slimScroll({height:'250px'});
					$("#"+lista).attr("style","margin-top:50px");
				} else {
					$("#txtCursoSearch").hide();
				}
							
				var colors = ['bg-red','bg-yellow','bg-aqua','bg-blue','bg-light-blue','bg-green','bg-teal','bg-olive','bg-lime','bg-orange','bg-fuchsia','bg-purple','bg-maroon','bg-red-active','bg-yellow-active','bg-aqua-active','bg-blue-active','bg-light-blue-active','bg-green-active','bg-teal-active','bg-olive-active','bg-lime-active','bg-orange-active','bg-fuchsia-active','bg-purple-active','bg-maroon-active'];    
				var colorRand = 'bg-red';

				$.each(dataSort,function(key, val) {
					var nombre = val.nombreMateria;
					var elCurso = val.curso;					
					var cantidad = val.estado;
					var adicional = val.adicional;

					var json = JSON.parse(adicional);
					var cantidadAlumnos = json.cantidadAlumnos;
					var ultimaFecha = json.ultimaFecha;
					if (ultimaFecha.length==0) { ultimaFecha = "S/D"; } 
					
					if (cursoActual!=elCurso) {
						curso = elCurso;
						colorRand = colors[Math.floor(Math.random() * colors.length)];
					} else {
						curso = elCurso;//"--";
						
					}		
					var laespecialidad = val.especialidad;
					var elplan = val.plan;
					var lamateria = val.materia;
					var lafacultad = val.facultad;
					var elanioacademico = val.anio;
					var lacomision = val.comision;
					var elnombremateria = val.nombreMateria + '(' + elCurso + ')';
					var sMateriaCodigo =   laespecialidad + "|" + elplan + "|" + lamateria + "|" + lafacultad + "|" + elanioacademico + "|" + lacomision + "|" + elCurso.trim() ; // + "|" + elnombremateria;
					var sMateriaCodigoArchivo =   laespecialidad + "~" + elplan + "~" + lamateria + "~" + lafacultad + "~" + elanioacademico + "~" + lacomision + "~" + elCurso.trim() ; // + "|" + elnombremateria;
		
					//items.push('<li class="item"><div class="product-img ' + colorRand + '" style="width: 48px;height: 48px;border-radius: 50%;font-size: 20px;color: #fff;line-height: 48px;text-align: center;background: #000">'+curso+'</div><div class="product-info"><a href="tramites/1001" data-nombremateria="' + elnombremateria + '" data-codigomateria="' + sMateriaCodigo + '" class="product-title" style="font-size:16px;">' + nombre + '<span class="label label-warning pull-right" title="Inscriptos:' + cantidadAlumnos + '">' + cantidadAlumnos + '</span></a><div class="tools" style="font-size=16px"><a href="academico/comisiones/docente/archivos/materia" class="materiacomision" data-title="' + elnombremateria+ '" data-codigomateria="' + sMateriaCodigoArchivo + '"><i class="fa fa-file"   data-toggle="tooltip" title="Examenes Materias" style="padding-right:10px"></i></a> <i class="fa fa-print" id="regularidad" data-toggle="tooltip" title="Regularidad" style="padding-right:10px"></i><i class="fa fa-leanpub" id="libroTema" data-toggle="tooltip" title="Libro Tema" style="padding-right:0px"></i><span style="padding-left:4px;padding-right:10px;font-size:14px" title="fecha último tema cargado">' + ultimaFecha + '</span><i class="fa fa-th" id="itemLibroReserva" data-toggle="tooltip" title="Planilla Notas Online" style="padding-right:10px"></i><i class="fa-regular fa-clock-o" id="itemHorario" data-toggle="tooltip" title="Horario" style="padding-right:10px"></i></div></div></li><!-- /.item -->');
					items.push('<li class="item"><div class="product-img ' + colorRand + '" style="width: 48px;height: 48px;border-radius: 50%;font-size: 20px;color: #fff;line-height: 48px;text-align: center;background: #000">'+curso+'</div><div class="product-info"><a href="#" data-nombremateria="' + elnombremateria + '" data-codigomateria="' + sMateriaCodigo + '" class="product-title" style="font-size:16px;">' + nombre + '<span class="label label-warning pull-right" title="Inscriptos:' + cantidadAlumnos + '">' + cantidadAlumnos + '</span></a><div class="tools" style="font-size=16px"><a href="tramites/1001" class="materiacomision" data-nombremateria="' + elnombremateria + '" data-title="' + elnombremateria+ '" data-codigomateria="' + sMateriaCodigo + '"><i class="fa fa-file"   data-toggle="tooltip" title="Evidencia Examenes" style="padding-right:10px"></i></a> <i class="fa fa-print" id="regularidad" data-toggle="tooltip" title="Regularidad" style="padding-right:10px"></i><i class="fa fa-leanpub" id="libroTema" data-toggle="tooltip" title="Libro Tema" style="padding-right:0px"></i><span style="padding-left:4px;padding-right:10px;font-size:14px" title="fecha último tema cargado">' + ultimaFecha + '</span><i class="fa fa-th" id="itemLibroReserva" data-toggle="tooltip" title="Planilla Notas Online" style="padding-right:10px"></i><i class="fa-regular fa fa-clock" id="itemHorario" data-toggle="tooltip" title="Horario" style="padding-right:10px"></i></div></div></li><!-- /.item -->');
					
					cursoActual = elCurso; 
					
				});				
				
				var cantidad = 0;
				cantidad = $("#"+ lista +" li").size();
				if (cantidad > 0) {
					$("#"+ lista).remove();
				}

				if (items.length == 0) {
					var mensajesSinMaterias = 'No tiene cargada las materias que dicta. Dirijase al Departamento al que pertenece cada materia y solicitelo. Gracias!';
					items.push('<li class="item"><span class="text">' + mensajesSinMaterias + '</li>');
				}							

				$('<ul/>', {
					'id' : lista,
					'class' : 'products-list product-list-in-box',
					html : items.join('')
				}).appendTo(jTab);
				
				
				if(lista=="listaCargostieneComisiones"){
					/*$("#listaCargostieneComisiones li a.product-title").on('click', function(event) {
							event.preventDefault();
							var enlace = ($(this).attr("href"));//por ahora tien javascript(void)
							var codigomateria = $(this).data("codigomateria")
							console.log('codigo materia ' + codigomateria )
							abrirModalV4Nuevo(enlace,codigomateria);
					
					});*/
					
					$("#listaCargostieneComisiones li .tools a").on('click', function(event) {
							event.preventDefault();
							event.stopPropagation();
							/*
							var enlace = ($(this).attr("href"));//por ahora tien javascript(void)
							var codigomateria = $(this).data("codigomateria")
							console.log('codigo materia ' + codigomateria )
							var idMarcador = codigomateria
							var enlace = ($(this).attr("href")).toLowerCase() + '?materiacomision=' + codigomateria;// randomNumber;
							idMarcador ="2004";
							armarTabla(idMarcador, enlace, $(this));*/
							var nombreMateria = $("#cmbItems option:selected").text();
							$(this).attr('data-title', nombreMateria);
							var enlace = ($(this).attr("href"));//por ahora tien javascript(void)
							var codigomateria = $(this).data("codigomateria")
							console.log('codigo materia ' + codigomateria )
							abrirModalV4Nuevo(enlace,codigomateria);

					
					});
						
				
				}
				
				$(jTab).removeClass("active");
				$(jTab).addClass("active");
								
				var esteOverlay = $("#contenedorCursos").find(ec);
				esteOverlay.animate({opacity : 0.25}, 1000, function() {
						$(this).remove();
					});
					
				$("body").on("click", "#autogestiondocenteexamenesmaterias", function (e) {	
							/*event.preventDefault();
							
							var enlace = ($(this).attr("href"));//por ahora tien javascript(void)
							var codigomateria = $("#hiddenItems").val()//$(this).data("codigomateria")
							codigomateria = codigomateria.replaceAll("|","~");
							console.log('codigo materia ' + codigomateria )
							abrirModalV4Nuevo(enlace,codigomateria);*/
							event.preventDefault();
							event.stopPropagation();
							
							$("#autogestiondocenteexamenesmaterias").attr("data-title",$("#cmbItems option:selected").text())
							var enlace = ($(this).attr("href"));//por ahora tien javascript(void)
							var codigomateria = $("#hiddenItems").val();//$(this).data("codigomateria")
							codigomateria = codigomateria.replaceAll("|","~");
							console.log('codigo materia ' + codigomateria )
							var idMarcador = codigomateria
							var enlace = ($(this).attr("href")).toLowerCase() + '?materiacomision=' + codigomateria;// randomNumber;
							idMarcador ="2004";
							//enlace = enlace + "?materiacomision=" + codigomateria 
							armarTabla(idMarcador, enlace, $(this));
					
				});	
				
			});
		},		
	},// fin Objeto Cursado
	Cursado : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		misc : function() {
			return Autogestion.Misc;
		},
		actualGrilla : function () {
			var config = this.configuracion();
			var elMarcador = 200;
			var tablaMarcador = "tabla" + elMarcador;
			var jTablaMarcador = "#tabla" + elMarcador;
			var configuracionVentana = getConfiguracionVentana(elMarcador);
			var configuracionEncabezadoMapeo = configuracionVentana.encabezadoMapeo;
			var configuracionEncabezadoTitulo = configuracionVentana.encabezadoTitulo;
			var configuracionAtributosGrilla = configuracionVentana.atributosGrilla;
			
			var anio = cache.get("cursadoActual");
			
			if (typeof anio === "undefined") { anio = "2015"; }
			
			url = config.urlCompleta("cursado/actual/")+anio;
			
			var arrayEncabezadoMapeo = (new Function("return [" + configuracionEncabezadoMapeo + "];"))();
			var arrayEncabezadoTitulo = (new Function("return [" + configuracionEncabezadoTitulo + "];"))();

			if (typeof configuracionAtributosGrilla === "undefined") {
				configuracionAtributosGrilla = '{"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":false,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"sAjaxSource":url,"fnServerData":fnServerObjectToArray(arrayEncabezadoMapeo),"aoColumns": arrayEncabezadoTitulo,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}}}';;
			}
			
			var initGrilla = eval('(function(){return' + configuracionAtributosGrilla + ';})()');
			
			textoCursado = $("#contenedorCursando .box-header h3.box-title").text();		
			
			abrirModalGeneral(textoCursado, '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '"></table>',true,true, 1);
			
			$(jTablaMarcador).dataTable(initGrilla);		   					
			
		},		
		actual: function(anio) {
			var config = this.configuracion();
			var ec = overlay.clone();
			$("#contenedorCursando").prepend(ec);
			cache.set("cursadoActual", anio);
			$.getJSON(config.urlCompleta("cursado/actual/")+anio, {}, function(data) {
				var items = [];
				var claseColorLibre = "text-red";
				var claseColorRegularAsistencia = "text-yellow";
				var claseColorRegularAcademica = "text-yellow"; 
				var claseColorRegular = "text-green";
				
				$.each(data,function(key, val) {
					var materia = val.materia;
					var curso = val.curso;
					var id = val.enlace;
					var estadoAcademico = val.estadoAcademica;
					if (estadoAcademico!=null) {
						estadoAcademico = estadoAcademico.trim();
					} else {
						estadoAcademico = "";
					}
					
					var estadoBedelia = val.estadoBedelia;
					if (estadoBedelia!=null) {
						estadoBedelia = estadoBedelia.trim();
					} else {
						estadoBedelia = "";
					}

					var claseColorEstado = "";
										
					if (estadoAcademico=="Ins." && estadoBedelia=="Ins.") {
						claseColorEstado = "text-yellow";
					}
					if (estadoAcademico=="Ins." && estadoBedelia=="Reg.") {
						claseColorEstado = "text-yellow";
					}			
					if (estadoAcademico=="Reg." && estadoBedelia=="Reg.") {
						claseColorEstado = "text-green";
					}
					if (estadoAcademico=="Prom." && estadoBedelia=="Reg.") {
						claseColorEstado = "text-green";
					}
					if (estadoAcademico=="Lib." && estadoBedelia=="Lib.") {
						claseColorEstado = "text-red";
					}
					if (estadoAcademico=="Reg." && estadoBedelia=="Lib.") {
						claseColorEstado = "text-red";
					}
					if (estadoAcademico=="Prom." && estadoBedelia=="Lib.") {
						claseColorEstado = "text-red";
					}
										
					var textoEstadoRegularidad = "Acad: " + estadoAcademico + " - Bed: " + estadoBedelia;
										
					items.push('<li id="idCurso'+id+'"><i class="fa-regular fa-circle '+claseColorEstado+'" data-toggle="tooltip" title="'+textoEstadoRegularidad+'"></i><span class="text"> <a href="#" data-toggle="tooltip">(' + curso.trim() + ') ' + materia + '</a></span><div class="tools"><i class="fa fa-list-ol" data-toggle="tooltip" title="Mis Parciales"></i><i class="fa fa-file" data-toggle="tooltip" title="Documentos Publicados"></i><i class="fa fa-group" data-toggle="tooltip" title="Docentes"></i><i class="fa fa-flag" data-toggle="tooltip" title="Seguir"></i><i class="fa fa-calendar" data-toggle="tooltip" title="Temario"></i><i class="fa-regular fa fa-clock" data-toggle="tooltip" title="Tus inasistencias"></i></div></li>');				
								
				});

				if (items.length == 0) {
					var mensajeSinMaterias = 'No hay materias en el año actual o seleccionado. Cambia de año en <i class="fa fa-calendar" id="fireOpenAnio"></i>';
					if (getTipoUsuario()=='I') {
						mensajeSinMaterias = "Aquí encontrarás las materias de tu inscripción."; 
					} 
					items.push('<li><span class="text">' + mensajeSinMaterias + '</li>');
				}			
				
				var cantidad = 0;
				cantidad = $("#listaCursandoMaterias li").size();
				if (cantidad > 0) {
					$("#listaCursandoMaterias").remove();
				}
				
				$('<ul/>', {
					'id' : 'listaCursandoMaterias',
					'class' : 'todo-list',
					html : items.join('')
				}).appendTo('#contenedorListaCursando');
				
				if (items.length>=5) {
					$('#contenedorListaCursando').slimScroll({
				        height: "300px"
				    });						
				}
				
				$("#contenedorCursando .box-header h3.box-title").text("Materias (" + anio + ")") ;
				
				$("#listaCursandoMaterias li span a").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).text();

					mensaje.listar("/curso/"+id+"/"+texto.trim());

					$(window).scrollTo(".content-header",400);
					
					}
				});

				$("#listaCursandoMaterias li div.tools i.fa-flag").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
					
					usuario.seguir();
				}});
				
				
				$("#listaCursandoMaterias li div.tools i.fa-list-ol").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-pencil"></i> Parciales de  ' + texto.trim();
					

					var elMarcador = "100";
					var tablaMarcador = "tabla" + id;
					var jTablaMarcador = "#tabla" + id;
					/*var configuracionVentana = getConfiguracionVentana(elMarcador);
					var configuracionEncabezadoMapeo = configuracionVentana.encabezadoMapeo;
					var configuracionEncabezadoTitulo = configuracionVentana.encabezadoTitulo;
					var configuracionAtributosGrilla = configuracionVentana.atributosGrilla;
					*/
					var configuracionAtributosGrilla;
					url = "/4/cursado/materias/notas/"+id;
					
					var arrayEncabezadoMapeo = (new Function("return 'comision','nota1','nota2','nota3','nota4','nota5','nota6','nota7','nota8','nota9','nota10','notafinal'"))();
					var arrayEncabezadoTitulo = (new Function('return [{ "sTitle": "Comision" },{ "sTitle": "P1" },{ "sTitle": "P2"},{ "sTitle": "P3"},{ "sTitle": "P4"},{ "sTitle": "P5"},{ "sTitle": "P6" },{ "sTitle": "P7" },{ "sTitle": "P8"},{ "sTitle": "P9"},{ "sTitle": "P10" },{ "sTitle": "NotaFinal" }];'))();				

					abrirModalGeneral(titulo, '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="display table" id="' + tablaMarcador + '"></table>',true,true, 1);
					
					var titulo = "";
					$.ajax(configuracion.urlCompleta("academico/notas/titulos/")+ id,
							{
								dataType : "text"
						}).done(function(data) {
							
							if (data==null) { console.log("No hay respuesta");}
							
							titulo = data;
							var losTitulo = titulo.trim().toString().split("|");
							var tableHeaders = "";
							tableHeaders += "<th>Comisión</th>";
							for (i = 0; i < losTitulo.length; i++) {					    
		                        tableHeaders += "<th>" + losTitulo[i] + "</th>";
							}					
							
							$(jTablaMarcador).find("thead").remove();						
							$('<thead><tr>' + tableHeaders + '</tr></thead>').appendTo(jTablaMarcador);
  
							
							$(jTablaMarcador).DataTable( {
						        "ajax": {
						            "url": url,						            
						            "dataSrc": ""
						        },
								"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":true,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}},						        
						        "columns": [
								            { "data": "comision","visible": false },
								            { "data": "nota1" },
								            { "data": "nota2" },
								            { "data": "nota3" },
								            { "data": "nota4" },
								            { "data": "nota5" },
								            { "data": "nota6" },
								            { "data": "nota7" },
								            { "data": "nota8" },
								            { "data": "nota9" },
								            { "data": "nota10" },
								            { "data": "notafinal" }
								        ]				        
							});
						});
					}
				});

				$("#listaCursandoMaterias li div.tools i.fa-file").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
										
					mensaje.listar("/curso/documentos/"+id+"/"+texto.trim());
					
					$(window).scrollTo(".content-header",400);
				
					}
				});
			
				$("#listaCursandoMaterias li div.tools i.fa-group").on({click : function(e) {
					
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-group"></i> Docentes de  ' + texto;
					//var url = '/4/academico/docentes/'+id+"/materias";
					var url = '/4/academico/docentesComision/'+id;
					
					var misc = materias.misc();
										
					misc.modalTabla(id, url, 100, titulo, function(e){}, function(e){});

					}
				});

				$("#listaCursandoMaterias li div.tools i.fa-calendar").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa fa-calendar"></i> Temario ' + texto;
					var url = '/4/academico/temario/'+id;
					
					var misc = materias.misc();
					
					misc.modalTabla(id, url, 900, titulo, function(e){}, function(e){});
										
					}
				});
				
				$("#listaCursandoMaterias li div.tools i.fa-clock").on({click : function(e) {
					var _id = $(this).closest("li").attr("id");
					var id = _id.replace("idCurso","");
					var texto = $(this).closest("li").find("span").text();
					var titulo = '<i class="fa-regular fa fa-clock"></i> Inasistencias del ' + texto;
					var url = '/4/academico/inasistencias/'+id;
					
					var misc = materias.misc();
					
					misc.modalTabla(id, url, 800, titulo, function(e){}, function(e){});

					}
				});

			
			}).fail(function(data) {
				//notificar("danger", "Ha ocurrido un inconveniente.");
				console.log("no se puede recuperar el cursado");
			}).always(function() {
				var esteOverlay = $("#contenedorCursando").find(ec);
				esteOverlay.animate({opacity : 0.25}, 1000, function() {
						$(this).remove();
					});
				});			
		}
	},// fin Objeto Cursado
	Academico : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},		
		matricularme : function() {
			var config = this.configuracion();
			
			var url = config.urlCompleta("academico/matricula");

			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				beforeSend: function( xhr ) {
	                xhr.setRequestHeader("A4-Token", A4Token);
	                xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                xhr.setRequestHeader("A4-Data", A4Data);
	             },	
			}).done(function(data) {
				
				if (data) {
					var laData = data.value;
					var id = laData.split("|")[0];
					var mensaje = laData.split("|")[1];
					var tipoRespuesta = "success";
					
					if (id==0) { tipoRespuesta = "warning"; }
					
					notificar(tipoRespuesta, mensaje);
					
				} else {
					notificar("warning", "No se pudo obtener la información de tu matricula");
				}
				
				$(".refresh-btn").trigger("click");
				
			}).fail(function(data) {
				notificar("danger", "Ha ocurrido un inconveniente.");
			});				
		},
		estadoDocumentacion: function(APMCE) {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/documentacion/")+APMCE, {}, function(data) {
				var items = [];
				//console.log(data);
				$.each(data,function(key, val) {					
					estado = val.Respuesta;
					if (estado==1) {
						//continua el flujo
					} else if (estado==2) {
						//continua el flujo
					} else if (estado==3) {
						//abrirModalGeneral('<i class="fa fa-info"></i> Estado Documentación','<div style="font-size:100%; padding: 0.3em;">  <ul><li><strong>La AUTOGESTION OFICIAL ES LA VERSION 3  y se encuentra en : <a href="https://www.frc.utn.edu.ar/academico3/">https://www.frc.utn.edu.ar/academico3/</a></strong></li><li><strong>La AUTOGESTION 4 esta en FASE DE TESTING, la informaci&oacute;n acad&eacute;mica brindada es as&iacute;ncrona con la real </strong></li><li><strong>Hasta fines de Octubre de 2015 no te podrás comunicar con tus Docentes y será decisión de cada uno de ellos su uso. </strong></li></ul><b>Parte de nuestra misión es</b>:<ul><li> <b>Brindar</b> una herramienta como medio de comunicaci&oacute;n entre los alumnos, docentes y areas de Nuestra Facultad.</li><li> <b>Aportar</b> el soporte sobre el &aacute;rea tecnol&oacute;gica en base a las decisiones tomas por las distintas Areas de la Universidad..</li></ul><p><br><b>Usted es libre de</b>:</p><ul><li><b>Usar los recursos</b> de la Autogesti&oacute;n de acuerdo a los estatutos de la Universidad Tecnol&oacute;gica Nacional.</li><li><b>Contribuir </b> con informaci&oacute;n publicando mensaje a los alumnos y docentes de Nuestra Facultad.</li></ul><p><br><b>Bajo las siguientes condiciones</b>:</p><ul>  <li> <b>Responsabilidad</b> &mdash; Usted es responsable de sus publicaciones (en tanto que nosotros sólo <b>alojamos</b> su contenido).</li>  <li> <b>Urbanidad</b> &mdash; Usted apoyará un entorno cívico y universitario y no hostigará ni atacará a otros alumnos, docentes &oacute; &aacute;reas de la Universidad.</li>  <li> <b>Comportamiento legal</b> &mdash; Usted no infringirá las leyes ni los estatutos de la Universidad..</li>  <li> <b>No daños</b> &mdash; Usted no dañará nuestra infraestructura tecnológica.</li><li> <b>Términos y condiciones de uso y políticas</b> &mdash; Usted adhiere a los siguientes Términos y condiciones y a las políticas de la comunidad aplicables cuando usted visita nuestros sitios o participa en nuestras comunidades.</li></ul><p><br><b>Con el entendimiento de que</b>:</p><ul>    <li> <b>Autogesti&oacute;n 3</b> &mdash; es donde se encuentra actualmente la Informaci&oacute;n Acad&eacute;mica v&aacute;lida. </li>    <li><strong>Autogesti&oacute;n 4 </strong> &mdash; es una prueba beta y el contenido de los mensajes y grupos y acciones que se realicen, estar&aacute;n sujetos a auditor&iacute;as.</li>    <li><strong>Inconvenientes </strong> &mdash; es un sistema de prueba y pueden ocurrir cambios imprevistos.<br />Si encontr&aacute;s detalles t&eacute;cnicos, por favor, informalos a <a href="mailto:autogestion@frc.utn.edu.ar">autogestion@frc.utn.edu.ar</a> </li></ul></div>',true,true,1,function(e) { usuario.actualizarPreferencia(9,1);$('#dialogoGeneral').modal('hide');}, function(e) { $("html").empty();window.location.href=urlLogoutSSLUTNFRC; },{backdrop: 'static',keyboard: false},true);
					} else {
						//abrirModalGeneral('<i class="fa fa-info"></i> Estado Documentación','<div style="font-size:100%; padding: 0.3em;">  <ul><li><strong>La AUTOGESTION OFICIAL ES LA VERSION 3  y se encuentra en : <a href="https://www.frc.utn.edu.ar/academico3/">https://www.frc.utn.edu.ar/academico3/</a></strong></li><li><strong>La AUTOGESTION 4 esta en FASE DE TESTING, la informaci&oacute;n acad&eacute;mica brindada es as&iacute;ncrona con la real </strong></li><li><strong>Hasta fines de Octubre de 2015 no te podrás comunicar con tus Docentes y será decisión de cada uno de ellos su uso. </strong></li></ul><b>Parte de nuestra misión es</b>:<ul><li> <b>Brindar</b> una herramienta como medio de comunicaci&oacute;n entre los alumnos, docentes y areas de Nuestra Facultad.</li><li> <b>Aportar</b> el soporte sobre el &aacute;rea tecnol&oacute;gica en base a las decisiones tomas por las distintas Areas de la Universidad..</li></ul><p><br><b>Usted es libre de</b>:</p><ul><li><b>Usar los recursos</b> de la Autogesti&oacute;n de acuerdo a los estatutos de la Universidad Tecnol&oacute;gica Nacional.</li><li><b>Contribuir </b> con informaci&oacute;n publicando mensaje a los alumnos y docentes de Nuestra Facultad.</li></ul><p><br><b>Bajo las siguientes condiciones</b>:</p><ul>  <li> <b>Responsabilidad</b> &mdash; Usted es responsable de sus publicaciones (en tanto que nosotros sólo <b>alojamos</b> su contenido).</li>  <li> <b>Urbanidad</b> &mdash; Usted apoyará un entorno cívico y universitario y no hostigará ni atacará a otros alumnos, docentes &oacute; &aacute;reas de la Universidad.</li>  <li> <b>Comportamiento legal</b> &mdash; Usted no infringirá las leyes ni los estatutos de la Universidad..</li>  <li> <b>No daños</b> &mdash; Usted no dañará nuestra infraestructura tecnológica.</li><li> <b>Términos y condiciones de uso y políticas</b> &mdash; Usted adhiere a los siguientes Términos y condiciones y a las políticas de la comunidad aplicables cuando usted visita nuestros sitios o participa en nuestras comunidades.</li></ul><p><br><b>Con el entendimiento de que</b>:</p><ul>    <li> <b>Autogesti&oacute;n 3</b> &mdash; es donde se encuentra actualmente la Informaci&oacute;n Acad&eacute;mica v&aacute;lida. </li>    <li><strong>Autogesti&oacute;n 4 </strong> &mdash; es una prueba beta y el contenido de los mensajes y grupos y acciones que se realicen, estar&aacute;n sujetos a auditor&iacute;as.</li>    <li><strong>Inconvenientes </strong> &mdash; es un sistema de prueba y pueden ocurrir cambios imprevistos.<br />Si encontr&aacute;s detalles t&eacute;cnicos, por favor, informalos a <a href="mailto:autogestion@frc.utn.edu.ar">autogestion@frc.utn.edu.ar</a> </li></ul></div>',true,true,1,function(e) { usuario.actualizarPreferencia(9,1);$('#dialogoGeneral').modal('hide');}, function(e) { $("html").empty();window.location.href=urlLogoutSSLUTNFRC; },{backdrop: 'static',keyboard: false},true);
					}
				});	
			});			
		},
		docentes: function(APMCE) {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/docentes/")+APMCE, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
				});

			});			
		},
		temario: function(APMCE) {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/temario/")+APMCE, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
				});


			});			
		},
		inasistencias: function(APMCE) {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/inansistencias/")+APMCE, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
				});


			});			
		},
		reservas: function() {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("reservas"), {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
				});
			});			
		},

		promedio: function() {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("cursado/actual/")+anio, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var materia = val.materia;
					var curso = val.curso;
					var id = val.enlace;
				
					items.push('<li><a href="#" data-toggle="tooltip">(' + curso.trim() + ') ' + materia + '</a><div class="tools"><i class="fa fa-file" data-toggle="tooltip" id="itemDocumentos'+id+'"></i><i class="fa fa-group" id="itemDocentes'+id+'"></i><i class="fa fa-calendar" id="itemTemario'+id+'"></i><i class="fa-regular fa fa-clock" id="itemInasistencias'+id+'"></i></div></li>');				
								
				});

				var cantidad = 0;
				cantidad = $("#listaCursandoMaterias li").size();
				if (cantidad > 0) {
					$("#listaCursandoMaterias").remove();
				}
				
				$('<ul/>', {
					'id' : 'listaCursandoMaterias',
					'class' : 'todo-list',
					html : items.join('')
				}).appendTo('#contenedorListaCursando');
				
				if (items.length>=5) {
					$('#contenedorListaFavoritos').slimScroll({
				        height: altoGeneral
				    });						
				}
				

			}).fail(function() {
			});			
		},

		inhabilitaciones: function() {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("academico/inhabilitaciones/"), {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var materia = val.materia;
					var curso = val.curso;
					var id = val.enlace;
				
					items.push('<li><a href="#" data-toggle="tooltip">(' + curso + ') ' + materia + '</a><div class="tools"><i class="fa fa-file" data-toggle="tooltip" id="itemDocumentos'+id+'"></i><i class="fa fa-group" id="itemDocentes'+id+'"></i><i class="fa fa-calendar" id="itemTemario'+id+'"></i><i class="fa-regular fa fa-clock" id="itemInasistencias'+id+'"></i></div></li>');				
								
				});

				var cantidad = 0;
				cantidad = $("#listaCursandoMaterias li").size();
				if (cantidad > 0) {
					$("#listaCursandoMaterias").remove();
				}
				
				$('<ul/>', {
					'id' : 'listaCursandoMaterias',
					'class' : 'todo-list',
					html : items.join('')
				}).appendTo('#contenedorListaCursando');
				
				if (items.length>=5) {
					$('#contenedorListaFavoritos').slimScroll({
				        height: altoGeneral
				    });						
				}
				

			}).fail(function() {
			});			
		}
	},// fin Objeto Academico
	Asistencia : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		listarCurso: function() {
			var config = this.configuracion();
			$.getJSON(config.urlCompleta("tomar-asistencia/curso/"), {}, function(data) {
				var items = [];
				var itemsMenu = [];
				$.each(data,function(key, val) {
					var elItem = '<a href="#" class="curso list-group-item" id="' + val.nombre + '">' + val.id + '</a>';
					items.push(elItem);
					itemsMenu.push('<li>' + elItem + '</li>');
				});
				
				var itemsFinal = items.join('');
				var itemsFinalMenu = itemsMenu.join('');
				
				$(".listaAlumnos").hide();
				$(".listaCursos").append(itemsFinal);
				
				$("#listaCursosMenu").empty();
				$("#listaCursosMenu").append(itemsFinalMenu);
				
				//$("#bs-example-navbar-collapse-1 ul.navbar-right").show();
			
			
			});
		},
		listarComision: function(cursoSeleccionado) {
			
			var config = this.configuracion();
			
			$(".listaComisiones").empty();
			
			$.getJSON(config.urlCompleta("tomar-asistencia/comision/")+cursoSeleccionado, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					items.push('<a href="#" class="comision list-group-item" id="' + val.id + '">' + val.nombre + '</a>');
				});
				
				var itemsFinal = items.join('');
				
				$(".listaCursos").hide();
				$(".listaAlumnos").hide();
				$(".listaComisiones").append(itemsFinal);
				
				//$("#bs-example-navbar-collapse-1 ul.navbar-right").show();
			
			
			});

		},

		listarAlumnos: function(codigo, fecha) {
			var config = this.configuracion();
			$(".listaComisiones").empty();
			
			var url = config.urlCompleta("tomar-asistencia/curso/alumnos/");
			
			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				data : {
					codigo : codigo,
					fecha : fecha,

				}
			}).done(function(data) {

				var items = [];
				$.each(data,function(key, val) {
					var legajo = val.id;
					items.push('<a href="#" class="list-group-item checked" id="' + legajo + '" style="font-size:18px">' + val.nombre + '</a>');
				});
				
				var itemsFinal = items.join('');
			
				$(".listaAlumnos").append(itemsFinal);
				$(".listaAlumnos").show();
				
				$("#mainNavBar li").removeClass("hidden");
				
				Autogestion.Asistencia.comisionesFechas(codigo);
				

			}).fail(function(data) {

				console.log("Fail listarAlumnos");

			});
			
		},
		
		comisionesFechas: function(codigo) {
			var config = this.configuracion();
			
			var url = config.urlCompleta("tomar-asistencia/comision/fechas/");
			
			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				data : {
					codigo : codigo,
				}
			}).done(function(data) {

				var items = [];
				var itemsMenu = [];

				$.each(data,function(key, val) {
					//var legajo = val.id;
					//items.push('<a href="#" class="checked list-group-item" id="' + legajo + '"><h4 class="list-group-item-heading">' + val.nombre + '</h4></a>');
					
					var fecha = moment(val.id);
					var fechaFormateada = fecha.format("DD/MM/YYYY");
					
					var elItem = '<a href="#" class="curso list-group-item" id="' + fechaFormateada + '">' + fechaFormateada + '</a>';
					items.push(elItem);
					itemsMenu.push('<li>' + elItem + '</li>');

				});
				
				var itemsFinal = items.join('');
				var itemsFinalMenu = itemsMenu.join('');			
				
			
				//$(".listaAlumnos").append(itemsFinal);
				//$(".listaAlumnos").show();
				
				$("#fechasExistentes").empty();				
				$("#fechasExistentes").append(itemsFinalMenu);
				
				$("#bs-example-navbar-collapse-1 ul.navbar-nav").removeClass("hidden");
				$("#bs-example-navbar-collapse-1 ul.navbar-right li.dropdown").removeClass("hidden");
				

			}).fail(function(data) {

				console.log("Fail comisionesFechas");

			});
			
		},
		
		registrar: function(legajo, codigo, fecha) {
			var config = this.configuracion();
			
			var url = config.urlCompleta("tomar-asistencia/alumno/");
			
			$.ajax({
				url : url,
				type : 'POST',
				dataType : "json",
				data : {
					codigo : codigo,
					legajo : legajo,
					fecha : fecha,
				}
			}).done(function(data) {

				$("#"+legajo).addClass("list-group-item-danger unchecked");
				$("#"+legajo).append('<span class="glyphicon glyphicon-remove" aria-hidden="true" style="padding-right:10px"></span>');
				$("#"+legajo).removeClass("checked");
				

			}).fail(function(data) {

				console.log("FAIL registrar");

			});
		},
		
		quitar : function(legajo, codigo, fecha) {
			var config = this.configuracion();
			
			var url = config.urlCompleta("tomar-asistencia/alumno/");
			
			$("#"+legajo).removeClass("list-group-item-danger").addClass("list-group-item checked");
			$("#"+legajo).find("span").remove();
			$("#"+legajo).removeClass("unchecked");

			/**/
			$.ajax({
				url : url,
				type : 'DELETE',
				dataType : "json",
				beforeSend: function(xhr) {
	                    xhr.setRequestHeader("A4-Token", A4Token);
	                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                    xhr.setRequestHeader("A4-Data", A4Data);
	                    xhr.setRequestHeader("codigo", codigo);
	                    xhr.setRequestHeader("legajo", legajo);
	                    xhr.setRequestHeader("fecha", fecha);
				},
			}).done(function(data) {

				$("#"+legajo).removeClass("list-group-item-danger").addClass("list-group-item checked");
				$("#"+legajo).find("span").remove();
				$("#"+legajo).removeClass("unchecked");
					

			}).fail(function(data) {

				console.log("FAIL registrar");

			});
			/**/
		},
		

	},// fin Objeto Asistencia	
	Misc : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		modalTabla : function (id, urlEnlace, idMarcador, tituloModal, callBackAceptar, callBackCancelar) {

			var elMarcador = idMarcador;
			var tablaMarcador = "tabla" + elMarcador;
			var jTablaMarcador = "#tabla" + elMarcador;
			var configuracionVentana = getConfiguracionVentana(elMarcador);
			var configuracionEncabezadoMapeo = configuracionVentana.encabezadoMapeo;
			var configuracionEncabezadoTitulo = configuracionVentana.encabezadoTitulo;
			var configuracionAtributosGrilla = configuracionVentana.atributosGrilla;
			
			url = urlEnlace;
			var arrayEncabezadoMapeo = (new Function("return [" + configuracionEncabezadoMapeo + "];"))();
			var arrayEncabezadoTitulo = (new Function("return [" + configuracionEncabezadoTitulo + "];"))();

			if (typeof configuracionAtributosGrilla === "undefined") {
				configuracionAtributosGrilla = '{"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":false,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"sAjaxSource":url,"fnServerData":fnServerObjectToArray(arrayEncabezadoMapeo),"aoColumns": arrayEncabezadoTitulo,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}}}';;
			}
			
			var initGrilla = eval('(function(){return' + configuracionAtributosGrilla + ';})()');
			
			if (getTipoUsuario()=="D") {
				$("#dialogoGeneral #openExternal").attr("href","/4/table.jsp?url="+utf8ToHex(url)+"&titulo="+utf8ToHex(tituloModal));
			}		
			
			abrirModalGeneral(tituloModal , '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="display" id="' + tablaMarcador + '"></table>',true,true, 1, callBackAceptar, callBackCancelar);
			
			$(jTablaMarcador).dataTable(initGrilla);		   					

		}
	},// fin Objeto Misc
	Bitacora : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		listar: function(texto) {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("bitacora/mi");
			$.ajax({
				url : laUrl,
				type : 'GET',
			}).done(function(data) {
				//console.log(data);
			}).always(function(data) {
				//console.log("termino")
			});
		
		},

	},// fin Objeto Misc
	Sugerencia : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		enviar: function(texto) {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("sugerencia/")+texto;
			$.ajax({
				url : laUrl,
				type : 'POST',
			}).done(function(data) {
				mostrarNotificacion(data);
			}).always(function(data) {
				$("#textoSugerencia").val("");
			});
		
		},

	},// fin Objeto Misc
	Arancel : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		generarPaquete: function(cuotas) {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("arancel/cuota/paquete?cuotas=")+cuotas;
					
			$.ajax({ 
    			type: 'POST', 
			    url: laUrl,
			    dataType: 'json',
			    success: function (data) { 
					var urlCheckOut = data.checkout_url;
					
					if (urlCheckOut) {
						alert("Lo estamos redirigiendo al sitio de pagos. Gracias!");
						window.location.href = urlCheckOut;

					}
			    },
				error: function (xhr, error, thrown) {
					console.log("Ocurrio un error generado la cuota." + error );
					alert("No se genero la cuota. Consulte con su Secretaría. Gracias!");
					}
			});
					
		},
		consultar: function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("arancel/");
					
			$.ajax({ 
    			type: 'GET', 
			    url: laUrl, 
			    dataType: 'json',
			    success: function (data) { 
					var urlCheckOut = data.checkout_url;
					
					if (urlCheckOut) {
						alert("Lo estamos redirigiendo al sitio de pagos. Gracias!");
						window.location.href = urlCheckOut;

					}
			    },
				error: function (xhr, error, thrown) {
					console.log("Ocurrio un error generado la cuota." + error );
					alert("No se genero la cuota. Consulte con su Secretaría. Gracias!");
					}
			});
					
		},
		combos: function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("arancel/combos");

			$.ajax({
    			type: 'GET',
			    url: laUrl,
			    dataType: 'json',
			    success: function (data) {
					var urlCheckOut = data.checkout_url;

					if (urlCheckOut) {
						alert("Lo estamos redirigiendo al sitio de pagos. Gracias!");
						window.location.href = urlCheckOut;

					}
			    },
				error: function (xhr, error, thrown) {
					console.log("Ocurrio un error generado la cuota." + error );
					alert("No se genero la cuota. Consulte con su Secretaría. Gracias!");
					}
			});

		},

	},// fin Objeto Misc
	Servicio : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		inicial : function(tipoServicio,estado) {
			
			console.log("estado : " + estado);
			
			mensajeCuil = 'Tu CUIL es : <a href="#" id="cuil" data-type="cuilx" data-pk="1">' + cuil + ' </a> (Cambia tu CUIL <a href="https://www.frc.utn.edu.ar/academico3/datosPersonales.frc" target="_blank">Aquí</a>)';
			btnEnabled = '';
			
			if (cuil=="11111111") {
				mensajeCuil = 'No encontramos tu CUIL cargado, actualiza el mismo <a href="https://www.frc.utn.edu.ar/academico3/datosPersonales.frc" target="_blank">Aquí</a>';
				btnEnabled = 'disabled';
			}
			
			var btnSi = '<button type="button" class="btn btn-success pull-left btnAutorizaBoletoEducativo" data-dismiss="modal" data-info="1" ' + btnEnabled + '><i class="fa fa-check"></i> Sí, Autorizo</button>';
			var btnNo = '<button type="button" class="btn btn-danger btnAutorizaBoletoEducativo" data-dismiss="modal" data-info="0"><i class="fa fa-times"></i> Denegar</button>';

			var btns = btnSi + btnNo;
			
			if (estado==0) {
				btns = btnSi + btnNo;
			} else if (estado==1) {
				btns = btnNo;
			} else if (estado==2) {
				btns =  btnSi;
			}  
			
			if (tipoServicio="BEG") {
				abrirModalGeneral('<i class="fa fa-bus"></i> Boleto Educativo Gratuito',
						'<div style="font-size:100%; padding: 0.3em;"><p style="font-size:20px">En virtud de las nuevas directivas del Ministerio de Transporte de la Provincia de Córdoba, necesitamos nos autorices a enviar información personal a dicho ministerio para que puedas tramitar el Boleto Educativo Gratuito</p><h3>Paso 1</h3><p>Debes autorizar para enviar información personal, de tu cursado y <strong><u>tener correctamente tu número de CUIL</u></strong>. Verifica el mismo en <a href="https://www.anses.gob.ar/consulta/constancia-de-cuil" target="_blank">Anses <i class="fa fa-external-link"></i></a></p><p style="font-size:20px">' + mensajeCuil + '</p><div>'+ btns + '</div><br/><h3>Paso 2</h3><p>Consulta los pasos a seguir en <a href="https://www.cba.gov.ar/boleto-cordobes/" target="_blank">https://www.cba.gov.ar/boleto-cordobes/</a> .</p></div>',
						true,
						false,
						0,
						function(e) {},
						function(e) {},
						{backdrop: 'static',keyboard:	 false},
						false);	

			}
			
		},
		estadoAutorizacionBoleto : function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("servicios/boleto/estado/autorizacion/"+cuil);
            var mensajeCuil = 'Tu CUIL registrado: <strong>' + cuil + '</strong>. Cambia tu CUIL <a href="https://www.frc.utn.edu.ar/academico3/datosPersonales.frc" target="_blank">Aquí</a>';

            if (cuil=="11111111") {
                mensajeCuil = 'No encontramos tu CUIL cargado, cambiar <a href="https://www.frc.utn.edu.ar/academico3/datosPersonales.frc" target="_blank">Aquí</a>';
            }
			
			$.getJSON(laUrl, {}, function(data) {
				var items = [];

				if (!data) {					
					$('#contenedorListaServicios ul').html('<li>No se pudo obtener los servicios activos.</li>');r
					return ;
				} else {
					$("#mensajeBoletoEducativo").remove();
				}
				
				estado = data.Respuesta;
				descripcion = data.Descripcion;
				
				if (estado==0) {
					items.push('<li>Autorizá a brindar información de cursado para el Boleto Educativo. <a href="javascript:void(0)" id="boletoEducativo" class="btn btn-primary btn-xs ladda-button" data-info='+estado+'><i class="fa fa-thumbs-up"></i>&nbsp;Solicitar</a></li>');
				} else if (estado==1) {
					var fecha = descripcion.split('|')[0];
					var expediente = descripcion.split('|')[1];
					
					items.push('<li><span class="text">Autorizaste a brindar tu información el <span class="label label-info" title="Fecha Autorización ' + fecha + '"><i class="fa-regular fa fa-clock"></i> ' + fecha + '</span> expediente <strong>' + expediente + '</strong></span></span><div class="tools"><a href="javascript:void(0)" id="boletoEducativo" class="btn-xs ladda-button btn-danger" data-dismiss="modal" data-info='+estado+'><i class="fa fa-ban"></i>&nbsp;Denegar </a>&nbsp;</div></li>');
					
				} else if (estado==2) {
					var fecha = descripcion.split('|')[0];
					var expediente = descripcion.split('|')[1];
					
					items.push('<li><span class="text">Denegaste brindar información del cursado el<span class="label label-info" title="Fecha Denegación ' + fecha + '"><i class="fa-regular fa fa-clock"></i> ' + fecha + '</span> expediente <strong>' + expediente + '</strong></span></span><div class="tools"><a href="javascript:void(0)" id="boletoEducativo" class="btn btn-primary btn-xs ladda-button" data-info='+estado+'><i class="fa fa-thumbs-up"></i>&nbsp;Cambiar</a><div></li>');
				}  

			    $("#mensajeHeaderBoletoEducativo").html(mensajeCuil);
			    $("#mensajeFooterBoletoEducativo").show();

				$('<ul/>', {
					'id' : 'mensajeBoletoEducativo',
					'class' : 'todo-list',
					html : items.join('')
				}).appendTo('#tabBoleto');
				
			}).fail(function() {
				$('#contenedorListaServicios ul').html('<li>No se pudo obtener los servicios activos.</li>');
				console.log("No se pudo obtener la info del Boleto");
			});
						
		},		
		autorizarAccesoInfo : function(autorizo) {
			var cuil = $("#cuil").text();
			var url = "/4/servicios/boleto/autorizo/"+autorizo+"/"+cuil;
			var textoAutoriza = "";
			
			if (autorizo==1) {
				textoAutoriza = "Autorización "
			} else {
				textoAutoriza = "Denegación "	
			}
			
			$.ajax({
		        url: url,
		        type: "POST",
		        success: function(data) {
		        	if (data=="-1") {
		        		notificar("danger", "El CUIL no es coincidente con la información brindada");
		        	}
		        	if (data=="0") {
		        		notificar("danger", "Autorización NO realizada.");
		        	}
		        	if (data=="1") {
		        		notificar("success", textoAutoriza + "realizada.");
		        	}

		        	servicio.estadoAutorizacionBoleto();
		        }
		    	});
		},
        devolverMensajes : function() {
            var mensajeDefault = "No disponible";
            var mensajeBoletoConsultaInicial = "Ultima consulta .GOV: ";
            var mensajeBoleto, mensajeOffice365 = "";
			if (cuil=="11111111") {
				mensajeBoletoConsultaInicial = mensajeDefault;
			} else {
                var url = "/4/servicios/mensajes/"+cuil;

                $.ajax({
                    url : url,
                    type : 'GET',
                    dataType : "json",
                }).done(function(data) {
                    if (data) {
                        if (data.BEG) {
                            $('<p/>', {
                                'id' : 'mensajeFooterBoletoEducativo',
                                html : ''
                            }).insertAfter('#mensajeBoletoEducativo');

                            if (data.BEG.valor!="") {
                                var momentoFechaBeg = moment(data.BEG.valor);
                                mensajeBoleto = mensajeBoletoConsultaInicial + momentoFechaBeg.format("DD/MM/YYYY HH:mm:ss");
                                $("#mensajeFooterBoletoEducativo").html(mensajeBoleto);
                            }
                        }
                        if (data.Office) {
                            $('<p/>', {
                                'id' : 'mensajeFooterOffice365',
                                html : ''
                            }).insertAfter('#mensajeOffice365');

                            var momentoFechaOffice = moment(data.Office.valor);
                            mensajeOffice365 = momentoFechaOffice.format("DD/MM/YYYY HH:mm:ss");
                            $("#mensajeFooterOffice365").html(mensajeOffice365);
                        }

                    }
                }).fail(function(data) {
                    $("#mensajeFooterBoletoEducativo").html(mensajeDefault);
                    $("#mensajeFooterOffice365").html(mensajeDefault);
                });
			}
        }

	},// fin Objeto Servicio	
	Peticion : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		mensajeInscripcionAExamen2 : function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes/mensajes");

			var htmlMensaje = '<div id="mensajeInicialInscripcionAExamen"><div id="listaMensajeInscripcionAExamen">buscando mensajes...</div><a href="javascript:void(0);" id="btnInscripcionExamen" class="btn btn-primary btn-lg"> ACEPTAR </a><p style="text-align:center;font-size: 24px;">LA INSCRIPCIÓN ESTÁ SUJETA A AUDITORÍA</p></div>';
			var htmlAccordion = '<div class="col-lg-12 col-x2-12" id="panelInscripcionAExamen">Te podes inscribir a las siguientes materias: <br/><div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true"></div></div>';

			abrirModalGeneral("Inscripción a Examenes!", "html", true, true, 1, function(e) {
                $.ajax({
                    url : laUrl,
                    type : 'GET',
                    dataType : 'json'
                }).done(function(data) {

                    if (!data) { return; }

                    var mensaje = "";

                    $.each(data,function(key, val) {
                        var id = val.id;
                        var texto= val.valor;
                        var tituloMensaje = "<h4>" + val.nombre + "</h4>";
                        texto = '<p style="font-size:16px;font-weight: 600;">' + texto.replace(/(?:\r\n|\r|\n)/g, '<br/>') + "</p>";
                        mensaje = mensaje + tituloMensaje + texto;
                    });

                   $("body div#listaMensajeInscripcionAExamen").html(mensaje);

                }).fail(function(data) {
                    console.log("Ha ocurrido un error inscripcionAExamenMensaje");
                }).always(function(data) {
                    console.log("Siempre inscripcionAExamenMensaje");
                });

                var html = htmlMensaje + htmlAccordion;
                $("body div#dialogoGeneral div.modal-dialog").attr("style","width:60%");
                $("body div#panelInscripcionAExamen").hide();
                $("body div#mensajeInicialInscripcionAExamen").show();
			},
			function(e){},{backdrop: 'static',keyboard: false});//fin abrirModalGeneral


		},
		mensajeInscripcionAExamen : function() {

			var htmlMensaje = '<div id="mensajeInicialInscripcionAExamen"><div id="listaMensajeInscripcionAExamen">buscando mensajes...</div><a href="javascript:void(0);" id="btnInscripcionExamen" class="btn btn-primary btn-lg"> ACEPTAR </a><p style="text-align:center;font-size: 24px;">LA INSCRIPCIÓN ESTÁ SUJETA A AUDITORÍA</p></div>';
			var htmlAccordion = '<div class="col-lg-12 col-x2-12" id="panelInscripcionAExamen">Te podes inscribir a las siguientes materias: <br/><div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true"></div></div>';

			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes/mensajes");			
			$.ajax({
				url : laUrl,
				type : 'GET',
				dataType : 'json'
			}).done(function(data) {

				if (!data) { return; }

				var mensaje = "";

				$.each(data,function(key, val) {
					var id = val.id;
					var texto= val.valor;
					var tituloMensaje = "<h4>" + val.nombre + "</h4>";
					texto = '<p style="font-size:16px;font-weight: 600;">' + texto.replace(/(?:\r\n|\r|\n)/g, '<br/>') + "</p>";
					mensaje = mensaje + tituloMensaje + texto;
				});

			$("body div#listaMensajeInscripcionAExamen").html(mensaje);

			}).fail(function(data) {
				console.log("Ha ocurrido un error inscripcionAExamenMensaje");
			}).always(function(data) {
				console.log("Siempre inscripcionAExamenMensaje");
			});
										
			var html = htmlMensaje + htmlAccordion;
						
			abrirModalGeneral("Inscripción a Examenes!", html, true, false, 0, function(e) {
		        e.preventDefault();
				Autogestion.Peticion.listarMateriasInscripcionAExamen("puede",false);
			    console.log("call listarMateriasInscripcionAExamen");
				return true;
			}); //fin abrirModalGeneral

			$("body div#dialogoGeneral div.modal-dialog").attr("style","width:60%");
			$("body div#panelInscripcionAExamen").hide();
			$("body div#mensajeInicialInscripcionAExamen").show();			  
									
		},
		listarMateriasInscripcionAExamen : function(scope, append) {
		
			//controlamos el size
			if ($("body #accordion .panel").size()==0) {
				return;
			}
			var scopeParam = '?scope=';
			var htmlScope = '';

			if (typeof scope === "undefined") {				
				scopeParam = '';				 
			} else {
				scopeParam+=scope;
				if (scope=="todas") {
					htmlScope = '';
				} 				
			}

			if (!append) {
				htmlScope = '<a href="javascript:void(0)" id="btnListarMateriasExamen">Ver el resto de las materias</a>';				
			} else {
				$("#btnListarMateriasExamen").remove();
				htmlScope = '';
			}						
			
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes/materias")+scopeParam;
			$.ajax({
				url : laUrl,
				type : 'GET',
				dataType : 'json'
			}).done(function(data) {
						
				if (!data) {
					//agregar un mensaje, ahora cual será ya que no tenemos control sobre la peticion
					return;
				}

                $("body div#panelInscripcionAExamen").show();
                $("body div#mensajeInicialInscripcionAExamen").hide();
				if (data.length==0) {
				    $("body div#panelInscripcionAExamen").html("No tenés materias a las que te puedas inscribir a examen en función de tu estado académico.");
				    return;
				}

				var htmlCollapse = '';				
				
				$.each(data,function(key, val) {
					var idExamenCache = val.idExamenCache;
					var materia = val.nombreMateria;
					var idMateria = val.materia;
					var especialidad = val.especialidad;
					var plan = val.plan;
					var id = idMateria+"-"+especialidad+"-"+plan+"-"+idExamenCache;
					var puedeInscribirse = val.puedeInscribirse;
					var puedeBorrar = val.puedeBorrar;
					var nivel = val.nivel;
					var practico = val.practico;
					var estado = val.estado;
					var fecha = val.fecha;
					var classPanelHeading = " in";
					var collapsive = "in";					
					var estadoFinal = estado.replace(/(?:\r\n|\r|\n)/g, '<br/>');
					var classPanelTitle = "panel-title";
					var stylePanelTitle = 'font-size:20px; margin: 0; flex-grow: 1; text-align: left;';
					var classPanel = 'panel-primary';
					var htmlAcciones = '';
					var htmlAccionMail = '<a href="javascript:void(0);" class="btnMailInscripcionExamen btn btn-primary" data-id="'+id+'" title="Enviar por mail"><i class="fa fa-envelope"></i><span class="hidden-xs hidden-sm hidden-md">Enviar Comprobante</span></a>';
					var htmlAccionEliminar = '<a href="javascript:void(0);" class="btnEliminarInscripcionExamen btn btn-warning" data-id="'+id+'" title="Eliminar Inscripción"><i class="fa fa-trash"></i><span class="hidden-xs hidden-sm hidden-md">Eliminar Inscripción</span></a>';
					var htmlDivMensajeRespuesta = '<div id="mensajeRespuetaInscripcionAExamen'+id+'"></div>';
					var htmlDivInfo = '<div id="mensajeInfoInscripcionAExamen'+id+'"></div>';
					var htmlTribunales = '';
					var htmlListarTribunales = '<a href="javascript:void(0);" id="listarTribunal'+id+'" class="btnListarTribunal btn btn-default" data-id="'+id+'">Listar los tribunales  <i class="fa fa-angle-right fa-3"></i></a>';

					if (puedeInscribirse==0) { 
						classPanelHeading = "";
						collapsive = " in ";
						classPanelTitle = "panel-title";
						stylePanelTitle = "";
						htmlAcciones = '';	
						classPanel = '';
						htmlTribunales = estadoFinal;			
					} else {
						htmlAcciones = '';
						collapsive = " in ";						
						classPanel = ' panel-primary ';
						htmlTribunales = htmlListarTribunales;
					}

					if (scope=="nopuede") {
                        htmlAccionEliminar = '';
                        htmlAccionMail = '';
					}
					
					if ((puedeBorrar==1) && (puedeInscribirse==0)) {
					    htmlAcciones = '';
                        collapsive = " in ";
                        classPanel = ' panel-primary';
  						htmlTribunales = estadoFinal;
						classPanelHeading = ' in ';
						htmlAcciones = htmlAccionMail + htmlAccionEliminar;
					} else {
						classPanelHeading = '';
						htmlAcciones = '';//htmlAccionMail + htmlAccionEliminar;
					}

					htmlCollapse+='<div class="panel panel-default '+classPanel+'">';
					htmlCollapse+='<div class="panel-heading '+classPanelHeading+' clearfix" role="tab" id="heading'+id+'" style="display: flex; align-items: center; justify-content: space-between;">';
					htmlCollapse+='<h3 class="'+classPanelTitle+'" style="'+stylePanelTitle+'">';
					htmlCollapse+=materia +'</h3>';
					//htmlCollapse+='<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse'+id+'" aria-expanded="true" aria-controls="collapse'+id+'">x</a>';
					htmlCollapse+='<div class="btn-group" role="group">'
					htmlCollapse+=htmlAcciones;
					htmlCollapse+='</div>';
					htmlCollapse+='</div>';
					htmlCollapse+='<div id="collapse'+id+'" class="panel-collapse collapse '+collapsive+'" role="tabpanel" aria-labelledby="heading'+id+'"><div class="panel-body"> ';
					htmlCollapse+='<div class="row">';
					htmlCollapse+='<div class="col-xs-6 col-md-3">';
					htmlCollapse+=htmlTribunales;
					htmlCollapse+='</div>';
					htmlCollapse+='<div class="col-xs-6 col-md-5">';
					htmlCollapse+=htmlDivMensajeRespuesta;
					htmlCollapse+='</div>';
					htmlCollapse+='<div class="col-xs-6 col-md-4">';
					htmlCollapse+=htmlDivInfo;
					htmlCollapse+='</div>';
					htmlCollapse+='</div></div></div></div>';

				});

				$("body div#accordion").append(htmlCollapse);
				$("body div#accordion").after(htmlScope);			
				
			}).fail(function(data) {
				console.log("Ha ocurrido un error inscripcionAExamenCache");		
			}).always(function(data) {
				console.log("Siempre inscripcionAExamenCache");
			});
		
		},
		listarExamenTribunal : function(id) {
			var jListaTribunal = "a#listarTribunal"+id;
			$(jListaTribunal).attr('disabled','disabled');
			var jRespuesta = "body div#mensajeRespuetaInscripcionAExamen"+id;
			var jMensajeInfo = "body div#mensajeInfoInscripcionAExamen"+id;
			var jColapseTribunal = "#collapse"+id+ " div.panel-body";
			var iconoWarning = '<i class="fas fa-exclamation-circle" style="margin-right: 10px; margin-top: 5px;"></i>';
			var cssStyle = 'font-size:16px;color:#e42e2e;';
			var mensajeInfo = 'Si estuviese faltando la regularidad a alguna materia dirigirse al <strong>Departamento al que pertenece dicha materia.</strong><br />Si estuviese faltando algún examen aprobado, dirigirse al <strong>Departamento Exámenes.</strong>';
            var mensajeServicio = "No se encuentra disponible el servicio.";
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes/tribunal/");
            var responseMessage = "";
		    var oTribunal = { "materia":id.split("-")[0], "especialidad":id.split("-")[1], "plan":id.split("-")[2]};
//		        data: JSON.stringify(oTribunal),

            laUrl = laUrl + "?materia="+oTribunal.materia+"&especialidad="+oTribunal.especialidad+"&plan="+oTribunal.plan;
			$.ajax({
				url : laUrl,
				type : 'GET',
		        dataType : 'json',
		        contentType: 'application/json',
		        beforeSend: function( xhr ) {
                    xhr.setRequestHeader("A4-Token", A4Token);
                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
                    xhr.setRequestHeader("A4-Data", A4Data);
                 }
			}).done(function(data) {

				if ((!data) || (data.length==0)) {
					$(jRespuesta).attr("style", cssStyle);
                    $(jRespuesta).html(iconoWarning + ' ' + mensajeServicio);
					return;
				}
				const response = data.response;
				const code = data.code;
				const message = data.message;

                if (code=="2") {
				    $(jRespuesta).html(response.parametro);
				    $(jRespuesta).html(generarHTMLTribunales(oTribunal, response.parametro));

				    mensajeInfo="<strong>Haga clic en el Horario ...</strong><br/>" + mensajeInfo;

				}
				if (code==="3") {
				    $(jRespuesta).attr("style", cssStyle);
				    var message001='No hay tribunales y/o turnos habilitados';
				    if (message==message001) {
				        responseMessage = 'Ya no podes inscribirte a esta Materia. <br/>La inscripción es hasta 48hs. hábiles antes del exámen.';
				    }

                    const htmlContent = `
                      <div style="display: flex; align-items: flex-start; color: #e74c3c; max-width: 400px; line-height: 1.5;">
                        ${iconoWarning}
                        <span>${responseMessage}</span>
                      </div>
                    `;
  				    $(jRespuesta).html(htmlContent);
				}

				
			}).fail(function(data) {
			  	$(jRespuesta).html(iconoWarning + ' ' + mensajeServicio);
			}).always(function(data) {
                var iconoEstadoTribunal = '<i class="fa-solid fa-check"></i>';
                var textoEstado = " Tribunales... ";
                $(jListaTribunal).html(textoEstado + iconoEstadoTribunal);
                $(jMensajeInfo).html(mensajeInfo);
				console.log("Siempre");
			});
		
		},
		inscribirAExamen : function(oTribunal, oMateria) {
			var jRespuesta = "body div#mensajeRespuetaInscripcionAExamen";

			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes");

			$.ajax({
				url : laUrl,
				type : 'POST',
		        dataType : 'json',
		        contentType: 'application/json',
		        data: JSON.stringify(oTribunal),
		        beforeSend: function( xhr ) {
                    xhr.setRequestHeader("A4-Token", A4Token);
                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
                    xhr.setRequestHeader("A4-Data", A4Data);
                 }
			}).done(function(data) {

				//$(jListaTribunal).hide();

				if ((!data) || (data.length==0)) {
					//ver que mensajes le ponemos aqui.
					$(jRespuesta).html("No se encontraron tribunales disponibles. Verificamos estado");

					//Autogestion.Peticion.estadoPeticionExamen(id);

					return;
				}
				var content = data.content;
				$(jRespuesta).append(content);

			}).fail(function(data) {
				$(jRespuesta).html("No se encontraron tribunales disponibles. Consulte (Online Ahora) <- ejecutamos xml");
			}).always(function(data) {
				console.log("Siempre");
			});
		},
		eliminarInscripcionAExamen : function(id) {
			var jListaTribunal = "a#listarTribunal"+id;
			$(jListaTribunal).attr('disabled','disabled');
			var jRespuesta = "body div#mensajeRespuetaInscripcionAExamen"+id;
			var jMensajeInfo = "body div#mensajeInfoInscripcionAExamen"+id;
			var jColapseTribunal = "#collapse"+id+ " div.panel-body";
			var iconoWarning = '<i class="fas fa-exclamation-circle"></i>';
			var cssStyle = 'font-size:20px;color:#e42e2e;';
			var mensajeInfo = 'Si estuviese faltando la regularidad a alguna materia dirigirse al <strong>Departamento al que pertenece dicha materia.</strong><br />Si estuviese faltando algún examen aprobado, dirigirse al <strong>Departamento Exámenes.</strong>';
            var mensajeServicio = "No se encuentra disponible el servicio.";
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/examenes/");
            var responseMessage = "";
		    var oTribunal = { "materia":id.split("-")[0], "especialidad":id.split("-")[1], "plan":id.split("-")[2]};
		    var idExamenCache = { "idExamenCache":id.split("-")[3] };

            laUrl = laUrl + "?idExamenCache="+idExamenCache;
			$.ajax({
				url : laUrl,
				type : 'DELETE',
		        dataType : 'json',
		        contentType: 'application/json',
		        data: JSON.stringify(oTribunal),
		        beforeSend: function( xhr ) {
                    xhr.setRequestHeader("A4-Token", A4Token);
                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
                    xhr.setRequestHeader("A4-Data", A4Data);
                 }
			}).done(function(data) {

				if ((!data) || (data.length==0)) {
					$(jRespuesta).attr("style", cssStyle);
                    $(jRespuesta).html(iconoWarning + ' ' + mensajeServicio);
					return;
				}
				const response = data.response;
				const code = data.code;
				const message = data.message;

                if (code=="2") {
				    $(jRespuesta).html(response.parametro);
				    $(jRespuesta).html(generarHTMLTribunales(oTribunal, response.parametro));

				    mensajeInfo="Haga clic en el Horario ...<br/>" + mensajeInfo;

				}
				if (code==="3") {
				    $(jRespuesta).attr("style", cssStyle);
				    var message001='No hay tribunales y/o turnos habilitados';
				    if (message==message001) {
				        responseMessage = 'Ya no podes inscribirte a esta Materia. La inscripción es hasta 48 hs hábiles antes del Exámen';
				    }

				    $(jRespuesta).html(iconoWarning + ' ' + responseMessage);
				}


			}).fail(function(data) {
				$(jRespuesta).html("No se encontraron tribunales disponibles. Consulte (Online Ahora) <- ejecutamos xml");
			}).always(function(data) {
                var iconoEstadoTribunal = '<i class="fa-solid fa-check"></i>';
                var textoEstado = " Tribunales... ";
                $(jListaTribunal).html(textoEstado + iconoEstadoTribunal);
                $(jMensajeInfo).html(mensajeInfo);
				console.log("Siempre");
			});

		},
		htmlHabilitarAcceso : function (estado) {

			if (estado==1) {
				$(".botonAccesoInscripcionCursado").find("i").remove();
				$('.botonAccesoInscripcionCursado').removeClass("btn-danger");
				$('.botonAccesoInscripcionCursado').removeClass("disabled");
				$('.botonAccesoInscripcionCursado').addClass("btn-success");
				$('.botonAccesoInscripcionCursado').html('<i class="fa fa-check"></i> Ingresar al Sistema');	
			} else {
				
			}
		},
		inscripcionACursadoIngresantes : function(tipo, turno) {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/cursado/ingresantes");

			var textoTurnoSeleccionado = "";
			var turnoSeleccionado = "";	
			if (turno) { turnoSeleccionado = turno };
			
			if (turnoSeleccionado=="M") { textoTurnoSeleccionado = "Mañana";}				
			if (turnoSeleccionado=="T") { textoTurnoSeleccionado = "Tarde";}
			if (turnoSeleccionado=="N") { textoTurnoSeleccionado = "Noche";}
			var descripcionMensajeSeleccion = "Estas seguro que deseas inscribirte en el turno <b>" + textoTurnoSeleccionado + "</b>";
			
			var laUrl = laUrl + "/" + turnoSeleccionado;
			
			abrirModalGeneral("Selección de Inscripción", descripcionMensajeSeleccion,true,true,1, function(i) {				
				
				$.ajax({
					url : laUrl,
					type : tipo,				
	                beforeSend: function( xhr ) {
	                    xhr.setRequestHeader("A4-Token", A4Token);
	                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                    xhr.setRequestHeader("A4-Data", A4Data);
	                 },	
	                dataType : 'json',				
				}).done(function(data) {
						
					var salida = data.value;
					
					if (salida==null) { return;}								
					
					if (tipo=="POST") {
						var estadoInscripcionIngresante = salida.split('|')[0];
						var mensajeInscripcionIngresante = salida.split('|')[1];

						if (estadoInscripcionIngresante==0) {
							var elIdSeleccionado = "#box"+turnoSeleccionado;
							$(elIdSeleccionado).removeClass().addClass("small-box bg-gray");
							$(elIdSeleccionado).find("p").html(mensajeInscripcionIngresante);
							$(elIdSeleccionado).find("a").html("&nbsp;");

						} else {
							$("#rowInscripcionIngresantes div").remove();
							$("#rowInscripcionIngresantes").html("<div class='row'><div class='col-lg-12 col-xs-12'><div class='small-box bg-green'><div class='inner'><h3>Tu inscripción</h3><p>" + mensajeInscripcionIngresante + "</p></div></div></div></div>");
													
						}
						
						$('#dialogoGeneral').modal('hide');
						
					}
					
										

					if (tipo=="GET") {
						var estadoInscripcionIngresante = salida.split('|')[0];
						var mensajeInscripcionIngresante = salida.split('|')[1];

						if (estadoInscripcionIngresante==0) {

						} else {
							$(".boxInscripcionIngresantes").each(function( index ) {
								$(this).removeClass().addClass("small-box bg-gray");
								var elId = $(this).attr("id");
								var idFinal = elId.trim().replace("box","");// boxt1
								if (turnoSeleccionado == idFinal) {
									var elIdSeleccionado = "#"+elId;
									$(elIdSeleccionado).removeClass("bg-gray").addClass("bg-green");
									$(elIdSeleccionado).find("p").html(laInfo);
									$(elIdSeleccionado).find("a").html("&nbsp;");
									
									$("body").off("click",".boxInscripcionIngresantes");
								}
							});
						}
					}				
			}, function(i) {
				$('#dialogoGeneral').modal('hide');
				return;								
			});			
				
			}).always(function(data) {
				
			});
		},
		
		inscripcionACursadoCuatrimestre : function(tipo, cuatrimestre) {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/cursado/cuatrimestre");

			var textoCuatrimesteSeleccionado  = "";
							
			if (cuatrimestre) { textoCuatrimesteSeleccionado  = cuatrimestre };
			
			var descripcionMensajeSeleccion = "Estas seguro que deseas inscribirte en el <b>" + textoCuatrimesteSeleccionado + "do. cuatrimestre</b>";
			
			var laUrl = laUrl + "/" + cuatrimestre;
			
			abrirModalGeneral("Selección de Inscripción", descripcionMensajeSeleccion,true,true,1, function(i) {				
				
				$.ajax({
					url : laUrl,
					type : tipo,				
	                beforeSend: function( xhr ) {
	                    xhr.setRequestHeader("A4-Token", A4Token);
	                    xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
	                    xhr.setRequestHeader("A4-Data", A4Data);
	                 },	
	                dataType : 'json',				
				}).done(function(data) {
						
					var salida = data.value;
					
					if (salida==null) { return;}								

					if (tipo=="POST") {
						var estadoInscripcionIngresante = salida.split('|')[0];
						var mensajeInscripcionIngresante = salida.split('|')[1];

						if (estadoInscripcionIngresante==0) {
							var elIdSeleccionado = "#boxInscripcionCursadoCuatrimestre";
							$(elIdSeleccionado).removeClass().addClass("small-box bg-red");
							$(elIdSeleccionado).find("p").html(mensajeInscripcionIngresante);
							$(elIdSeleccionado).find("a").html("&nbsp;");
						} else {
							$("#rowInscripcionCursadoCuatrimestre").find("div").remove();
							$("#rowInscripcionCursadoCuatrimestre").html("<div class='row'><div class='col-lg-12 col-xs-12'><div class='small-box bg-green'><div class='inner'><h3>Tu inscripción</h3><p>" + mensajeInscripcionIngresante + "</p></div></div></div></div>");
						}
						
						$('#dialogoGeneral').modal('hide');
						
					}													

					if (tipo=="GET") {
						var estadoInscripcionIngresante = salida.split('|')[0];
						var mensajeInscripcionIngresante = salida.split('|')[1];

						if (estadoInscripcionIngresante==0) {

						} else {
							$( ".boxInscripcionIngresantes" ).each(function( index ) {
								$(this).removeClass().addClass("small-box bg-gray");
								var elId = $(this).attr("id");
								var idFinal = elId.trim().replace("box","");// boxt1
								if (turnoSeleccionado == idFinal) {
									var elIdSeleccionado = "#"+elId;
									$(elIdSeleccionado).removeClass("bg-gray").addClass("bg-green");
									$(elIdSeleccionado).find("p").html(laInfo);
									$(elIdSeleccionado).find("a").html("&nbsp;");
									
									$("body").off("click",".boxInscripcionIngresantes");
								}
							});
						}
							
					}				
				
				
				
			}, function(i) {
				$('#dialogoGeneral').modal('hide');
				return;				
				
			});
			
				
			}).always(function(data) {
				
			});
		}, 



		inicializarInscripcionACursado : function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("transacciones/inscripcion/cursado/init");
			
			$.ajax({
				url : laUrl,
				type : 'POST',
				data : "idPeticion=" + getIdPeticion(),
			}).done(function(data) {
				var cache = data.split('|')[0];
				var init = data.split('|')[1];
				var newIdPeticion = data.split('|')[2];

				if (typeof newIdPeticion!==undefined) {
				    setIdPeticion(newIdPeticion);
				}
                // ver de controlar el 0
                if (cache==0) {
                    pingEstadoPeticion(5000);
                }
				if (cache==1) {
					hayTransaccionEjecutada = 1;
					
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);
					
					$("body").off("click","#ayudaInscripcion");
					
					$('.cambioEstadoInscripcion').removeClass('bg-purple');
					$('.cambioEstadoInscripcion').addClass('bg-green');	
					$('#ayudaInscripcion').removeClass('bg-red');
					$('#ayudaInscripcion').addClass('bg-green');
					$('#ayudaInscripcion').html('<i class="fa fa-check"></i> Ingresar al Sistema');
					$('#ayudaInscripcion').attr('href','/4/tramite/inscripcion/cursado/');

				}
				if (cache==2) {
				    console.log("es 2 ", data);

					hayTransaccionEjecutada = 1;

					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);

					$("body").off("click","#ayudaInscripcion");

					$('.cambioEstadoInscripcion').removeClass('bg-purple');
					$('.cambioEstadoInscripcion').addClass('bg-green');
					$('#ayudaInscripcion').removeClass('bg-red');
					$('#ayudaInscripcion').addClass('bg-green');
					$('#ayudaInscripcion').html('<i class="fa fa-check"></i> Ingresar al Sistema');
					$('#ayudaInscripcion').attr('href','/4/tramite/inscripcion/cursado/');
				}
				if (cache==3) {
					console.log("es 3 ", data);
					pingEstadoPeticion(5000);

				}
				
			}).always(function(data) {
				console.log("always init");
			});
		}, 
		estado: function() {
			var ajaxTime = new Date().getTime();
			var config = this.configuracion();
			
			var laUrl = config.urlCompleta("transacciones/estado");
			$.ajax({
				url : laUrl,
				type : 'POST',
				dataType : 'json',
				data : "idPeticion=" + getIdPeticion(),
			}).done(function(data) {

			    //peticion.estadoCacheInscripcionCursado();

				var estado = data.valor;
				var salida = data.salida;
				
				var totalTime = new Date().getTime()-ajaxTime;
								
				if (estado==0 || estado==1) {
					console.log("transaccionando: ", estado);
				}
				if (estado==2) {
					console.log("completado: ", estado);
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);
					
					$.ajax({
						url : config.urlCompleta("transacciones/inscripcion/cursado/cache"),
						type : 'POST',
						data : "idPeticion=" + getIdPeticion(),
					}).done(function(data) {

						$("body").off("click","#ayudaInscripcion");
						
						$('.cambioEstadoInscripcion').removeClass('bg-purple');
						$('.cambioEstadoInscripcion').addClass('bg-green');	
						$('#ayudaInscripcion').removeClass('bg-red');
						$('#ayudaInscripcion').addClass('bg-green');
						$('#ayudaInscripcion').html('<i class="fa fa-check"></i> Ingresar al Sistema');
						$('#ayudaInscripcion').attr('href','/4/tramite/inscripcion/cursado/');

						hayTransaccionEjecutada = 0;
						
					}).always(function(data) {

					});
					
				}
				if (estado==3) {
					console.log("Error: ",estado);
					
					if (salida.indexOf("No está matriculado")!=-1) {
						$.ajax({
							url : config.urlCompleta("academico/matricula"),
							type : 'POST',
							dataType : 'json',
						}).done(function(data) {
							var estadoMatricula = data.value;

							var splitData = estadoMatricula.split("|");
							var estadoData = splitData[0];
							var valorData = splitData[1];
							if (estadoData==1) {
								$("body").off("click","#ayudaInscripcion");
								
								$('.cambioEstadoInscripcion').removeClass('bg-purple');
								$('.cambioEstadoInscripcion').addClass('bg-green');	
								$('#ayudaInscripcion').removeClass('bg-red');
								$('#ayudaInscripcion').addClass('bg-green');
								$('#ayudaInscripcion').html('<i class="fa fa-check"></i> Ingresar al Sistema');
								$('#ayudaInscripcion').attr('href','/4/tramite/inscripcion/cursado/');
/*								
								$(".botonAccesoInscripcionCursado").find("i").remove();
								$('.botonAccesoInscripcionCursado').removeClass("btn-danger");
								$('.botonAccesoInscripcionCursado').removeClass("disabled");
								$('.botonAccesoInscripcionCursado').addClass("btn-success");
								$('.botonAccesoInscripcionCursado').html('<i class="fa fa-check"></i> Ingresar al Sistema');
								*/				
							} else {
								$('#ayudaInscripcion').addClass('bg-red');
								$('#ayudaInscripcion').html('<i class="fa fa-ban"></i> Inhabilitado :-(');
								notificar('danger', salida, 9000);
								setPingTimeEstadoPeticion(0);
								clearTimeout(pingEstadoPeticion);

							}

						}).fail(function(data) {				
							$('#ayudaInscripcion').addClass('bg-red');
							$('#ayudaInscripcion').html('<i class="fa fa-ban"></i> Inhabilitado :-(');
							notificar('danger', salida, 9000);
							setPingTimeEstadoPeticion(0);
							clearTimeout(pingEstadoPeticion);
							
						}).always(function(data) {
							
						});	

						setPingTimeEstadoPeticion(0);
						clearTimeout(pingEstadoPeticion);

						return;
					} 
					
					$("body").off("click","#ayudaInscripcion");
					
					//$('.cambioEstadoInscripcion').removeClass('bg-purple');
					//$('.cambioEstadoInscripcion').removeClass('bg-green');	
					//$('#ayudaInscripcion').removeClass('bg-red');
					$('#ayudaInscripcion').addClass('bg-red');
					$('#ayudaInscripcion').html('<i class="fa fa-ban"></i> Inhabilitado :-(');
					notificar('danger', salida, 9000);
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);

					
				}
				
			}).always(function(data) {
			    console.log("always: ", data);

			});		
		},
		estadoCacheInscripcionCursado: function() {
			var ajaxTime = new Date().getTime();
			var config = this.configuracion();

			var laUrl = config.urlCompleta("transacciones/estado/cache");
			$.ajax({
				url : laUrl,
				type : 'POST',
				dataType : 'json'
			}).done(function(data) {
                console.log("done data: ", data);
			}).always(function(data) {
                console.log("always: ", data);
			});
		},
		estadoPeticionExamen: function(id) {
			var ajaxTime = new Date().getTime();
			var config = this.configuracion();
			
			var laUrl = config.urlCompleta("transacciones/estado");
			$.ajax({
				url : laUrl,
				type : 'POST',
				dataType : 'json',
				data : "idPeticion=" + getIdPeticion(),
			}).done(function(data) {

				var estado = data.valor;
				var salida = data.salida;
				
				var totalTime = new Date().getTime()-ajaxTime;
								
				if (estado==0 || estado==1) {
					console.log("transaccionando");
					pingEstadoPeticionExamen(id, 5000);
				}
				
				if (estado==2) {
					console.log("completado");
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticionExamen);									
				}
				
				if (estado==3) {
					console.log("muestra error");
					var jid = "#mensajeRespuetaInscripcionAExamen"+id; 
					$(jid).html('<h2 class="bg-red">'+salida+'</h2>');
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticionExamen);
				}
				
			}).always(function(data) {
				
			});		
		},				
						
	},// fin Objeto Misc
	Ingresantes : {
		configuracion : function() {
			return Autogestion.Configuracion;
		},
		fechaNotas: function() {
			var config = this.configuracion();
			var laUrl = config.urlCompleta("aspirante/fechas");
			
			$.getJSON(laUrl, {}, function(data) {
				var items = [];
				$.each(data,function(key, val) {
					var idCursillo = val.id;
					var descripcion = val.nombre;
					var fecha = val.valor;
				
					items.push('<li data-id="' + idCursillo + '"><a href="#" data-toggle="tooltip">' + descripcion + '</a></li>');				
								
				});
/**/
				var cantidad = 0;
				cantidad = $("#listaFechasNotasIngresantes li").size();
				if (cantidad > 0) {
					$("#listaFechasNotasIngresantes").remove();
				}
				
				$("#listaFechasNotasIngresantes").append(items.join(''));
				

			}).fail(function() {
				console.log("failed");
			});			
			
		},
		consultarNotas: function(idCursillo) {
			var config = this.configuracion();

			if (typeof idCursillo === "undefined") {
				console.log("idCursillo : " + idCursillo + " : " + getMail());
				return;
			}
			
			var laUrl = config.urlCompleta("aspirante/nota/")+idCursillo;

			var mensajeFinalNota = "";
			
			$.getJSON(laUrl, {}, function(data) {
				var items = [];
				
				if (data!=null) {
					$.each(data,function(key, val) {
						var valor  = ""; 
						if (val!=null) {
							valor = val.valor;
						} else {
							valor = "";
						}
						
						mensajeFinalNota = valor;
									
					});					
				} else {
					mensajeFinalNota = "No existe aún una nota disponible cargada."
					
				}

			}).fail(function() {
				mensajeFinalNota = "Servicio no disponible en estos momentos. Intente nuevamente. más tarde. Gracias!"				
			}).always(function(data) {

				$("#mensajeFinalNotasIngresantes").html("")
				$("#mensajeFinalNotasIngresantes").html(mensajeFinalNota);				
				
			});				
		},
	},// fin Objeto Misc
	/**/
}; // FIN DEFINICION OBJETO AutoGestion

function mostrarNotificacion(data) {
	var tipo = 'nada';
	
	$(data).find('respuestaRetorno').each(function() {
		tipo = $(this).find('codigo').text();
		var mensajeResultado = $(this).find('mensaje').text();
		var valor = $(this).find('valor').text();
		
		notificar(tipo, mensajeResultado);
	});
	
	return tipo; 
	
}

function notificar(tipo, mensaje, tiempo) {
	var tipoIcono = '';
	var titulo = '';
	var tiempoDelay = 1500;
	
	if (tiempo) { tiempoDelay = tiempo; } 

	if (tipo == 'success') {
		titulo = 'Bien! ';
		tipoIcono = 'fa fa-check'
	}
	if (tipo == 'danger') {
		titulo = 'Error ';
		tipoIcono = 'fa fa-ban'
	}
	if (tipo == 'warning') {
		titulo = 'Advertencia ';
		tipoIcono = 'fa fa-warning'
	}
	if (tipo == 'info') {
		titulo = 'Info ';
		tipoIcono = 'fa fa-info'
	}
	$.notify({
		icon:tipoIcono,
		title:'',
		message:mensaje,
		},{
			element: 'body',
			newest_on_top : true, 
		showProgressbar : false, 
		offset: {
			x: 14,
			y: 60,
		},
		delay : tiempoDelay,
		mouse_over : 'pause',
		z_index: 9999,
		type:tipo,
		animate : {
			enter : 'animated fadeInDown',
			exit : 'animated fadeOutUp'
		}
	});
}

var usuario = Autogestion.Usuario;

usuario.preferencias();

if (getTipoUsuario()=="A" || getTipoUsuario()=="I") {
	usuario.estaFidelizado();
}

var configuracion = Autogestion.Configuracion;
configuracion.menu();

//var favorito = Autogestion.Favorito;
//favorito.listar();

//revisar con ingresantes 
var grupo = Autogestion.Grupo;
grupo.listar();

var contacto = Autogestion.Contacto;
contacto.listar();

var mensaje = Autogestion.Mensaje;
//mensaje.listarTotales();

//revisar con ingresantes 
mensaje.listarAcademicos();

var calendario = Autogestion.Calendario;
calendario.listar();

var archivo = Autogestion.Archivo;

var biblioteca = Autogestion.Biblioteca;

var ayuda = Autogestion.Ayuda;

var bitacora = Autogestion.Bitacora;

var materias;

if (getTipoUsuario()=="A" || getTipoUsuario()=="I") {
	fotoAcademica();
	materias = Autogestion.Cursado;
	materias.actual(anioActual);
}


if (getTipoUsuario()=="D") {
	materias = Autogestion.Dictado;
	materias.actual(anioActual,"tieneComisiones");
}

var ingresantes;

if (getTipoUsuario()=="I") {
	ingresantes = Autogestion.Ingresantes;
	ingresantes.fechaNotas();
}

var academico = Autogestion.Academico;

var sugerencia = Autogestion.Sugerencia;

var peticion = Autogestion.Peticion;

var servicio = Autogestion.Servicio;

var arancel = Autogestion.Arancel;

if (getTipoUsuario()=="A" || getTipoUsuario()=="I") {
	servicio.estadoAutorizacionBoleto();
	servicio.devolverMensajes();
}

var onlineUsersThisServer = parseInt(onlineUsers);

if (isNaN(onlineUsersThisServer)) { onlineUsersThisServer = 0 };

if (onlineUsersThisServer>limiteRetrasarCargaTimelinePrincipal) {
	retrasarCargaTimelinePrincipal = retrasarCargaTimelinePrincipalInscripciones;
} else {
	retrasarCargaTimelinePrincipal = retrasarCargaTimelinePrincipalTodos;
}
mensaje.listar(retrasarCargaTimelinePrincipal);

var uploadObj = $(".subirFoto").uploadFile(settings);
var uploadDocente = $(".subirMaterial").uploadFile(settingsDocente);
//var uploadTramite = $(".subirTramite").uploadFile(settingsTramite);

var establecerPreferencias = function() {
	var preferenciasEnCache = cache.get("preferencias");
	
	if (preferenciasEnCache) {
		/**/
		usuario.preferencia(5, function(valor) { 
			$(".fotoPerfilUsuario").attr("src", urlFotoPerfil(valor));
		});
		/**/
		usuario.preferencia(9, function(valor) {
			var losTerminos = valor;
			if (losTerminos != 1) { abrirModalGeneral('<i class="fa fa-info"></i> Términos y Condiciones de Uso','<div style="font-size:100%; padding: 0.3em;">  <p><strong>La AUTOGESTION 4 se encuentra en actualizaci&oacute;n constante, la informaci&oacute;n acad&eacute;mica brindada es as&iacute;ncrona con la real </strong></p><strong>Parte de nuestra misión es</strong>:<ul><li> <b>Brindar</b> una herramienta como medio de comunicaci&oacute;n entre los alumnos, docentes y areas de Nuestra Facultad.</li><li> <b>Aportar</b> el soporte sobre el &aacute;rea tecnol&oacute;gica en base a las decisiones tomas por las distintas Areas de la Universidad.</li></ul><p><br><b>Usted es libre de</b>:</p><ul><li><b>Usar los recursos</b> de la Autogesti&oacute;n de acuerdo a los estatutos de la Universidad Tecnol&oacute;gica Nacional.</li><li><b>Contribuir </b> con informaci&oacute;n publicando mensaje a los alumnos y docentes de Nuestra Facultad.</li></ul><p><br><b>Bajo las siguientes condiciones</b>:</p><ul>  <li> <b>Responsabilidad</b> &mdash; Usted es responsable de sus publicaciones (en tanto que nosotros sólo <b>alojamos</b> su contenido).</li>  <li> <b>Urbanidad</b> &mdash; Usted apoyará un entorno cívico y universitario y no hostigará ni atacará a otros alumnos, docentes &oacute; &aacute;reas de la Universidad.</li>  <li> <b>Comportamiento legal</b> &mdash; Usted no infringirá las leyes ni los estatutos de la Universidad..</li>  <li> <b>No daños</b> &mdash; Usted no dañará nuestra infraestructura tecnológica.</li><li> <b>Términos y condiciones de uso y políticas</b> &mdash; Usted adhiere a los siguientes Términos y condiciones y a las políticas de la comunidad aplicables cuando usted visita nuestros sitios o participa en nuestras comunidades.</li></ul><p><br><b>Con el entendimiento de que</b>:</p><ul>  <li>En la <strong>Autogesti&oacute;n 4 </strong> &mdash; el contenido de los mensajes, grupos y acciones que se realicen, estar&aacute;n sujetos a auditor&iacute;as.</li>    <li><strong>Inconvenientes </strong> &mdash; es este sistema pueden ocurrir cambios imprevistos.<br />Si encontr&aacute;s detalles t&eacute;cnicos, por favor, informalos con un DM <a href="https://twitter.com/Autogestion4">en el enlace</a>, gracias! </li></ul></div>',true,true,1,function(e) { usuario.actualizarPreferencia(9,1);$('#dialogoGeneral').modal('hide');}, function(e) { $("html").empty();window.location.href=urlLogoutSSLUTNFRC; },{backdrop: 'static',keyboard: false},true);}	
		});
	} else {		
		setTimeout(function () {
			establecerPreferencias();
		}, 2000);	
	}
	var _imagenPerfil = '';
	_imagenPerfil = $(".fotoPerfilUsuario").attr("src");
	if (_imagenPerfil!=null) {							
		if (usuarioPublicoFotoPerfil(_imagenPerfil)) {
			if (!$("#quitarPreferencia")) {
					$(".subirFoto").after('<span class="text-danger" title="Quitar" id="quitarPreferencia">×</span>');
			}	
		}		
	}	
};
establecerPreferencias();

var ping = function () {
	if (estadoModuloMensajesNuevo==0) { return;}
	mensaje.listarNuevos();
	var pingTime = getPingTimeListarNuevos(); 
	if (pingTime==0) {
		return;
	}
    setTimeout(function () {
    	ping();
    }, pingTime);	
};
ping();

var pingEstadoPeticion = function (delayFirst) {
	var pingTime = getPingTimeEstadoPeticion(); 

	if (delayFirst) {
		pingTime  = delayFirst;
	} else {
		pingTime = getPingTimeEstadoPeticion();
	}
	
	if (pingTime==0) {
		return;
	}
	peticion.estado(getIdPeticion());

	setTimeout(function () { pingEstadoPeticion(); }, pingTime);	
};

var pingEstadoCacheInscripcionCursado = function (delayFirst) {
	var pingTime = getPingTimeEstadoPeticion();

	if (delayFirst) {
		pingTime  = delayFirst;
	} else {
		pingTime = getPingTimeEstadoPeticion();
	}

	if (pingTime==0) {
		return;
	}
	peticion.estadoCacheInscripcionCursado();

	setTimeout(function () { pingEstadoCacheInscripcionCursado(); }, pingTime);
};

var pingEstadoPeticionExamen = function (id, delayFirst) {
	var pingTime = getPingTimeEstadoPeticion(); 

	if (delayFirst) {
		pingTime  = delayFirst;
	} else {
		pingTime = getPingTimeEstadoPeticion();
	}
	
	if (pingTime==0) {
		return;
	}
	
	peticion.estadoPeticionExamen(id, delayFirst);

	setTimeout(function () { pingEstadoPeticionExamen(id, delayFirst); }, pingTime);	
};


var agregarTopBar = function(barra) {
	$(".messages-menu").before(barra);	
};

var verContenedorFavoritos = function() {
	
	if (preferenciaBarraFavorito=="1") {
		var listaFavoritos = $("#listaFavoritos").clone();
		var items = [];
		
		$( "#listaFavoritos li" ).each(function( index ) {
			var elA = $( this ).find("a");
	
			items.push('<li id="'+$( this ).attr("id")+'"><a href="'+elA.attr("href")+'" id="'+elA.attr("id")+'">'+elA.text()+'</a></li>');			
	
			});	
		
		var listaFavoritosHtmlFinal = items.join('');
		
		var listaFavoritosSize = $("#listaFavoritos li :not(.itemVacio)").size();
		var barra = '<li class="dropdown favoritos-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-heart"></i><span class="label label-success">'+listaFavoritosSize+'</span></a><ul class="dropdown-menu">'+listaFavoritosHtmlFinal+' </ul></li>';
		
		agregarTopBar(barra);
		
		$("#btnQuitarFavoritos").trigger('click');
	}
};


$(document).ready(function() {

	Ladda.bind('.formAgregarMensaje button', {
		timeout : 2000
	});
	
	//$.fn.popover.defaults.container = 'body';	
	$.fn.editable.defaults.mode = 'inline';
	$.fn.editable.defaults.ajaxOptions = {
		type : "PUT"
	};
	/*
	if (getTipoUsuario()=='A') {
	  $('.panel-collapse').on('show.bs.collapse', function () {
        $(this).siblings('.panel-heading').addClass('active');
      });
     
      $('.panel-collapse').on('hide.bs.collapse', function () {
        $(this).siblings('.panel-heading').removeClass('active');
      });
	}
	*/

	var tour = new Tour({
		placement : 'top',
		keyboard : true,
		template : "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title' style='font-weight: bold;'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-default' data-role='prev'>« Anterior</button><span data-role='separator'>|</span><button class='btn btn-default' data-role='next'>Siguiente »</button><button class='btn btn-default' data-role='end'>Fin</button></div></nav></div>"
	});

	tour.addSteps([ {
		element : ".sidebar",
		title : "Menu Principal",
		backdrop : true,
		backdropPadding : 20,
		placement : "right",
		content : "Accede a todas tus opciones desde el menu principal de tu Autogestión 4."
	},{
		element : ".formAgregarMensaje",
		title : "Publicar Mensajes",
		backdrop : true,
		backdropPadding : 20,
		placement : "bottom",
		content : "Desde tu Autogestión 4 vas a poder publicar mensajes a tus contactos autorizados, grupos propios y académicos con un simple click. <a href='http://autogestion.frc.utn.edu.ar/#portfolio'>más info</a>"
	}, {
		element : "#timelinePrincipal",
		title : "Linea de Tiempo",
		backdrop : true,
		backdropPadding : 20,
		placement : "right",
		content : "El timeline visualiza todos tus mensajes, de manera cronológica. Se puede ver los mensajes de docentes, documentos publicados, la calendarización de actividades, las novedades relacionadas a tus grupos academicos y propios.<a href='http://autogestion.frc.utn.edu.ar/#portfolio'>más info</a>"
	}, {
		element : "#contenedorMensajesAcademicos",
		title : "Mensajes Académicos",
		backdrop : true,
		backdropPadding : 20,
		placement : "left",
		content : " Vas a ver tu estado académico de una manera más simple y sencilla."
	}, {
		element : "#contenedorGrupos",
		title : "Mis Grupos",
		backdrop : true,
		placement : "left",
		content : "La Autogestión 4 introduce el concepto de Grupos. Cuando te inscribas a una materia, se te creará un nuevo Grupo-Académico, el cual el docente podra usar para comunicarse con todos contigo y los alumnos integrantes de la materia; los alumnos también podran comunicarse con todos los alumnos para elevar consultas a su curso. Como usuario de la Autogestión 4, podrás también crear Grupos-Propios, y en los cuales podrás agregar a todos tus contactos autorizados."
	}, {
		element : "#contenedorContactos",
		title : "Mis Contactos",
		backdrop : true,
		placement : "left",
		content : "La Autogestión 4 introduce el concepto de Contactos. Tus contactos son todas las personas de la comunidad FRC que esten autorizadas a vos y a las cuales les podrás enviar mensajes, crear grupos y gestionar eventos. "
	}, {
		element : "#contenedorFavoritos",
		title : "Mis Favoritos",
		backdrop : true,
		backdropPadding : 20,
		placement : "left",
		content : "Desde tus Favoritos podrás acceder a tus enlaces y características mas utilizadas de tu Autogestión 4. Recordá agregar tus favoritos con el ícono del corazón!"
	}, {
		element : "#contenedorBiblioteca",
		title : "Mi Biblioteca",
		backdrop : true,
		backdropPadding : 20,
		placement : "left",
		content : "Vas a tener el top 5 de libros recomendados por tu docente y los que más solicitaron los alumnos dentro de tu especialidad y carrera. También podrás sugerir libros que hayas solicitados y realizar las reservas de los mismos. "
	}, {
		element : "#contenedorCalendario",
		title : "Mi Calendario",
		backdrop : true,
		backdropPadding : 20,
		placement : "left",
		content : "Con la Autogestión 4 vas a poder gestionar tus eventos académicos y personales a través del Calendario y el Timeline. "
	} ]);

	//tour.start();
	
	autosize($('textarea'));

	$('.task-menu ul.dropdown-menu').click(function(e) {
	    e.stopPropagation();
	});	
	
	$(".startTour").click(function() {
		tour.restart();
	});

	$("#enviarSugerencia").click(function(e) {
		e.preventDefault();
		var texto = $("#textoSugerencia").val();
		sugerencia.enviar(texto);
	});

	$("body").on("click", "#btnFidelizarMail", function (e) {
		e.preventDefault();
		
		if (!$("#btnFidelizarMail").attr("disabled")) {
			var mail = $("#mailAFidelizar").html();
			usuario.fidelizarMail(mail);			
		}
	});
	
	$("body").on("click", "#indicadorFidelizacionMail", function (e) {
		e.preventDefault();
		
		usuario.estaFidelizado();
	});

	$("body").on("click", "#btnInscripcionExamen", function (e) {
		e.preventDefault();
		
		Autogestion.Peticion.listarMateriasInscripcionAExamen("puede",false);
	});

	$("body").on("click", "#btnListarMateriasExamen", function (e) {
		e.preventDefault();
		Autogestion.Peticion.listarMateriasInscripcionAExamen("nopuede", true);
	});

	$("body").on("click", "#btnMensajeInscripcionExamen", function (e) {
		e.preventDefault();
		Autogestion.Peticion.mensajeInscripcionAExamen();
	});	

	$("body").on("click", ".btnImprimirInscripcionExamen", function (e) {
		e.preventDefault();

		var idx= $(this).attr("data-id");
		console.log(idx);
		
		Autogestion.Peticion.inscripcionAExamenCache();
	});
	
	$("body").on("click", ".btnEliminarInscripcionExamen", function (e) {
		e.preventDefault();
		
		var id = $(this).attr("id");
		var dataId = $(this).attr("data-id");

        var iconoSpinner = '<i class="fa-solid fa-spinner fa-spin-pulse"></i>';
        var textoEstado = " Eliminando examen ";
        //$(this).html(textoEstado + iconoSpinner);

		Autogestion.Peticion.eliminarInscripcionAExamen(dataId);
	});

	$("body").on("click", ".btnListarTribunal", function (e) {
		e.preventDefault();
		
		var id = $(this).attr("id");
		var dataId = $(this).attr("data-id");

        var iconoSpinner = '<i class="fa-solid fa-spinner fa-spin-pulse"></i>';
        var textoEstado = " Listando tribunales ";
        $(this).html(textoEstado + iconoSpinner);

		Autogestion.Peticion.listarExamenTribunal(dataId);
	});
	
	$("body").on("click", ".btnInscribirAExamen", function (e) {
		e.preventDefault();
		
		var oTribunal = JSON.parse($(this).attr("data-id"));
		var containerDiv = $(this).closest('.container').parent();
        var oMateria = containerDiv.data("id");

		Autogestion.Peticion.inscribirAExamen(oTribunal, oMateria);
	});


	$('body').on('click', 'a.checked',function(e) {
		e.preventDefault();
		
		var legajo = $(this).attr("id");
		var texto = $(this).text();		

		
		var fecha = $("#fechaActual").html().trim();
		var codigo = $("#idCursoSeleccionado").html().trim();

		Autogestion.Asistencia.registrar(legajo,codigo,fecha);
		
	});
	
	$('body').on('click', 'a.unchecked',function(e) {
		e.preventDefault();
		
		var legajo = $(this).attr("id");
		var texto = $(this).text();		

		var fecha = $("#fechaActual").html().trim();
		var codigo = $("#idCursoSeleccionado").html().trim();

		Autogestion.Asistencia.quitar(legajo,codigo,fecha);
		
	});

	$('body').on('click', 'a.curso',function(e) {
		e.preventDefault();
		
		var codigo = $(this).attr("id");
		var texto = $(this).text();
			
		$("#textoEncabezado").html("");
		$("#textoEncabezado").html(texto);
		
		Autogestion.Asistencia.listarComision(codigo);
		
	});

	$('body').on('click', 'a.comision',function(e) {
		e.preventDefault();
		
		var codigo = $(this).attr("id");
		var texto = $(this).text();
		
		$("#textoEncabezado").html("");
		$("#textoEncabezado").html(texto);
		
		var fecha = $("#fechaActual").html().trim();
		
		$("#idCursoSeleccionado").html(codigo);
		
		Autogestion.Asistencia.listarAlumnos(codigo,fecha);
		
	});

	$('body').on('click', 'a.externo',function(e) {
		e.preventDefault();
			
		var enlace = ($(this).attr("href"));//.toLowerCase();
		var tipo = $(this).data("local")
		var idTramite = $(this).data("idtramite")
		if(tipo && tipo =="S")
			abrirModalV4(enlace);
		else
			abrirModalV3(enlace);		
	});
	
	
	$("#e400").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase();
		armarTabla(idMarcador, enlace, $(this));
	});
	
	$("#e500").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase();
		armarTabla(idMarcador, enlace, $(this));
	});

	$("#e1000").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();

		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase() + '?a' + randomNumber;
		armarTabla(idMarcador, enlace, $(this));
		
		return false;
	});
	
	$("#e2000").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase() + '?a' + randomNumber;

		armarTabla(idMarcador, enlace, $(this));
		
		if (hasSelectedInputCheckbox("#grilla2000","id")) {
			$("#btnPagar").removeAttr("disabled");
		} else {
			$("#btnPagar").attr("disabled","disabled");
		}
		
		return false;
	});
	
	$("#e2001").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase() + '?a' + randomNumber;
		armarTabla(idMarcador, enlace, $(this));

		return false;
	});
	
	
	$("#e2002").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase() + '?a' + randomNumber;

		armarTabla(idMarcador, enlace, $(this));

		return false;
	});

	$("#e2003").on('click', function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = _idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase() + '?a' + randomNumber;

		armarTabla(idMarcador, enlace, $(this));
		
		if (hasSelectedInputCheckbox("#grilla2003","id")) {
			$("#btnPagarMatricula").removeAttr("disabled");
		} else {
			$("#btnPagarMatricula").attr("disabled","disabled");
		}
		
		return false;
	});
		
	function countSelectedInputCheckbox(mainId, idAttributeToFind) {
		var selected = [];
		var id = mainId + " input[type=checkbox]";
		var c=0;
		$(id).each(function() {
   			if ($(this).is(":checked")) {
       			selected.push($(this).attr(idAttributeToFind));
       			c++;
       		}
   		});
   		
   		return selected;
	} 
	
	function hasSelectedInputCheckbox(mainId, idAttributeToFind) {
		return (countSelectedInputCheckbox(mainId, idAttributeToFind).length!=0) ? true : false;
	} 
	
	$('body').on('change', '#grilla2000 input[type=checkbox]',function(e) {
		
		var checkboxes = $('#grilla2000 input[type="checkbox"]');
        var index = checkboxes.index(this);
        
        if (this.checked) {
          checkboxes.slice(0, index).prop('checked', true);
        } else {
          checkboxes.slice(index + 1).prop('checked', false);
        }
		
		if (hasSelectedInputCheckbox("#grilla2000","id")) {
			$("#btnPagar").removeAttr("disabled");
		} else {
			$("#btnPagar").attr("disabled","disabled");
		}
	});
	
	$('body').on('change', '#grilla2003 input[type=checkbox]',function(e) {
		
		var checkboxes = $('#grilla2003 input[type="checkbox"]');
        var index = checkboxes.index(this);
        
        checkboxes.not(this).prop('checked', false);
		
		if (hasSelectedInputCheckbox("#grilla2003","id")) {
			$("#btnPagarMatricula").removeAttr("disabled");
		} else {
			$("#btnPagarMatricula").attr("disabled","disabled");
		}
	});
	
	$('body').on('click', '#btnCambiarCarrera',function(e) {
		e.preventDefault();

		var id = $('#cmbCarrerasAlumno').find(":selected").val();
		
		window.location.href="/4/?refresh=especialidad&id="+id;
	});
	
	$('body').on('click', '#btnPagar',function(e) {
		e.preventDefault();
		var haySeleccionadas = countSelectedInputCheckbox("#grilla2000","id");
	
		var lenHaySeleccionadas = haySeleccionadas.length;
		if (lenHaySeleccionadas!=0) {
			
			abrirModalGeneral("Generar Pago Cuotas","Has seleccionado " + lenHaySeleccionadas + " cuotas ha pagar. <br/> Luego serás redirigido al sitio de Pagos360.com para realizar la transacción. Gracias!", true, true, 1, function(e){
				var cuotas = String(haySeleccionadas);
				var cuotasFinal = cuotas.replace(/idCuota/gi,"");
				arancel.generarPaquete(cuotasFinal);	 				
		 		}, function(e){},{backdrop: 'static',keyboard: false}); //fin abrirModalGeneral
			$("#dialogoGeneral").attr("style","z-index:999998");
			
		} else {
			$("#btnPagar").attr("disabled","disabled");
		}
	});	
	
	$('body').on('click', '#btnPagarMatricula',function(e) {
		e.preventDefault();
		var haySeleccionadas = countSelectedInputCheckbox("#grilla2003","id");
	
		var lenHaySeleccionadas = haySeleccionadas.length;
		if (lenHaySeleccionadas!=0) {
			
			abrirModalGeneral("Generar Pago Cuotas","Has seleccionado " + lenHaySeleccionadas + " cuotas ha pagar. <br/> Luego serás redirigido al sitio de Pagos360.com para realizar la transacción. Gracias!", true, true, 1, function(e){
				var cuotas = String(haySeleccionadas);
				var cuotasFinal = cuotas.replace(/idCuota/gi,"");
				arancel.generarPaquete(cuotasFinal);	 				
		 		}, function(e){},{backdrop: 'static',keyboard: false}); //fin abrirModalGeneral
			$("#dialogoGeneral").attr("style","z-index:999998");
			
		} else {
			$("#btnPagarMatricula").attr("disabled","disabled");
		}
	});	
	$('body').on('click', '#verMisMatriculas',function(e) {
		e.preventDefault();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = "600";//_idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase();
		armarTabla(idMarcador, enlace, $(this));
		return false;
		
		
	});
	
	$('body').on('click', '#autoMatricularme',function(e) {
		e.preventDefault();
		
		academico.matricularme();
		
		return false;
		
	});

	$('body').on('click', '#verCupoMaterias',function(e) {
		e.preventDefault();
		
		var _idMarcador = $(this).attr("id");
		var idMarcador = "700";//_idMarcador.replace("e", "");
		var enlace = ($(this).attr("href")).toLowerCase()+'/'+especialidad;
		armarTabla(idMarcador, enlace, $(this));
		
	});
	
	$('body').on('click', '#listaFechasNotasIngresantes li',function(e) {
		e.preventDefault();
		
		$(".btnFechasNotasIngresantes").html('<i class="fa fa-calendar"></i> Nota: ' +$(this).text());
		
		var idCursillo = $(this).attr("data-id");
		Autogestion.Ingresantes.consultarNotas(idCursillo);
		
	});	

	$('body').on('click', '.botonInscripcionIngresantes',function(e) {
		e.preventDefault();
		
		var turno = $(this).attr("id");
		var turnoFinal = turno.replace("turno","");
		
		Autogestion.Peticion.inscripcionACursadoIngresantes("POST",turnoFinal);
		
	});

	$('body').on('click', '.botonInscripcionCursadoCuatrimestre',function(e) {
		e.preventDefault();
		
		var cuatrimestre = 2;
		
		Autogestion.Peticion.inscripcionACursadoCuatrimestre("POST",cuatrimestre);
		
	});
	
	$('body').on('click', '#tabAgendarParciales .dropdown-menu li a', function(e) {
		  var selText = $(this).text();
		  $(this).parents('.input-group-btn').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
	});

	$('body').on('click', '#meGustaA4', function(e) {
		e.preventDefault();
		usuario.actualizarPreferencia(17, 1);		
	});
	
	$('body').on('click', '#noMeGustaA4', function(e) {
		e.preventDefault();
		usuario.actualizarPreferencia(17, 0);
	});

	$('body').on('click', '.ayuda',function(e) {
		e.preventDefault();
		
		mdHelp = $(this).attr("data-help");
		
		ayuda.obtener(mdHelp);
		
	});
	
	$('body').on('click', '.calendarioAcademico',function(e) {
		e.preventDefault();		
		window.open("https://www.frc.utn.edu.ar/secretarias/academica/?pIs=97","_blank");
		return false;
		
	});
	
	
	$('body').on('click', '#enlaceVolverTimeLinePrincipal',function(e) {
		e.preventDefault();
		$(".content-header h1").html(timelineTitlePrincipal);
		$('#volverTimeLinePrincipal').click();					
	});
	
	
	$("#webSiteA4").on("click",function(e) {
		e.preventDefault();
		window.open("http://autogestion.frc.utn.edu.ar/","_blank");
		return false;
	});
	
	
	$("#menuMensaje ul.menuMensaje li ").on("click",function(e) {
		e.preventDefault();

		var elEnlace = $(this).attr('href');
		//alert(elEnlace);
		if (elEnlace.indexOf('#lnk') > 0) {
			//alert(elEnlace);
			$(elEnlace).trigger('click');
			return;
		}
	});

	$('body').on('click', '.botonAccesoInscripcionCursado', function(e) {
		e.preventDefault();
		var o = $(this);
		var tieneClase = o.hasClass("btn-warning");
		
		if (!tieneClase) {
			window.location.href = "/4/tramite/inscripcion/cursado/";			
		}
		return false;
		
	});	
		
	$('#lnkAutorizaciones').on('click', function(event) {
		var mensaje = Autogestion.Mensaje;
		mensaje.listar("/autorizaciones");
	});

	$('#lnkTodos').on('click', function(event) {
		var mensaje = Autogestion.Mensaje;
		mensaje.listar("/todos");
	});

	$('#lnkEnviados').on('click', function(event) {
		var mensaje = Autogestion.Mensaje;
		mensaje.listar("/enviados");
	});
	$('#lnkRecibidos').on('click', function(event) {
		var mensaje = Autogestion.Mensaje;
		mensaje.listar("/recibidos");
	});

	$("#publicarMensaje").on('click', function(event) {
		//contenedorBasePublicarMensajes
		//$(".nav-tabs-custom div.tab-content div").each(function(i) {
		//$('input[name=uploadedMaterial]').trigger('click');
		
		var mensaje = Autogestion.Mensaje;
		
		$(".nav-tabs-custom div.tab-content div").each(function(i) {
			estaActivo = $(this).hasClass('active');
			
			if (estaActivo) {
				$(this).removeClass('active');
				var elIdActivo = $(this).attr("id");
				
				if (elIdActivo=="tabPublicarMensajes") {
				}
				if (elIdActivo=="tabAdjuntarMaterial") {
					mensaje.agregarMaterial();
					return false;
				}
				if (elIdActivo=="tabAgendarParciales") {
				}
				if (elIdActivo=="tabPublicarTemario") {
				}
			}
			

		});
		
		var mensaje = Autogestion.Mensaje;
		mensaje.agregar();
		
		
	});

	$('body').on('click', '#publicarMensaje2', function(e) {
		e.preventDefault();
		var mensaje = Autogestion.Mensaje;
		mensaje.solicitarAceptacion();
		//$("#trustedperson-modal").modal('hide');
	});

	$('body').on('click', '#ayudaInscripcion', function(e) {
		e.preventDefault();
		//location.href="/4/tramite/inscripcion/cursado/default.jsp";
		
		if ($(this).hasClass("hrefClicked")) {
			return;
		} else {			
			
			var peticion = Autogestion.Peticion;
			
			$(this).removeClass("bg-purple-active");
			$(this).addClass("hrefClicked");
			$(this).addClass("bg-red");
			$(this).html('<i class="fas fa-spinner fa-spin fa-pulse fa-1x fa-fw"></i> Inicializando,espere por favor');

			if (hayTransaccionEjecutada==0) {
	  			Autogestion.Peticion.inicializarInscripcionACursado();
	  		}

		}

	});

	$('body').on('click', '#sitioWebAcademica', function(e) {	
		e.preventDefault();
		location.href = "http://www.frc.utn.edu.ar/secretarias/academica/";
	});

	$('body').on('click', '#concursosAcademicos', function(e) {
		e.preventDefault();
		location.href = "http://www.frc.utn.edu.ar/secretarias/academica/?pIs=50"
	});

	$('body').on('click', '#cambiarAnioAcademicoDocente', function(e) {	
		e.preventDefault();
		notificar("info", "Proximamente habilitaremos esta opción");
	});

	$('body').on('click', '#htmlInscripcionCursado', function(e) {	
		e.preventDefault();
		var peticion = Autogestion.Peticion;
		peticion.htmlInscripcionCursado();
	});

	$('body').on('click', '#fireOpenNuevos',function(e) {
		e.stopPropagation();
	    $("#btnAgregarContacto").trigger("click");
	});

	$('body').on('click', '#fireOpenAnio',function(e) {
		e.stopPropagation();
	    $("#contenedorCursando .box-header .box-tools .btn-group").find('[data-toggle=dropdown]').dropdown('toggle');
	});

	$('body').on('click', '.verActualGrilla',function(e) {
		e.stopPropagation();
		materias.actualGrilla();
	});	

	$('body').on('click', '.showMoreInfo',function(e) {
		e.stopPropagation();
		$(this).next().slideToggle();
		//$(".moreInfo").hide();
	    //$(".moreInfo").slideToggle();
	    $(this).text( $(this).text() == ' más +' ? " - " : " más +");
	});	

	$('body').on('click', '#btnVerReservas',function(e) {
		e.preventDefault();
		//academico.reservas();
		
		$("#listaMensajes").addClass("reservas");
		
		var elAttrActual;
		$("#listaMensajes li:not(.time-label)").hover(
				  function() {
					   // $( this ).append( $( "<span> ***</span>" ) );
					    elAttrActual = $( this ).find("i:not(.fa-plus-square)").attr("class");

					    
						if (elAttrActual=="fa fa-check bg-green") {
						} else {
							$( this ).find("i:not(.fa-plus-square)").attr("class","fa fa-check");							
						}
					    
					  }, function() {
						  var estaSeleccionado = $( this ).find("i:not(.fa-plus-square)").attr("class")
							if (estaSeleccionado=="fa fa-check bg-green") {
								
							} else {
								$( this ).find("i:not(.fa-plus-square)").attr("class",elAttrActual);
								if (estaSeleccionado=="fa fa-check bg-gray") {
									$( this ).find("i:not(.fa-plus-square)").attr("class",estaSeleccionado);
								}
							}
								
					  }		
		);
		
		
	});

	$('body').on('click', '.refrescarTimeLine',function(e) {
		e.preventDefault();
		mensaje.listar("");
	});
		
	$('body').on('click', '#btnAgregarMiembrosGrupo',function(e) {
		e.preventDefault();
		var id = $(this).attr("data-id");

		var grupo = Autogestion.Grupo;
		grupo.agregarContacto(id);
	});

	$('body').on('click', '#btnAgregarMiembrosGrupoInvitacion',function(e) {
		e.preventDefault();
		var id = $(this).attr("data-id");
		
		var data = $('#destinatarioDialog').select2('data');
		var dataLength = data.length;
		if (dataLength <= 0) {
			abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Seleccione un contacto para continuar!',true,false,0, function(e){}, function(e){});
			return;
		}

		var grupo = Autogestion.Grupo;
		grupo.invitarContacto(id);
	});

	$('body').on('click', '#btnAgregarGrupo', function(e) {
		e.preventDefault();		

		$(this).prop('disabled', false);
		
		var nombre = $("#txtGrupo").val();
		
		if (nombre.length == 0) {			
			abrirModalGeneral('<i class="fa fa-warning"></i> Advertencia','Ingrese el nombre del Grupo, por favor!',true,false,0, function(e){}, function(e){});
			$(this).prop('disabled', true);
			return;
		}

		var grupo = Autogestion.Grupo;
		grupo.agregar(nombre);
	});

	$('body').on('change', '#txtGrupo', function(e) {
		var c = $(this).length;
		if (c > 0) {
			$("#btnAgregarGrupo").prop('disabled', false);
		} else {
			$("#btnAgregarGrupo").prop('disabled', true);
		}
	});

	$("#btnAgregarContacto").on({click : function() {
		var _id = $(this).attr("id");
		abrirModalAgregarContacto("C", "");
		}
	});

	$('#fechaAgendarParciales').daterangepicker({
		minDate:fechaIniciaParciales,
		maxDate: fechaFinalParciales ,	   
		singleDatePicker: true,
	    showDropdowns: true,
	    autoApply: true,
	    locale: {
	        format: 'DD/MM/YYYY',
	      },	    
        format: 'DD/MM/YYYY',
	}, function(start, end, label) {
      var dif = moment().diff(start, 'days');
      if (dif>0) { alert("No puede reservar días para atrás"); }	  
	  
	});	
    
	$('#fechaPublicarTemario').daterangepicker({
	    "singleDatePicker": true,
	    "showDropdowns": true,
	    "autoApply": true,
	    locale: {
	        format: 'DD-MM-YYYY',
	      },	    	    
	}, function(start, end, label) {

	});	
    
	
	
	$("#contenedorCursando ul.aniosAcademicos li").click(function(e) {
		e.preventDefault();
		var anio = $(this).find("a").attr("href");
		materias.actual(anio);		
	});

	$("#contenedorGrupos ul.aniosAcademicos li").click(function(e) {
		e.preventDefault();
		var anio = $(this).find("a").attr("href");
		//materias.actual(anio);
		grupo.refrescar();
	});

	/*
	$('body').on('click', '#btnIngresarBibliotecaVirtual', function(e) {
		e.preventDefault();
		window.location.href="http://www.frc.utn.edu.ar/bibliotecacentral/virtual/";
	});
	*/

	$('body').on('click', '#btnBuscar', function(e) {
		e.preventDefault();
		
		var txt = $("#tx").val();
		if (txt.length == 0) {
			abrirModalGeneral("Advertencia","Ingrese un texto, por favor!",true,false,0);
			return;
		}
		
		$("#fBuscar").submit();
	});

	$('body').on('click', '#btnBuscarAvanzada', function(e) {
		e.preventDefault();
		$("#fBuscar").submit();
	});

	$('body').on('click', '#IRA', function(e) {		
		$("#timelinePrincipal ul").scrollTo($("#idMensaje1881929"), 1000);
	});
	
	$("#btnRefrescarContacto").on({click : function() {
		var contacto = Autogestion.Contacto;
		contacto.listar();
		$( "#btnContactosAutorizados" ).trigger( "click" );
		}
	});
	
	
	$("#btnContactosAutorizados").on({click : function(e) {
		e.preventDefault();		
		var contacto = Autogestion.Contacto;
		var ThisObject = this;
		contacto.listar(function(){
			SeleccionarTabContacto(ThisObject,$("#tabContactosAutorizados"));
			});
		}
	});

	$("#btnContactosPendientes").on({click : function(e) {
		e.preventDefault();
		var contacto = Autogestion.Contacto;
		var ThisObject = this;
		contacto.listar(function(){
			SeleccionarTabContacto(ThisObject,$("#tabContactosPendientes"));
			});
		}
	});
	
	$("#btnContactosBloqueados").on({click : function(e) {
		e.preventDefault();
		var contacto = Autogestion.Contacto;
		var ThisObject = this;
		contacto.listar(function(){
			SeleccionarTabContacto(ThisObject,$("#tabContactosBloqueados"));
		});
	}});
	
	$("#btnContactosQueMeBloquearon").on({click : function(e) {
		e.preventDefault();
		var contacto = Autogestion.Contacto;
		var ThisObject = this;
		contacto.listar(function(){
		SeleccionarTabContacto(ThisObject,$("#tabContactosQueMeBloquearon"));
		});
	}});
	
	$("#contenedorBiblioteca div.box-header .nav-tabs a").on({click : function(e) {
		e.preventDefault();		
	  	var href = this.hash;
	  	
	  	if (href=="#tabTop5") {
	  		biblioteca.recomendados();
	  	}

	  	if (href=="#tabLibrosRecomendados") {
	  		biblioteca.recomendados();
	  	}

		}
	});

	$('.messages-menu').on('show.bs.dropdown',function() {
		$('#contenedorMensajesNuevos ul').remove();
		$('#contenedorMensajesNuevos').append('<ul><li>Buscando...</li></ul>');
		mensaje.listarNuevos();
	});

	$('body').on('click', '#cuil', function(e) {

		$(this).editable({
		    url: '/4/tramites/persona/cuil/',
		    validate: function(value) {
		        if(value.pre == '') return '*'; 
		    },
		    display: function(value) {
		        if(!value) {
		            $(this).empty();
		            return; 
		        }
		        var html = $('<div>').text(value.pre).html() + '-' + $('<div>').text(value.dni).html() + '-' + $('<div>').text(value.pos).html();
		        $(this).html(html); 
		    }         
		});   

	});

	$('body').on('click', 'a.marcaEstadoLeido', function() {
		var _id = $(this).attr("id");
		var id = _id.replace("marcaEstadoLeido", "");
		mensaje.marcar(id, 'L');
	});

	$('body').on('click', 'a.marcaEliminado', function() {
		var _id = $(this).attr("id");
		var id = _id.replace("marcaEliminado", "");
		abrirModalGeneral("Advertencia : Eliminar", "Esta seguro que desea eliminar el Mensaje?" ,true,true,1, function(i) {
			mensaje.eliminar(id);
			$('#dialogoGeneral').modal('hide');
		}, function(i) {
			$('#dialogoGeneral').modal('hide');
		});		
		
	});

	$('body').on('click', 'a.marcaEstadoOculto', function() {
		var _id = $(this).attr("id");
		var id = _id.replace("marcaEstadoOculto", "");
		mensaje.marcar(id, 'O');
	});

	$('body').on('click', 'a.marcaDenuncia', function() {
		var _id = $(this).attr("id");
		var id = _id.replace("marcaDenuncia", "");
		mensaje.denunciar(id);
	});

	$('body').on('click', 'a.marcaEliminar', function() {
		var _id = $(this).attr("id");
		var id = _id.replace("marcaEliminar", "");
		mensaje.marcar(id, 'B');
	});

	$('body').on('click','#dialogoEnlacesBases .modal-header button',function() {
		var ih = $(this).find('.fa-heart');
		if (ih) {
			var _id = ih.attr("id");
			if (_id) {
				var id = _id.replace("idMarcador", "");
				favorito.agregar(id);
			}
		}
	});

	$("#btnRefrescarGrupo").on({click : function() {
		$('#contenedorGrupos .box-header div.nav-tabs-custom ul li').each(function(i) {
			estaActivo = $(this).hasClass('active');
			
			if (estaActivo) {
				grupo.refrescar();
			}
		});
		}
	});
	$("#btnRefrescarFavoritos").on({click : function() {
		favorito.refrescar();
	}});
	
	$("#btnBarraFavoritos").on({click : function() {
		
		var listaFavoritos = $("#listaFavoritos").clone();
		var items = [];
		
		$( "#listaFavoritos li" ).each(function( index ) {
			var elA = $( this ).find("a");

			items.push('<li id="'+$( this ).attr("id")+'"><a href="'+elA.attr("href")+'" id="'+elA.attr("id")+'">'+elA.text()+'</a></li>');			

			});	
		
		var listaFavoritosHtmlFinal = items.join('');
		
		var listaFavoritosSize = $("#listaFavoritos li :not(.itemVacio)").size();
		//hasclass
		var barra = '<li class="dropdown favoritos-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-heart"></i><span class="label label-success">'+listaFavoritosSize+'</span></a><ul class="dropdown-menu">'+listaFavoritosHtmlFinal+' </ul></li>';
		
		$(".messages-menu").before(barra);
		
		usuario.actualizarPreferencia(19, 1);
		
		$("#btnQuitarFavoritos").trigger('click');
		
	}});

	$('body').on('shown.bs.tab','a[data-toggle="tab"]',function(e) {
		var href = $(e.target).attr("href");

		if (href) {
			if (href == "#tabAcademico") {
				$('#contenedorGrupos .box-footer').hide();
				
			}
			if (href == "#tabPropio") {
				$('#contenedorGrupos .box-footer').show();
				$('#contenedorGrupos .box-footer #txtGrupo').show();
				$('#contenedorGrupos .box-footer #btnAgregarGrupo').show();
				
			}
			
			if (href == "#tabesDirector") {
				$('#contenedorGrupos .box-footer').show();				
				$('#contenedorGrupos .box-footer #txtGrupo').hide();
				$('#contenedorGrupos .box-footer #btnAgregarGrupo').hide();
			}
			
			if (href == "#tabesJefeCatedra") {
				//$('#contenedorGrupos .box-footer').hide();
				$('#contenedorGrupos .box-footer').show();
				$('#contenedorGrupos .box-footer #txtGrupo').hide();
				$('#contenedorGrupos .box-footer #btnAgregarGrupo').hide();
			}

			if (href == "#tabesDocenteComisiones") {
				$('#contenedorGrupos .box-footer').show();
				$('#contenedorGrupos .box-footer #txtGrupo').hide();
				$('#contenedorGrupos .box-footer #btnAgregarGrupo').hide();
			}

			if (href == "#tabCargostieneComisiones") {				
				if (getTipoUsuario()=="D") {
					materias = Autogestion.Dictado;
					materias.actual(anioActual,'tieneComisiones');
				}

			}
			
			if (href == "#tabCargosesDirector") {				
				if (getTipoUsuario()=="D") {
					materias = Autogestion.Dictado;
					materias.actual(anioActual,"esDirector");
					
				    //var m = new Search('#txtCursoSearch');

				}

			}

			if (href == "#tabCargosesJefeCatedra") {				
				if (getTipoUsuario()=="D") {
					materias = Autogestion.Dictado;
					materias.actual(anioActual,"esJefeCatedra");
				}

			}

			if (href == "#tabOffice365") {
				$('#tabBoleto').hide();
				$('#tabOffice365').show();
			}

			if (href == "#tabBoleto") {
				$('#tabOffice365').hide();
				$('#tabBoleto').show();
			}

		}
	});

	$('body').on('keyup', '#txtGrupoSearch', function() {
        var searchText = $(this).val();
        var ulABuscar = '';
        
        $('#contenedorGrupos div.box-header div.nav-tabs-custom ul > li').each(function(){
        	console.log($(this).text() + $(this).hasClass("active"));
        	if ($(this).hasClass("active")) {
        		var tabSeleccionado = $(this).text();
        		
        		if (tabSeleccionado=='Propios') {
        			ulABuscar = 'ul#listaGruposPropios > li';
        		} else if (tabSeleccionado=='Docente') {
        			ulABuscar = 'ul#listaGruposDocenteComisiones > li';
        		} else if (tabSeleccionado=='JC') {
        			ulABuscar = 'ul#listaGruposCatedra > li';        			        			
        		} else if (tabSeleccionado=='JD') {
        			ulABuscar = 'ul#listaGruposDirector > li';
        		} else {
        			//a revisar
        			ulABuscar = 'ul#listaGruposPropios > li';
        		}
        	}
        });

        $(ulABuscar).each(function(){
            
            var currentLiText = $(this).text().toLowerCase();
            
            if (searchText) { searchText = searchText.toLowerCase(); }                       
            
            if (currentLiText.indexOf(searchText)!=-1)  {
                $(this).show();
            } else {
                $(this).hide();
            }
             
        });     	
	});

	$('body').on('keyup', '#txtCursoSearch', function() {
		var searchText = $(this).val().toLowerCase();
		
        var ulABuscar = '';
        
        $('#contenedorCursos div.box-header div.nav-tabs-custom ul > li').each(function(){
        	console.log($(this).text() + $(this).hasClass("active"));
        	if ($(this).hasClass("active")) {
        		var tabSeleccionado = $(this).text();
        		
        		if (tabSeleccionado=='Docente') {
        			ulABuscar = 'ul#listaCargostieneComisiones > li';
        		} else if (tabSeleccionado=='JC') {
        			ulABuscar = 'ul#listaCargosesJefeCatedra > li';        			        			
        		} else {
        			//a revisar
        			ulABuscar = 'ul#listaGruposPropios > li';
        		}
        	}
        });
        
        $(ulABuscar).each(function(){
            
            var currentLiText = $(this).text().toLowerCase();
            
            if (searchText) { searchText = searchText.toLowerCase(); }                       
            
            if (currentLiText.indexOf(searchText)!=-1)  {
                $(this).show();
            } else {
                $(this).hide();
            }
             
        });     	

	});

	
	$("#menuTramites li a").on('click', function(event) {
		event.preventDefault();
		var enlace = ($(this).attr("href"));//.toLowerCase();
		var tipo = $(this).data("local")
		var idTramite = $(this).data("idtramite")

		if(tipo && tipo =="S")
			abrirModalV4(enlace);
		else
			abrirModalV3(enlace);
	});

	$("#btnFiltroFeriados").on('click', function(e) {
		e.preventDefault();
		var enlace = ($(this).attr("href")).toLowerCase();

		abrirModalV3(enlace);
	});

	$('body').on('click',"a.alcance", function(event) {
		
		var _id = $(this).attr("data-id");
		//var id = _id.replace("idCursoLT","");
		var texto = $(this).text();

		mensaje.listar("/curso/"+_id+"/"+texto);

		$(window).scrollTo(".content-header",400);

	});
	

	/* Cerrar/Cancelar Escritura de Mensaje Respuesta */
	$('body').on('click',"#timelinePrincipal ul li div.timeline-item div.timeline-footer div.botoneraAcciones div.alert button.close", function(event) {
		
		ControladorMensajes(event,this,ActionFromEnum.TIMELINE);
		
		var _dataPublicador = $(this).data("publicador");
		var _dataConversacion = $(this).data("conversacion");
		var _id = $(this).attr("id");
		var partes = _id.split('_');
		var id = partes[1];
		element = $("<a data-publicador='"+ _dataPublicador+ "' data-conversacion='" + _dataConversacion  + "'  class='btn btn-success btn-xs'><i class='fa fa-mail-reply'></i>&nbsp;Responder </a>");
		element.attr("id","itemConversacion_EscribirRespuesta_"+ id);
		element.appendTo($('#itemBotoneraMensaje'+ id));
	});
	
	$('body').on('click',"a.busquedaLibro", function(e) {
		e.preventDefault();
		var texto = $(this).text();
		
		$('input#tx').val(texto);
		$(window).scrollTo("input#tx",400);
		$('#btnBuscar').trigger("click");
		
	});

	$('body').on('click',"a.busquedaUsuario", function(e) {
		e.preventDefault();
		var idUsuario = $(this).attr("data-id");
		var nombreUsuario = $(this).text();
				
		var persona = {categoria:"themes/AdminLTE-2/dist/img/avatarS.png", descripcion:nombreUsuario, id:idUsuario, nombre:idUsuario,tipo:"USUARIO",valor:nombreUsuario};
				
		$("#destinatariosMensaje").select2('data',persona);
		
		$(window).scrollTo(".content-header",400);
		
	});
	
	$('body').on('click',"#tabPublicarMensajes a",function(e){
		e.preventDefault();
	});
		
	$('body').on('click',"#tabAdjuntarMaterial a",function(e){
		e.preventDefault();
		$("#formularioBasePublicar").appendTo($(this));
	});

	/* Click desde  Container
	 * Botones
	 * 	Cancelar 
	 * 	Aceptar 
	 * 	Rechazar Solicitudes Pendientes
	 *  Bloquear
	 */
	
	$('body').on('click',"#tabContactosPendientes ul li div.tools a,#tabContactosAutorizados ul li div.tools a,#tabContactosBloqueados ul li div.tools a",function(event){
		ControladorMensajes(event,this,ActionFromEnum.CONTAINER);
		return;	
	});

	

	function SeleccionarTabContacto(ThisObject,TabASeleccionar)
	{ 
		var titulo = "Contactos "+ $(ThisObject).text();
		$("#contenedorContactos h3.box-title").text(titulo);
		$("#contenedorTabsContactos div.tab-content div").each(function(i) {
			estaActivo = $(this).hasClass('active');
			if (estaActivo) {
				$(this).removeClass('active');
			}
		});
		//$("#tabContactosPendientes").addClass('active');
		$(TabASeleccionar).addClass('active');
		
	}
	
	function ControladorMensajes(event,thisObject,actionFromEnum)
	{
		var _id = $(thisObject).attr("id");
		if (!_id) return;
		
		event.preventDefault();
		
		var partes = _id.split('_');
		var _dataPublicador = $(thisObject).data("publicador");
		var _dataFoto1 = $(thisObject).data("foto");
		
		 var _idMensaje = partes[2];
		 var _idAccion = partes[1];
		 var _idTipoMensaje = partes[0];
		 
		 var mensaje = Autogestion.Mensaje;
		 	 	 
			 switch (_idTipoMensaje)  {
				 
				 case "itemAutorizacion":
					 
				 	if ( _idAccion == "Escribir") {
							var _dataDestino = $(thisObject).data("destino");
							var _dataDestinatario = $(this).data("destinatario");
							$("#destinatarioDialog").select2('data', {id: _dataDestino, descripcion: _dataDestinatario,tipo:'A'});
							$("txtMensaje2").val("...");
							abrirModalAgregarContacto("C", "");
							return;
				 		
				 	} else {	
					 	if(_idAccion=="Reinvitar") {
				 		    abrirModalGeneral("Agregar Nuevamente a la lista de Contacto","Desea enviar una nueva solicitud de Contacto",true,true,1,function(e){
					 			 var mensaje = Autogestion.Mensaje;
								 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno) {
									   
									   $( "#btnContactosAutorizados" ).trigger( "click" );
										
										
										
									}); 
				 		}, function(e){}); //fin abrirModalGeneral
				 		return;
				 	 } //fin id renenviar
				 	 if(_idAccion=="Desbloquear") {
				 		abrirModalGeneral("Quitar Bloqueo a Contacto","Desea desbloquear el contacto?",true,true,1,function(e){
				 			 var mensaje = Autogestion.Mensaje;
							 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno){
									$( "#btnContactosAutorizados" ).trigger( "click" );
									
								}); 
				 		}, function(e){});  //fin abrirModalGeneral
				 		return;
				 	 } //fin id desbloquear

				 	 if(_idAccion=="Cancelar") {
				 		abrirModalGeneral("Cancelar Solicitud","Desea cancelar la solicitud enviada al contacto?",true,true,1,function(e){
				 			 var mensaje = Autogestion.Mensaje;
							 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno){
																			
										$( "#btnContactosAutorizados" ).trigger( "click" );
																		
								}); 
				 		}, function(e){});  //fin abrirModalGeneral
				 		return;
				 	 } //fin id cancelar
				 	 if(_idAccion=="Autorizar" || _idAccion=="Aceptar") {
				 		abrirModalGeneral("Autorizar Solicitud","Desea autorizar al contacto?",true,true,1,function(e){
				 			 var mensaje = Autogestion.Mensaje;
							 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno){
							
									
									$( "#btnContactosPendientes" ).trigger( "click" );
								
								}); 
				 		}, function(e){});  //fin abrirModalGeneral
				 		return;
				 	 } //fin id autorizar

				 	 if(_idAccion=="Rechazar") {
				 		abrirModalGeneral("Rechazo de Solicitud","Desea rechazar la solicitud de contacto?",true,true,1,function(e){
				 			 var mensaje = Autogestion.Mensaje;
							 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno){
																	
									$( "#btnContactosAutorizados" ).trigger( "click" );
									
								}); 
				 		}, function(e){});  //fin abrirModalGeneral
				 		return;
				 	 } //fin id rechazar

				 	 if(_idAccion=="Bloquear") {
				 		abrirModalGeneral("Bloqueo de Contacto","Desea bloquear el contacto?",true,true,1,function(e){
				 			 var mensaje = Autogestion.Mensaje;
							 mensaje.procesar(_dataPublicador, _idMensaje,_idAccion,function(codigoRetorno,mensajeRetorno){

								 $( "#btnContactosBloqueados" ).trigger( "click" );
									
									
								 
									
								}); 
				 		}, function(e){}); //fin abrirModalGeneral
				 		return;
				 	 } //fin id bloquear			 	 
				 	} //fin del primer el de arriba 
				 	break;

		 
				 case "itemConversacion":
					 
					 if (_idAccion =="Obtener") {
						 var _dataPersona = $(thisObject).data("persona");
						 var _dataFoto = $(thisObject).data("foto");
						 
						 var mensaje = Autogestion.Mensaje;
						 mensaje.conversacion(_idMensaje,_dataPersona, function(arrayItems) { 
							 }, _dataFoto1);
					 } else if(_idAccion =="EscribirRespuesta") {
						 var _textBox = $(thisObject).next().is("input");
						 var _valTextBox = "";
							if (_textBox) {
								_valTextBox = $(thisObject).next().val();
							}
							// armar botonera y caja de texto
							// para el mensaje de respuesta
							var template = $("#divTextoRespuesta").clone();
							template.attr("id","accionCrearTextBox_" + _idMensaje);
							var inputtext = template.find("input[type=text]");
							inputtext.attr("id", "txtMensaje_"+ _idMensaje);
		
							var inputclose = template.find("button");
							inputclose.attr("id","btnIdCloseMensaje_" + _idMensaje);
							inputclose.attr("data-publicador",_dataPublicador);
		
							var inputhidden = template.find("input[type=hidden]");
							inputhidden.attr("id","txtIdMensaje_" + _idMensaje);
							inputhidden.val(_idMensaje);
		
							var anchorButton = template.find(".btn-conversacion");
							anchorButton.attr("id","itemConversacion_EnviarRespuesta_"+ _idMensaje);
							anchorButton.attr("data-publicador",_dataPublicador);
							var _dataConversacion = $(thisObject).data("conversacion");
							anchorButton.attr("data-conversacion", _dataConversacion);
							
							var _dataNombre = $(thisObject).data("persona");
							anchorButton.attr("data-persona", _dataNombre);
							
							$('#itemBotoneraMensaje' + _idMensaje).html("");
		
							template.appendTo($('#itemBotoneraMensaje'+ _idMensaje));
		
							$("#accionCrearTextBox_" + _idMensaje).show();
					 } else if (_idAccion =="EnviarRespuesta") {

						 var texto = $("#txtMensaje_" + _idMensaje).val();
							if ($.trim(texto).length > 0) {
								mensaje.responderMensaje(_dataPublicador, _idMensaje,texto);
								var _dataConversacion = $(thisObject).data("conversacion");
								var _dataNombre = $(thisObject).data("persona");
								mensaje.conversacion(_dataConversacion,_dataNombre, function(arrayItems) { 
								 }, _dataFoto1);
							} else {
								AlertBox("Conversacion","Debe Ingresar un Texto para la respuesta del Mensaje");
							}
					 } else {
						 alert(_idAccion  + " no contemplada");
					 }
					 break;
				 default:
					 // nada que hacer por ahora;
					 return;
				 }			 	
	}
	
	$('body').on('click',"#masElementosDelTimeLine",function(e) {
		e.preventDefault();
		
		var laPagina = $(this).attr("href");
		$(this).removeAttr("href");
		$(this).html('<div class="loading-img"></div>Obteniendo Nuevos Mensajes');
				
		mensaje.listar("/todos",laPagina);
		
	});
	
	$('body').on('click',"#masElementosDelTimeLineCurso",function(e) {
		e.preventDefault();
		
		var laUrlCompleta = $(this).attr("href");
		var laUrl = laUrlCompleta.split("?");
		var laUrlFinal = laUrl[0];
		var laPagina = laUrl[1].replace("pagina=","");
		
		$(this).removeAttr("href");
		$(this).html('<div class="loading-img"></div>Obteniendo Nuevos Mensajes del Curso');
				
		mensaje.listar(laUrlFinal,laPagina);
		
	});

	$('body').on('click',"#nuevoEvento",function(e) {
		var moment = $('#calendar').fullCalendar('getDate');

		var start =  $('#calendar').fullCalendar('getDate');
		var end = $('#calendar').fullCalendar('getDate');
		abrirModalEventos(start,end);		
	});

	$('body').on('click',".marcaConfiguracion",function(e) {

		e.preventDefault();	
		mensaje.configuraciones();		
	
	});
	
	$('body').on('click',"#configuracionVisibilidadMensajes",function(e) {

		e.preventDefault();	
		mensaje.configuraciones();		
	
	});

	$('body').on('click',"button.btnAutorizaBoletoEducativo",function(e) {
		
		e.preventDefault();
		
		var autorizo = $(this).attr("data-info");
		
		servicio.autorizarAccesoInfo(autorizo);
			
	});

	
	$('body').on('click',"#boletoEducativo",function(e) {
		
		e.preventDefault();
		
		var autorizo = $(this).attr("data-info");
				
		servicio.inicial("BEG",autorizo);

	});

	$('body').on('click',"#tablaConfiguraciones td div div.toggle",function(e) {
		
		//var esToogle = 
		//$(this).find(".toogle");
		
		if ($(this).hasClass("off")) {
			seleccionado = 0;
		} else { 
			seleccionado = 1;
		}
		
		var encuentraInput = $(this).find("input[type=checkbox]");
		var id = "";
		if (encuentraInput) { 
			id = encuentraInput.attr("id");		
		}
		var tipoAccion = 0;
		if (seleccionado) { tipoAccion = 0;} else { tipoAccion = 1;}
		mensaje.visibilidad(id,tipoAccion);		
	});
	
	$('body').on('click',"#irx",function(e) {	
		var id = $(this).attr("id");
	});
		
	
	
	$('body').on('dblclick',".subirFoto2",function(e) {
		$('input[name=uploadedFile]').trigger('click');		
	});

	$('body').on('click',"#agregarImagen",function(e) {
		alert("Proximamente!");		
	});

	$('body').on('click',".menuExpendienteTimeline",function(e) {	
		$('#menuExpediente a').click();
		var data = $(this).attr("data");
		var splitData = data.split("|");
		var idData = splitData[0];
		var estadoData = splitData[1];
		listarMovimientos(idData,estadoData);
	});
	
	$('body').on('click',".menuExpendienteTimelineTodos",function(e) {	
		$('#menuExpediente a').click();
	});

	$('body').on('click',".refresh-btn",function(e) {
		mensaje.listarAcademicos();	
	});
	
	
	//BOTONES
	/*
	 * "mas" (mostrar items de la conversacion)
	 */
	$('body').on('click',"#timelinePrincipal ul li div.timeline-item .timeline-header a,#timelinePrincipal ul li div.timeline-item div.timeline-body a",function(event) {
		ControladorMensajes(event,this,ActionFromEnum.TIMELINE);	
	});
	
	/* Escribir Mensaje */
	/*#timelinePrincipal ul li div.timeline-item .timeline-header a,*/
	$('body').on('click',"#timelinePrincipal ul li div.timeline-item div.timeline-footer .botoneraAcciones a",function(event) {
		ControladorMensajes(event,this,ActionFromEnum.TIMELINE);
		return;
		
	});

	$('input').on('ifChecked', function(event) {
		change_skin(this.value);
	});

	$('input').on('ifChecked', function(event) {
		change_layout();
	});

    //Add the change skin listener
    $("[data-skin]").on('click', function (e) {
      e.preventDefault();
      usuario.actualizarPreferencia(11, $(this).data('skin'));
    });

    $('body').on('click',"#quitarPreferencia",function(e) {
        e.preventDefault();
        usuario.quitar(5);
        $(".fotoPerfilUsuario").attr("src", imagenPerfilPorDefecto);
        $(this).remove();
	});
    
    
    var $popoverInbox = $('a[rel="popover"]').popover({
	        title: 'Click Inside',
	        placement: 'bottom',        
	        template: '<div class="popover-all"><div class="popover-arrow"></div><div class="popover-inner"><h3 class="popover-title">Example</h3><div class="popover-content"><p> Clicks:0 </p></div></div></div>'
	    });
	 
	   var count=0;
	    
   $('body').on({click: function() {
      	count += 1;
        var dataPopover = $popoverInbox.data('popover');
		dataPopover.tip().find('.popover-content').html('<p> Clicks:'+count+' </p>');
      }   
	}, '.popover-all');

	/* Inicio de destinatarios */
	   $("#destinatariosMensaje").on("change", function (e) {		  
			//$("#destinatariosMensaje").select2('data',persona);
	   });
	$("#destinatariosMensaje").val("");
	$("#destinatariosMensaje").select2({
		multiple : true,
		placeholder : "Contactos Confiables...",
		minimumInputLength : 3,
		ajax : {
			url : function () {
			      return configuracion.urlCompleta(getLaUlrBusquedaActual());
		    },
			params : {
				headers : {
					"A4-Token" : A4Token,
					"A4-TimeStamp" : A4TimeStamp,
					"A4-Data" : A4Data
				}
			},
			dataType : 'json',
			quietMillis : 250,
			data : function(term, page) {
				return {
					conocido : 'S',
					por : term, // search term
				};
			},
			results : function(data, page) { // parse
				return {
					results : data
				};
			},
			cache : true
		},
		initSelection : function(element,callback) {
			var id = $(element).val();
			if (id !== "") { 
				$.ajax(configuracion.urlCompleta("buscar/global/")+ id,
					{
						dataType : "json"
				}).done(function(data) {
						callback(data);
				});
				}
		},
		formatResult :repoFormatResult
		,
		formatSelection : repoFormatSelection
		/*function(repo) {
			   return repo.descripcion;
		}*/,
		escapeMarkup : function(m) {
			return m;
		} 
	});
	/* fin selecion de destinatorios */

	function repoFormatResult (repo) {
	    if (repo.loading) return repo.text;
	    
	    var tipoGrupo = repo.tipo;
	    var htmlLinea = "";

		var descripcion ="";
		 if (repo.descripcion) {
		      descripcion =  repo.descripcion ;
		   }
	    
	    htmlLinea = $.imagenPerfil(repo.categoria,repo.descripcion,32,repo.tipo);
	    
	    var markup = '<div class="row-fluid">' +
	      '<div class="span10">' +
	         '<div class="row-fluid">' +          
	            '<div class="span3"> ' + htmlLinea + ' ' +  descripcion +  '</div>' +
	         '</div>';
	   markup += '</div></div>';

	   return markup;
	  }

	  function repoFormatSelection (repo) {
	    return repo.descripcion;//repo.full_name || repo.text;
	  }
	  
	  
	/* Inicio de destinatarios para los dialogos */	
	$("#destinatarioDialog").val("");
	$("#destinatarioDialog").select2({
			multiple : true,
			placeholder : "Para...",
			minimumInputLength : 3,
			allowClear: true,
			ajax : { 
				url :function () {
				      return configuracion.urlCompleta(getLaUlrBusquedaActual());
			    }, 
				params : {
					headers : {
						"A4-Token" : A4Token,
						"A4-TimeStamp" : A4TimeStamp,
						"A4-Data" : A4Data
					}
				},
				dataType : 'json',
				quietMillis : 250,
				data : function(term, page) {
					return {
						conocido : $("#seConocen").val(), 
						por : term, 
					};
				},
				results : function(data, page) { 
					return {
						results : data
					};
				},
				cache : true
			},
			initSelection : function(element,callback) {
				var id = $(element).val();
				if (id !== "") { 
					$.ajax(configuracion.urlCompleta("buscar/global/")+ id,
							{
								dataType : "json"
							})
					.done(function(data) {
						callback(data.results);
					});
				}
			},
			formatResult : function(repo) {
				var descripcion ="";
				 if (repo.descripcion) {
				      descripcion =  repo.descripcion ;
				   }
				   var markup = '<div class="row-fluid">' +
				      '<div class="span10">' +
				         '<div class="row-fluid">' + 			         
				            '<div class="span3"> ' + $.imagenPerfil(repo.categoria,repo.descripcion,32,repo.tipo) +  ' ' + descripcion + '</div>' +
				         '</div>';
				   /*if (repo.descripcion) {
				      markup += '<div>' + repo.descripcion + '</div>';
				   } */

				   markup += '</div></div>';

				   return markup;
				},
			formatSelection : function(repo) {
				   return repo.descripcion;
			},
			escapeMarkup : function(m) {
				return m;
			}
	});
	/* fin selecion de destinatorios */
	//configurarBuscarGeneral();
	newUrlBuscarGeneral = function(){
		var xid = $("input#idBusqueda").val();
		var urldeBusqueda = "buscar/global";//$("input#urlBusqueda").val();
		return configuracion.urlCompleta(urldeBusqueda);
}
/* Inicio del buscador general*/
//multiple : false,
$("#buscarGeneral").val("");
$("#buscarGeneral").select2({
		dropdownCssClass : 'buscarGeneralDrop' ,
	    maximumSelectionSize: 1,
	    multiple : true,
		allowClear: true,
		placeholder : "Buscar...",
		minimumInputLength : 3,
		ajax : { 
			url : newUrlBuscarGeneral,
			params : {
				headers : {
					"A4-Token" : A4Token,
					"A4-TimeStamp" : A4TimeStamp,
					"A4-Data" : A4Data
				}
			},
			dataType : 'json',
			quietMillis : 250,
			data : function(term, page) {
				return {
					por : term, 
				};
			},
			results : function(data, page) { 
				return {
					results : data
				};
			},
			cache : true
		},
		initSelection : function(element,callback) {
			var id = $(element).val();
			if (id !== "") { 
				$.ajax(configuracion.urlCompleta("buscar/global/")+ id,
						{
							dataType : "json"
						})
				.done(function(data) {
					callback(data);
				});
			}
		},
		formatResult : function(repo) {
			   var markup = '<div class="row-fluid">' +
			      '<div class="span10">' +
			         '<div class="row-fluid">' +          
			            '<div class="span3"> ' + $.imagenPerfil(repo.categoria,repo.descripcion,32,repo.tipo); + '</div>' +
			         '</div>';
			   if (repo.descripcion) {
			      markup += '<div>' + repo.descripcion + '</div>';
			   }

			   markup += '</div></div>';

			   return markup;
			},
		formatSelection : function(repo) {
			   return repo.descripcion;
		},
		escapeMarkup : function(m) {
			return m;
		}
});
	


	$("#buscarGeneral").on("select2-selecting", function(e) 
												{ 
		
													objeto = e.object;
													
													if(objeto.categoria=="Marcadores")
													{
														$("#e" + objeto.id ).trigger("click");
													}
													else
													{		
													//	alert("selecting data	" + objeto.categoria);
													}
												});
	$("#buscarGeneral").on("select2-close", function() 
			{  $('#buscarGeneral').select2("val", ""); 
			}
	);
	
	/* fin selecion de destinatorios */	
	$('#cropbox').Jcrop({
		aspectRatio : 1,
		onSelect : updateCoords
	});

	$("body").on("click", ".archivosDescarga, .archivosComprimidos, .archivoExpedientes", function (e) {
		e.preventDefault();
		e.stopPropa
		var url = $(this).attr('href');
		var link = $(this);
		$.fileDownload(url, {
			httpMethod: "POST",
			data: {"A4-Token" : A4Token,"A4-TimeStamp" : A4TimeStamp,"A4-Data" : A4Data},
			successCallback: function (url) {			 
	            link.find("i").remove();
	            link.append(' <i class="fa fa-check-circle text-success"></i>');
			},
			failCallback: function (responseHtml, url) {
	            link.find("i").remove();				
				link.append(' <i class="fa fa-check-circle text-danger"></i>');
			}		
		});
	});

	$("body").on("click", ".archivoVerEnLinea", function (e) {
		e.preventDefault();
		var url = $(this).attr('href');
		var target = $(this).attr('target');
		var laUrl = url + "?A4-Token="+A4Token+"&A4-TimeStamp="+A4TimeStamp+"&A4-Data="+A4Data;
		window.open(laUrl, target);
	});
		
	$("body").on("click", ".archivosHistorial", function (e) {
		e.preventDefault();
		var _id = $(this).parent().closest("li").attr("id");
		var id = _id.replace("idMensaje","");
		

		$(this).after().remove('div');
		
		archivo.estadisticas($(this),id);

		
	});

    //var m = new Search('#txtCursoSearch','#listaCargosesDirector');

	//verContenedorFavoritos();	
});
/* fin document */

var Search = (function(){

    var elem, list;

    var cls = function (name) {
        var self = this;

        self.elem = $(name);
        //self.list = $('#' + name).next('ul').children();
        //self.list = $(jList).children();
        self.list = $("ul#listaCargosesDirector >li").children();

        // add event listeners
        self.elem.bind('keyup', function () { self.change(); }); 
    };

    cls.prototype = {
        change: function () {

            var self = this;


            var typed = self.elem.val();

            if (typed !== '') {
                // remove irrelevent items from the list
            	$("#listaCargosesDirector").each(function () {
                    var item = $(this).html();
                    if (item.indexOf(typed) === -1)  {
                        $(this).addClass('zero');
                    } else {
                        $(this).removeClass('zero');
                    }
                    
                });
            } else {
                // check what list items are 'hidden' and unhide them
            	$("#listaCargosesDirector").each(function () {
                    if ($(this).hasClass('zero')) {
                        $(this).removeClass('zero');
                    }
                });
            }
        }
    };
    return cls;

}());

function configurarBuscarGeneral()
{
	
	
	
}
function agregarAlTimeLine(id, iClass, body) {
	
	var fecha = moment(new Date()).format('DD//MM/YYYY');

	var items = [];
	items.push('<li class="time-label reciente" style="width: 100%"><span class="bg-fuchsia">Recien</span></li><li style="padding-bottom:0px;margin-bottom:0px"><i class="fa ' + iClass + ' bg-fuchsia"></i><div class="timeline-item"><span title="'+fecha+'" class="time"><i class="fa-regular fa fa-clock"></i> '+fecha+'</span><h3 class="timeline-header no-border">'+body+'</h3></div></li>');

	$('<ul/>', {
		'id' : 'listaMensajesRecientes',
		'class' : 'timeline',
		'style' : 'padding-bottom:0px;margin-bottom:0px',
		html : items.join('')
	}).prependTo("#timelinePrincipal");
	
	setPingTimeQuitarRecientes(pingTimeQuitarRecientes);
	
    setTimeout(function () {
    	quitarDelTimeLine();
    }, getPingTimeQuitarRecientes());	

}	

function quitarDelTimeLine() {
	
	if (getPingTimeQuitarRecientes()==0) {
		return;
	}
	
	$("#listaMensajesRecientes").toggle();
	$("#listaMensajesRecientes").remove();
	
	setPingTimeQuitarRecientes(0);
}



function updateCoords(c)
{
	$('#x').val(c.x);
	$('#y').val(c.y);
	$('#w').val(c.w);
	$('#h').val(c.h);
};

function checkCoords()
{
	if (parseInt($('#w').val())) return true;
	alert('Please select a crop region then press submit.');
	return false;
};

function armarCodigo(elItem) {
	
	var item = elItem;
	var r = "";
	if (item.categoria=="Compañeros") {
		
		r = "<a style='font-size:12px;' title='" + item.descripcion + "'><img width=16 height=16 src='" + item.descripcion + "' />"
		+ item.nombre + "</a>";														
	} 
	if (item.categoria=="Marcadores") {
		r = "<a style='font-size:12px;' title='" + item.descripcion + "'>"
			+ item.nombre + " - <span style='font-size:9px'>"
			+ item.descripcion + "</span></a>";
	}
	return r;
}

var categoria="";

function agregarRespuestaOK(confianza,destino,mensajeRespuesta)
	{
	
	var tipoRetorno = "success";
	$.notify({
		title: '<strong>Respuesta de la Solicitud</strong>',
		message: mensajeRespuesta
	},{
		type: tipoRetorno
	});
	
	 var refrescar = Autogestion.Mensaje;
	 refrescar.refrescarTimeline();
		
	}

	function agregarRespuestaFAIL( confianza,destino,mensajeRespuesta)
	{
		
		var tipoRetorno = "danger";
		$.notify({
			title: '<strong>Respuesta de la Solicitud</strong>',
			message: mensajeRespuesta
		},{
			type: tipoRetorno
		});
		
		 var refrescar = Autogestion.Mensaje;
		 refrescar.refrescarTimeline();
			
	}

	fnServerObjectToArray = function(aElements) {
		return function(sSource, aoData, fnCallback) {
			$.ajax({
				"dataType" : 'json',
				"url" : sSource,
				"data" : aoData,
				"success" : function(json) {
					var a = [];
					for ( var i = 0, iLen = json.length; i < iLen; i++) {
						var inner = [];
						for ( var j = 0, jLen = aElements.length; j < jLen; j++) {
							if (json[i][aElements[j]]) {
								inner.push(json[i][aElements[j]]);
							}
						}
						a.push(inner);
					}
					json.aaData = a;
					fnCallback(json);
				},
				"error" : function (xhr, error, thrown) {
					//estofunciona
					//grillaActual._fnProcessingDisplay(false);
				
					$('.dataTables_empty').remove();					
					var msgSpot = $('.dataTables_processing');
					$(msgSpot).html("No se puede obtener la información! Intente nuevamente más tarde");
					//$(msgSpot).css( "background-color","#f39c12");
					$(msgSpot).css( "background-image","none");
					$(msgSpot).addClass("bg-yellow");
					$(msgSpot).css( "padding-top","8px");
					
				}
			});
		}
	};

	fnCreatedRow = function() {
		return 	function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
			 if ( aData[0] ) {
				 var nombreImagen = new String(aData[0]);
				 var nombreImagenFinal = '';
				 
				 if (!nombreImagen) return;
				 
				 nombreImagenFinal = $.imagenPerfil(nombreImagen,aData[1],32,"USUARIO");
	
	            $('td', nRow).eq(0).html(nombreImagenFinal); 	                
       		}
		}
	};
	
	function verAgenda(idNombre,fecha) {
		var id = $(idNombre);
		if (id) { $(window).scrollTo(id,200) };
		$('#calendar').fullCalendar('gotoDate', fecha);
		$('#calendar').focus();
		
		var $div2blink = $(".blinker"); // Save reference, only look this item up once, then save
		var backgroundInterval = setInterval(function(){
		    $div2blink.toggleClass("backgroundRed");
		 },1500)		
		
	}

function getConfiguracionVentana(pId) {
	
	var ventanaCache = cache.get("ventanaMarcador");
	var jsonObjeto='';
	
	if (!ventanaCache) {
		$.ajax({ 
		     url: "/4/config/ventanamarcador.json",       
		     dataType: 'json', 
		     async : false,
		     success: function(data)     {
		    	 jsonConfiguracion = data;
		    	 cache.set("ventanaMarcador", data);
		    	 ventanaCache = data;
		     	}
			 });	
	} 

	$.each(ventanaCache, function(i, cfg) {
		    if (cfg.idMarcador == pId) {
		    	jsonObjeto = cfg;
		        return ;
		    }
		});
	
	return jsonObjeto;
}


function getConfiguracion(pId) {
   $.ajax({ // ajax call starts
        url: "/4/config/lista.json",//'../config/lista.json', // JQuery loads serverside.php       
        dataType: 'json', // Choosing a JSON datatype
        async : false,
        success: function(data) // Variable data contains the data we get from serverside
        {
	       	jsonConfiguracion = data;
        }
    });
	
    var jsonAtributosA='';
    $.each(jsonConfiguracion, function(i, cfg) {
  	    if (cfg.idConfiguracion == pId) {
  	    	jsonAtributosA = cfg.valor;
  	    	//alert(jsonAtributosA);
  	        return ;
  	    }
  	});

	return jsonAtributosA;

}

function getSaldoPlaya() {
	$.ajax({
        url: "/4/arancel/saldo/playa",
        type : 'GET',
        dataType: 'json', 
    }).done(function(data,textStatus,jqXHR) {
    	if (data) { $("#textoSaldo").text(data.valor); }
    }).fail(function(data,textStatus,jqXHR) {
    	console.log("retry");
    });		
}


function comprarSaldoPlaya() {
	$.ajax({
        url: "/4/arancel/saldo/playa",
        type : 'GET',
        dataType: 'json',
    }).done(function(data,textStatus,jqXHR) {
    	if (data) { $("#textoSaldo").text(data.valor); }
    }).fail(function(data,textStatus,jqXHR) {
    	console.log("retry");
    });
}

function pagarSaldoPlaya() {
	$.ajax({
        url: "/4/arancel/saldo/playa",
        type : 'POST',
        dataType: 'json',
    }).done(function(data,textStatus,jqXHR) {
    	if (data) { $("#textoSaldo").text(data.valor); }
    }).fail(function(data,textStatus,jqXHR) {
    	console.log("retry");
    });
}


function abrirModalAgregarContacto(tipo,id) {
	var titulo = "Agregar Usuarios";
	var btnContacto = '<button class="btn btn-primary pull-left" type="submit" id="publicarMensaje2"><i class="fa fa-plus"></i> Enviar Mensaje</button>';	
	var btnGrupo = '<button class="btn btn-primary pull-left" type="submit" id="btnAgregarMiembrosGrupo" data-id='+id+'><i class="fa fa-plus"></i> Agregar</button>';
	var btnInvitacion = '<button class="btn btn-primary pull-left" type="submit" id="btnAgregarMiembrosGrupoInvitacion" data-id='+id+'><i class="fa fa-plus"></i> Avisar al Creador</button>';
	var btnCerrar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>';
	var btn = "";

	if (tipo=="C") {
		btn = btnContacto;
		titulo = "Agregar Nuevos Contactos Confiables";
		$('#seConocen').val("N");
		$('#trustedperson-modal #txtMensaje2').show();
		$('input#urlBusqueda').val("buscar/destinatario/");
		setLaUlrBusquedaActual("buscar/destinatario/");
	} else if (tipo=="G") {
		btn = btnGrupo;
		titulo = "Agregar Miembros al Grupo";
		$('#seConocen').val("2");		
		$('#trustedperson-modal #txtMensaje2').hide();
		$('input#urlBusqueda').val("buscar/integrantes/");
		setLaUlrBusquedaActual("buscar/integrantes/");

	} else {
		btn = btnInvitacion;
		titulo = "Invitar a nuevos Integrantes";
		$('#seConocen').val("S");		
		$('#trustedperson-modal #txtMensaje2').hide();
		$('input#urlBusqueda').val("buscar/integrantes/");
		setLaUlrBusquedaActual("buscar/integrantes/");

	}

	configurarBuscarGeneral();
	
	$('#trustedperson-modal .modal-title').html(titulo);
	$('#trustedperson-modal').modal({keyboard: true});
	$('#itemRespuestasMensaje2').empty();
	$("#trustedperson-modal .modal-footer").html(btn);
	$("#trustedperson-modal .modal-footer").append(btnCerrar);
	
}

function AlertBox(titulo,mensaje,icono,modWidth)
{
	if(!modWidth)
		modWidth=300;

	
	$('#dialogoAlert .modal-title').html(titulo);
	$('#dialogoAlert .modal-body').html(mensaje);
	$('#dialogoAlert .modal-dialog').width( modWidth);
	$('#dialogoAlert').modal({keyboard: false});
	
}
function urlTramitesV3(url) {
	var urlV3 = "http://www.frc.utn.edu.ar/academico3/v4/tramites/";
	var urlTramite = urlV3 + url;
	return urlTramite; 
}

function abrirModalV4Bis(idTramite)
{
	var url ="tramites/" + idTramite;
	abrirModalV4(url);
}
function abrirModalDocenteMateriaUpload(url,pNombreMateria,pCodigoMateria)
{
	var titulo = "Cargando....";
	titulo = pNombreMateria
	$('#dialogoTramites .modal-title').html(titulo);
	
	$("#dialogoSubirArchivoMateriasDocente").modal({keyboard: true});
	btnCerrar = '<button type="button" class="btn btn-danger no-print" data-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>';
	btn = '<button type="submit" class="btn btn-success pull-left"><i class="fa fa-check"></i>Subir Archivo</button>'
	//$('#dialogoSubirArchivoDocente .modal-body').html("");	
	$.ajax({
	        url: url,
	        type: "GET",
	        dataType:"json"
	
		}).done(function(data) {
			// traemos los datos grabados con anterioridad si los hay
			console.log(data);
			
		}).always(function(data) {
            //alert("obtengo el estado para habilitar o no un boton: "+ jqXHR.getResponseHeader('estado'));		        

        });
        
      $("#dialogoSubirArchivoMateriasDocente button:submit").click(function( ) {	
    		$.ajax({
    	        url: url,//urlTramitesV3(urlProcesamiento),
    	        type: "POST",
    	        data: $("dialogoSubirArchivoDocente form").serialize(),
    	        success: function(data) { 
    	        	var sResultado ="";
    	        	$('dialogoSubirArchivoMateriasDocente .modal-body').html(sResultado);
    	        	$('dialogoSubirArchivoMateriasDocente .modal-title').html(data.titulo);
    	        	if(data.finalizado==true || data.invalidada==true || data.habilitado == false)
    	            {
    	        		$("#dialogoSubirArchivoMateriasDocente .modal-footer button").remove();
    	        		$("#dialogoSubirArchivoMateriasDocente .modal-footer").html(btnCerrar);
    	            }
    	        	
    	        }
    	    	});
    		return false;
    		});  	
		
}
function abrirModalV4Nuevo(url,codigomateria)
{
	//var objeto = o ;
	//var mensajes = sms;
	var titulo = "Cargando....";
	var descripcion = "mensajes.descripcion";
	console.log('preseleccinar codigo materia')
	
	$('#dialogoTramites .modal-title').html(titulo);
	$('#dialogoTramites').modal({keyboard: true});
	btn = '<button type="submit" class="btn btn-success pull-left"><i class="fa fa-check"></i> Subir Archivo</button>';// antes Iniciar Tramite
	btnAceptar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Aceptar</button>';
	btnCancelar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Cancelar</button>';
	btnCerrar = '<button type="button" class="btn btn-danger no-print" data-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>';
	
	
	
	$.ajax({
        url: url,//urlTramitesV3(url),
        type: "GET",
        dataType:"json"

	}).done(function(data) {

		//alert(data.titulo);
		
		titulo=" Buscando el Tramite Solicitado ...";
    	$('#dialogoTramites .modal-title').html(data.titulo);
    	$('#dialogoTramites .modal-header h4').prepend('<i class="fa fa-check-circle"></i>');
        $('#dialogoTramites .modal-body').html(data.cuerpo);
        if(data.finalizado==true || data.tieneErrores==true || data.invalidada==true || data.habilitado == false)
        {
    		//$("#dialogoTramites .modal-footer button").remove();
    		$("#dialogoTramites .modal-footer").html(btnCerrar);
        }
        else
        {
        	$("#dialogoTramites .modal-footer").html(btn);
        	$("#dialogoTramites .modal-footer").append(btnCancelar);
        }
        console.log("preselecconar codigo materia")
        console.log("done" + codigomateria)
        $("#cmbItems").val(codigomateria)
	    $("#cmbItems").attr("disabled", "disabled");
	    $("#hiddenItems").val(codigomateria)
    	//0|Solicitud Excepción 30hs|Estado del TRÁMITE: <b>NO ESTA DISPONIBLE EN ESTE MOMENTO</b>.<br/>El período en que puede ser realizado es del <b>03/07/2014</b> al <b>30/07/2014</b>|03/07/2014|30/07/2014|ProcesarPedido.asp
    	$("#dialogoTramites button:submit").click(function( ) {	
    		$.ajax({
    	        url: url,//urlTramitesV3(urlProcesamiento),
    	        type: "POST",
    	        data: $("#dialogoTramites form").serialize(),
    	        success: function(data) { 
    	        	
    	        	$('#dialogoTramites .modal-body').html(data.cuerpo);
    	        	$('#dialogoTramites .modal-title').html(data.titulo);
    	        	if(data.finalizado==true || data.invalidada==true || data.habilitado == false)
    	            {
    	        		$("#dialogoTramites .modal-footer button").remove();
    	        		$("#dialogoTramites .modal-footer").html(btnCerrar);
    	            }
    	        	
    	        }
    	    	});
    		return false;
    		});	
        }).always(function(data) {
            //alert("obtengo el estado para habilitar o no un boton: "+ jqXHR.getResponseHeader('estado'));		        
			console.log("codigo materia always" + codigomateria)
			console.log(codigomateria);
	        setTimeout(function () {
			  	console.log("en setTimeout codigomateria")
			  	console.log("-" + codigomateria + "-");
			  	codigomateria = codigomateria.trim();
	        	$("#cmbItems").val(codigomateria)
	  	  	}, 1000);

            });
	

}
function abrirModalV4(url)
{
	//var objeto = o ;
	//var mensajes = sms;
	var titulo = "Cargando....";
	var descripcion = "mensajes.descripcion";

	
	$('#dialogoTramites .modal-title').html(titulo);
	$('#dialogoTramites').modal({keyboard: true});
	btn = '<button type="submit" class="btn btn-success pull-left"><i class="fa fa-check"></i> Iniciar Trámite</button>';
	btnAceptar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Aceptar</button>';
	btnCancelar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Cancelar</button>';
	btnCerrar = '<button type="button" class="btn btn-danger no-print" data-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>';
	
	
	
	$.ajax({
        url: url,//urlTramitesV3(url),
        type: "GET",
        dataType:"json"

	}).done(function(data) {

		//alert(data.titulo);
		
		titulo=" Buscando el Tramite Solicitado ...";
    	$('#dialogoTramites .modal-title').html(data.titulo);
    	$('#dialogoTramites .modal-header h4').prepend('<i class="fa fa-check-circle"></i>');
        $('#dialogoTramites .modal-body').html(data.cuerpo);
        if(data.finalizado==true || data.tieneErrores==true || data.invalidada==true || data.habilitado == false)
        {
    		//$("#dialogoTramites .modal-footer button").remove();
    		$("#dialogoTramites .modal-footer").html(btnCerrar);
        }
        else
        {
        	$("#dialogoTramites .modal-footer").html(btn);
        	$("#dialogoTramites .modal-footer").append(btnCancelar);
        }
    	//0|Solicitud Excepción 30hs|Estado del TRÁMITE: <b>NO ESTA DISPONIBLE EN ESTE MOMENTO</b>.<br/>El período en que puede ser realizado es del <b>03/07/2014</b> al <b>30/07/2014</b>|03/07/2014|30/07/2014|ProcesarPedido.asp
    	$("#dialogoTramites button:submit").click(function( ) {	
    		$.ajax({
    	        url: url,//urlTramitesV3(urlProcesamiento),
    	        type: "POST",
    	        data: $("#dialogoTramites form").serialize(),
    	        success: function(data) { 
    	        	
    	        	$('#dialogoTramites .modal-body').html(data.cuerpo);
    	        	$('#dialogoTramites .modal-title').html(data.titulo);
    	        	if(data.finalizado==true || data.invalidada==true || data.habilitado == false)
    	            {
    	        		$("#dialogoTramites .modal-footer button").remove();
    	        		$("#dialogoTramites .modal-footer").html(btnCerrar);
    	            }
    	        	
    	        }
    	    	});
    		return false;
    		});	
        }).always(function(data) {
            //alert("obtengo el estado para habilitar o no un boton: "+ jqXHR.getResponseHeader('estado'));		        

            });
	

}
function abrirModalV3(url) {
	//var objeto = o ;
	//var mensajes = sms;
	var titulo = "Cargando....";
	var descripcion = "mensajes.descripcion";

	$('#dialogoTramites .modal-title').html(titulo);
	$('#dialogoTramites').modal({keyboard: true});
	btn = '<button type="submit" class="btn btn-success pull-left"><i class="fa fa-check"></i> Iniciar Trámite</button>';
	btnAceptar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Aceptar</button>';
	btnCancelar = '<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Cancelar</button>';
	
	$.ajax({
		beforeSend: function() { /* do nothing */ },
		crossOrigin: true,
		xhrFields: { withCredentials: true },
        url: urlTramitesV3(url),
        type: "GET"
    }).done(function(data,textStatus,jqXHR) {
        //alert("obtengo el estado para habilitar o no un boton: "+ jqXHR.getResponseHeader('estado'));
        var estadoCompleto = jqXHR.getResponseHeader('estado');
        var titulo = estadoCompleto.split("|")[1];
        var cuerpo = estadoCompleto.split("|")[2];
        var urlProcesamiento = estadoCompleto.split("|")[5];
    	$('#dialogoTramites .modal-title').html(titulo);
    	$('#dialogoTramites .modal-header h4').prepend('<i class="fa fa-check-circle"></i>');
        $('#dialogoTramites .modal-body').html(data);
    	$("#dialogoTramites .modal-footer").html(btnCancelar).html(btn);
    	//0|Solicitud Excepción 30hs|Estado del TRÁMITE: <b>NO ESTA DISPONIBLE EN ESTE MOMENTO</b>.<br/>El período en que puede ser realizado es del <b>03/07/2014</b> al <b>30/07/2014</b>|03/07/2014|30/07/2014|ProcesarPedido.asp
    	$("#dialogoTramites form button:submit").click(function( ) {	
    		$.ajax({
    			beforeSend: function() { /* do nothing */ },
    			crossOrigin: true,
    			xhrFields: { withCredentials: true },
    	        url: urlTramitesV3(urlProcesamiento),
    	        type: "GET",
    	        success: function(data) {        	          
    	            $('#dialogoTramites .modal-body').html(data);
    	            $("#dialogoTramites form .modal-footer button").remove();
    	            $("#dialogoTramites form .modal-footer").html(btnAceptar);
    	        	}
    	    	});
    		return false;
    		});	
        }).always(function(data,textStatus,jqXHR) {
            alert("obtengo el estado para habilitar o no un boton: "+ jqXHR.getResponseHeader('estado'));		        

            });
	
}

function abrirModalGeneral(titulo,descripcion,aceptar,cancelar,tipo,callBackAceptar,callBackCancelar,opciones,botonCerrar) {
    $("#dialogoGeneral .modal-footer button.btn-success").unbind();
	$("#dialogoGeneral").attr("data-backdrop","static");

	$("#dialogoGeneral .modal-title").html(titulo);
	$("#dialogoGeneral .modal-body").html(descripcion);
	
	if (!opciones) {
		opciones  = {backdrop: 'static',keyboard: false};
	}
	
	if (botonCerrar) {
		$("#dialogoGeneral .modal-header button.close").remove();
	}
	
	if (getTipoUsuario()!="D") {
		$("#dialogoGeneral #openExternal").hide();
	}

	$("#dialogoGeneral").modal(opciones);
	
	if (tipo==0) {//solo el boton aceptar
		$("#dialogoGeneral .modal-footer button.btn-success").removeClass("pull-left").addClass("center-block");
	} else {
		$("#dialogoGeneral .modal-footer button.btn-success").attr("data-dismiss","");
	}

	if (!aceptar) { $("#dialogoGeneral .modal-footer button.btn-success").hide(); }
	if (!cancelar) { $("#dialogoGeneral .modal-footer button.btn-danger").hide(); }	
	
	$("#dialogoGeneral .modal-footer button.btn-success").click(function(e) {
		e.stopPropagation();
		if (typeof callBackAceptar ==="function") {
			callBackAceptar(e);
		} else {
		}
		$("#dialogoGeneral").modal("hide");
		
		return false;
	});	

	$("#dialogoGeneral .modal-footer button.btn-danger").click(function(e) {
		e.stopPropagation();
		if (typeof callBackCancelar ==="function") {
			callBackCancelar(e);
		}
		$("#dialogoGeneral").modal("hide");
	});	
}

function abrirModalListas(id, titulo, enlace, idMarcador) {

	$('#dialogoListas .modal-title').html(titulo);
	$('#dialogoListas .modal-body').html('<table cellpadding="0" cellspacing="0" border="0" class="table table-bordered table-striped dataTable" id="tablaMiembros' + id + '"></table>');	
	$('#dialogoListas').modal({keyboard: true});

	var elEnlace = "/4/grupos/integrantes/"+id;
	
	if (!enlace) { 
		elEnlace = "/4/grupos/integrantes/"+id;
	} else {
		elEnlace = enlace;
	}
	
	var url = elEnlace;
	
	var elIdMarcador = "";
	
	if (!idMarcador) {
		elIdMarcador = 39;
	} else {
		elIdMarcador = idMarcador;
	}
	
	var configuracionVentana = getConfiguracionVentana(elIdMarcador);
	var configuracionEncabezadoMapeo = configuracionVentana.encabezadoMapeo;
	var configuracionEncabezadoTitulo = configuracionVentana.encabezadoTitulo;
	var configuracionAtributosGrilla = configuracionVentana.atributosGrilla;
	
	url = elEnlace;
	var arrayEncabezadoMapeo = (new Function("return [" + configuracionEncabezadoMapeo + "];"))();
	var arrayEncabezadoTitulo = (new Function("return [" + configuracionEncabezadoTitulo + "];"))();
			
	var initGrilla = eval('(function(){return' + configuracionAtributosGrilla + ';})()');
	
	$.extend( $.fn.dataTable.defaults, {
	        "bFilter": false,
	        "bSort": false,
	} );
	 
	$("#tablaMiembros"+id).dataTable(initGrilla);		   

}

function abrirModalEventos(start,end) {
	
	$("#dialogoEventos").modal();
	
	if (!start) {
		start = $('#calendar').fullCalendar('getDate');
	}
	
	var sx = moment(start);
	var sxf = sx.format("DD/MM/YYYY");
	
	$('#dialogoEventos .modal-title').html("Evento para el "+ sxf);
	
	$("#add-new-event").click({sx:start,ex:end},function (e) {
		e.preventDefault();
		  
		//Get value and make sure it is not null
		var val = $("#new-event").val();
		if (val.length == 0) {
		  return;
		}
		
		var fechaCrea = moment(e.data.sx);
		var fechaFinal = fechaCrea.format("DD/MM/YYYY");
		
		var currBackGroundColor = currColor;//$(this).css("background-color");
		var currBorderColor = currColor;// $(this).css("border-color");
		  
			var eventData;
			if (val) {
				eventData = {
				title: val,
				start: e.data.sx,
				end: e.data.ex,
				backgroundColor: currBackGroundColor,
				borderColor: currBorderColor				
				};
				$('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
			}
			$('#calendar').fullCalendar('unselect');
		  
		  $("#new-event").val("");
		});
}

function utf8ToHex(str) {
      return Array.from(str).map(c => 
        c.charCodeAt(0) < 128 ? c.charCodeAt(0).toString(16) : 
        encodeURIComponent(c).replace(/\%/g,'').toLowerCase()
      ).join('');
}
    
function hexToUtf8(hex) {
      return decodeURIComponent('%' + hex.match(/.{1,2}/g).join('%'));
}

function abrirModalFoto(uid) {
	
	$('#dialogoFoto').modal({keyboard: false});
	$.ajax({
        url: 'perfil/foto.jsp?uuid='+uid,
        type: "GET"
    }).done(function(data,textStatus,jqXHR) {
	        
        $('#dialogoFoto .modal-body').html(data);
        $("#dialogoFoto .modal-footer button").remove();

        }).always(function(data,textStatus,jqXHR) {
    });
}

function correlatividad(url) {
	var ec = overlay.clone();
	console.log("idPeticion" + idPeticion);
	$("#dialogoEnlacesBases .modal-body").html('<div style="font-size:16px;"> Aguarde unos instantes por favor... cargando...<img src="/4/themes/AdminLTE-2/dist/img/32x32/Preloader_10/Preloader_10.gif" alt="()" /></div>');	
	$.ajax({
		url : url,
		type : 'GET',
		dataType : 'json',
        beforeSend: function( xhr ) {
            xhr.setRequestHeader("A4-Token", A4Token);
            xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
            xhr.setRequestHeader("A4-Data", A4Data);
            xhr.setRequestHeader("idPeticion", getIdPeticion());
         }				
	}).done(function(data) {
		console.log("done");
		var responseData = "";
		if (data) {
		    var idExterna = data.id;
		    var code = data.code;
			responseData = data.content;
		}
		$("#dialogoEnlacesBases .modal-body").html(responseData);
		
	}).fail(function(data) {
		$("#dialogoEnlacesBases .modal-body").html("No se puede obtener la información en estos momentos. Gracias!");
	}).always(function(data) {
		var esteOverlay = $("#dialogoEnlacesBases .modal-body").find(ec);
		esteOverlay.animate({opacity : 0.25}, 1000, function() {
			$(this).remove();
		});
	});
}

function estadoAcad() {
	var ec = overlay.clone();
	$("#dialogoEnlacesBases .modal-body").html("Aguarde uno instantes por favor... cargando...");

	$("#dialogoEnlacesBases .modal-body").prepend(ec);
	
	var ajaxTime = new Date().getTime();
			
			var laUrl = "/4/transacciones/estado";
			$.ajax({
				url : laUrl,
				type : 'POST',
				dataType : 'json',
				data : "idPeticion=" + getIdPeticion(),
			}).done(function(data) {

				var estado = data.valor;
				var salida = data.salida;
				
				var totalTime = new Date().getTime()-ajaxTime;
								
				if (estado==0 || estado==1) {
					console.log("transaccionando");
				}
				if (estado==2) {
					console.log("completado");
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);
										
				}
				if (estado==3) {
					console.log("muestra error");
					
					setPingTimeEstadoPeticion(0);
					clearTimeout(pingEstadoPeticion);
					
				}
				
			}).always(function(data) {
				
			});		
	
	$.ajax({
		url : url,
		type : 'GET',
		dataType : 'json',
        beforeSend: function( xhr ) {
            xhr.setRequestHeader("A4-Token", A4Token);
            xhr.setRequestHeader("A4-TimeStamp", A4TimeStamp);
            xhr.setRequestHeader("A4-Data", A4Data);
            xhr.setRequestHeader("idPeticion", getIdPeticion());
         }				
	}).done(function(data) {
		console.log("done");
		var estado = data.estado
		//var message = data.trim().toString().split("|");
		$("#dialogoEnlacesBases .modal-body").html(data);
	}).fail(function(data) {
		$("#dialogoEnlacesBases .modal-body").html("No se puede obtener la información en estos momentos. Gracias!");
	}).always(function(data) {
		var esteOverlay = $("#dialogoEnlacesBases .modal-body").find(ec);
		esteOverlay.animate({opacity : 0.25}, 1000, function() {
			//$(this).remove();
		});
	});
}

function armarTabla(idMarcador,enlace,objeto) {

		var titulo = objeto.text();
		var htmlTitle = objeto.attr("data-title");
				
		if (htmlTitle!=null) {
			titulo = htmlTitle;
		}
		
		var elIdMarcador = idMarcador;
		var idVentanaJ = '#ventana' + elIdMarcador;
		var idGrilla = 'grilla' + elIdMarcador;
		var idGrillaJ = '#' + idGrilla;
		
		var iconoEnlace = '';
		var mensajeAnteriorTabla = '';
	 
		if (elIdMarcador=="12") { iRf('41562158','41562158'); return;}
		if (elIdMarcador=="6") { location.href = "https://www.frc.utn.edu.ar/academico3/transacciones/horarios.frc";}
		if (elIdMarcador=="1000") { mensajeAnteriorTabla = '<p>Ante cualquier duda, comuniquese al siguiente mail <a href="mailto:sueldos@frc.utn.edu.ar">sueldos@frc.utn.edu.ar</a></p>';}		
		if (elIdMarcador=="2000") {
			titulo = titulo + ' - ' + getEspecialidadNombre();
			mensajeAnteriorTabla = '<div class="row" style="padding-left:20px;padding-right:20px"><div class="col-sm-1"><button id="btnPagar" disabled="disabled" class="btn btn-primary btn-flat btn-lg">Pagar</button></div><div class="col-sm-11"><p align="right"><img src="/4/images/pagos360Logo.png" alt="Pagos360" height="35px" /> <br/><a href="https://pagos.frc.utn.edu.ar/terminos" target="_blank">Términos y Condiciones</a></p></div></div>';}
		if (elIdMarcador=="2002") { mensajeAnteriorTabla = '<div class="row" style="padding-left:20px;padding-right:20px;font-size:18px;font-weight:bold;">Saldo: <span id="textoSaldo"></span></div>';
			}
		if (elIdMarcador=="2003") {
			titulo = titulo + ' - ' + getEspecialidadNombre();
			mensajeAnteriorTabla = '<div class="row" style="padding-left:20px;padding-right:20px"><div class="col-sm-1"><button id="btnPagarMatricula" disabled="disabled" class="btn btn-primary btn-flat btn-lg">Pagar</button></div><div class="col-sm-11"><p align="right"><img src="/4/images/pagos360Logo.png" alt="Pagos360" height="35px" /> <br/><a href="https://pagos.frc.utn.edu.ar/terminos" target="_blank">Términos y Condiciones</a></p></div></div>';
		}
				

		if (enlace.indexOf("expediente")!=-1) {
			iconoEnlace = '<i class="fa fa-briefcase"></i>'
			}
		
		if (enlace.indexOf("cursado")!=-1) {
			iconoEnlace = '<i class="fa fa-briefcase"></i>'
			} 
		
		if (enlace.indexOf("examen")!=-1) {
			iconoEnlace = '<i class="fa fa-file-text"></i>'
			} 

		if (enlace.indexOf("materia")!=-1) {
			iconoEnlace = '<i class="fa fa-pencil"></i>'
			} 
		if (enlace.indexOf("biblioteca")!=-1) {
			iconoEnlace = '<i class="fa fa-book"></i>'
			} 
		
		$('#dialogoEnlacesBases .modal-title').html(titulo);
		$('#dialogoEnlacesBases .modal-title').html(titulo);
		$('#dialogoEnlacesBases .modal-header h4').prepend(iconoEnlace);
		
		$('#dialogoEnlacesBases .modal-header div.box-tools button').first().prop('disabled', false);
		
		var tamanioItemsFavortitos = 0;
		var tamanioItemsFavortitos = $("#listaFavoritos li:not(.itemVacio)").size();
		
		if (tamanioItemsFavortitos!=0) {
			$("#listaFavoritos li").each(function( index ) {
				var itemFavoritoTexto = $(this).find("a").attr("id");
				var itemFavoritoId = itemFavoritoTexto.replace("itemFavoritoMarcador","");
				if (itemFavoritoId==elIdMarcador) {
					$('#dialogoEnlacesBases .modal-header div.box-tools button').first().prop('disabled', true);		
				}
			});		
		}
		
		$('#dialogoEnlacesBases .modal-header div.box-tools button i.fa-heart').attr('id',"idMarcador"+elIdMarcador);				 
		$("#dialogoEnlacesBases .modal-body").html(mensajeAnteriorTabla + '<table cellpadding="0" cellspacing="0" border="0" class="table table-bordered table-striped dataTable" id="' + idGrilla + '"></table>');
	    $('#dialogoEnlacesBases').modal({keyboard: true});
	    
	    if (elIdMarcador=="2002") { getSaldoPlaya(); }
	    
	    url = enlace;
	    switch (elIdMarcador) {
			case "10":
				correlatividad("/4/examen/estadoAcademico");
				break;
			case "15":
				correlatividad("/4/materias/correlatividad/cursar");
				break;
			case "16":
				correlatividad("/4/materias/correlatividad/equivalencias");
				break;
			case "17":
				correlatividad("/4/materias/correlatividad/rendir");								
				break;

			case "4442":
				
				var ventanaCache = cache.get("ventanaMarcador");
				var jsonObjeto='';
				
				if (!ventanaCache) {
					$.ajax({ 
					     url: "/4/config/ventanamarcador.json",       
					     dataType: 'json', 
					     async : false,
					     success: function(data)     {
					    	 jsonConfiguracion = data;
					    	 cache.set("ventanaMarcador", data);
					    	 ventanaCache = data;
					     	}
						 });	
				} 

				$.each(ventanaCache, function(i, cfg) {
					    if (cfg.idMarcador == pId) {
					    	jsonObjeto = cfg;
					        return ;
					    }
					});
				
				return jsonObjeto;
				
			default :
				
				var configuracionVentana = getConfiguracionVentana(idMarcador);
				var configuracionEncabezadoMapeo = configuracionVentana.encabezadoMapeo;
				var configuracionEncabezadoTitulo = configuracionVentana.encabezadoTitulo;
				var configuracionAtributosGrilla = configuracionVentana.atributosGrilla;
	
				var arrayEncabezadoMapeo = (new Function("return [" + configuracionEncabezadoMapeo + "];"))();
				var arrayEncabezadoTitulo = (new Function("return [" + configuracionEncabezadoTitulo + "];"))();
						
				if (typeof configuracionAtributosGrilla === "undefined") {
					configuracionAtributosGrilla = '{"bPaginate":false,"bLengthChange":false,"bSort":false,"bInfo":false,"bAutoWidth":false,"bFilter":false,"bProcessing":true,"bJQueryUI":false,"sAjaxSource":url,"fnServerData":fnServerObjectToArray(arrayEncabezadoMapeo),"aoColumns": arrayEncabezadoTitulo,"oLanguage":{"sLoadingRecords": "Cargando..., por favor espere.","sProcessing": "Procesando, espere por favor...","sLengthMenu": "_MENU_ Registros","sZeroRecords": "No hay Registros de acuerdo a su b&uacute;squeda.","sEmptyTable": "No existen registros disponibles.","sInfo": "_START_ al _END_ de _TOTAL_ Registros","sInfoEmpty": "0 / 0 de 0 Registros","sInfoFiltered": "","sInfoPostFix": "","sSearch": "Buscar","sUrl": "","oPaginate":{"sFirst":"Primero","sPrevious": "Anterior","sNext":"Siguiente","sLast":"Ultimo"}}}';;
				}
								  
				var initGrilla = eval('(function(){return' + configuracionAtributosGrilla + ';})()');
				
				 $.extend( $.fn.dataTable.defaults, {
				        "bFilter": false,
				        "bSort": false,
				 } );
				
				grillaActual = $(idGrillaJ).dataTable(initGrilla);		   

				break;	
	    }    	
	    
	    $('#destinatarioDialog').on("change", function(e) { console.log ("highlighted val="+ e.val+" choice="+ JSON.stringify(e.choice));})
	    
}

(function ($) {
    "use strict";
    
    var Cuil = function (options) {
        this.init('cuil', options, Cuil.defaults);
    };

    //inherit from Abstract input
    $.fn.editableutils.inherit(Cuil, $.fn.editabletypes.abstractinput);

    $.extend(Cuil.prototype, {
        render: function() {
           this.$input = this.$tpl.find('input');
        },
        value2html: function(value, element) {
            if(!value) {
                $(element).empty();
                return; 
            }
            var html = $('<div>').text(value.pre).html() + '-' + $('<div>').text(value.dni).html() + '-' + $('<div>').text(value.pos).html();
            $(element).html(html); 
        },
        html2value: function(html) {        
          return null;  
        },   
       value2str: function(value) {
           var str = '';
           if(value) {
               for(var k in value) {
                   str = str + k + ':' + value[k] + ';';  
               }
           }
           return str;
       }, 
       str2value: function(str) {
           /*
           this is mainly for parsing value defined in data-value attribute. 
           If you will always set value by javascript, no need to overwrite it
           */
           return str;
       },                
       value2input: function(value) {
           if(!value) {
             return;
           }
           this.$input.filter('[name="pre"]').val(value.pre);
           this.$input.filter('[name="dni"]').val(value.dni);
           this.$input.filter('[name="pos"]').val(value.pos);
       },       
       input2value: function() { 
           return {
              pre: this.$input.filter('[name="pre"]').val(), 
              dni: this.$input.filter('[name="dni"]').val(), 
              pos: this.$input.filter('[name="pos"]').val()
           };
       },        
       activate: function() {
            this.$input.filter('[name="pre"]').focus();
       },  
 
    });

    Cuil.defaults = $.extend({}, $.fn.editabletypes.abstractinput.defaults, {
        tpl: '<div class="editable-cuil"><input type="text" name="pre" class="input-small" size="1" maxlength="2">'+
             '-<input type="text" name="dni" class="input-small" disabled="disabled" readonly="readonly">'+
             '-<input type="text" name="pos" class="input-mini" size="1" maxlength="1"></div>',
             
        inputclass: ''
    });

    $.fn.editabletypes.cuil = Cuil;

}(window.jQuery));

